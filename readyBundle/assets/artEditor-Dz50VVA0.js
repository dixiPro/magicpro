import{r as h,c as ee,a as Y,t as ve,b as g,o as v,d as t,e as A,u as r,w as N,v as Q,n as q,f as ge,F as W,g as J,h as L,i as I,j as X,k as M,l as x,m as O,p as ce,q as he,s as ye,x as _e,y as se,z as F,A as be,B as Z,C as ae,D as ie,E as we,G as $e,H as ke,I as Te,J as xe,K as Ce,T as me,L as Se,M as Pe,N as Re,O as Ae,P as Ee,Q as Ve,R as Ue,S as ze,U as Le,V as Me,W as De,X as Fe}from"./apiCall-CqgbXul4.js";import{s as Be}from"./index-DOvAxsD_.js";import{d as Oe,a as pe,i as Ne,A as Ie,l as ue,c as He}from"./material-design-C0AS3xme.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";async function fe(s,e=2){try{return await prettier.format(s,{parser:"php",plugins:prettierPlugins,tabWidth:e})}catch(i){throw console.error("Ошибка при форматировании Php:",i),new Error("Ошибка при форматировании Php")}}async function Ke(s,e=2){let i=[],a=s.replace(/@php([\s\S]*?)@endphp/g,(d,c)=>{const u=i.length;return i.push(d),`<!--___PHP____${u}-->`}),o=[];a=a.replace(/@extends\s*\(\s*['"][^)]+?\[[\s\S]*?\]\s*\)/g,d=>{const c=o.length;return o.push(d),`<!--___EXTENDS____${c}-->`});let n=[];a=a.replace(/@props\s*\(\s*\[[\s\S]*?\]\s*\)/g,d=>{const c=n.length;return n.push(d),`<!--___PROPS____${c}-->`});let l=[];a=a.replace(/{{--([\s\S]*?)--}}/g,(d,c)=>{const u=l.length;return l.push(d),`<!--___COMMENT____${u}-->`}),i.length>0&&(i=await Promise.all(i.map(d=>We(d,e))));try{a=await prettier.format(a,{parser:"html",plugins:[prettierPlugins.html],tabWidth:e,printWidth:160})}catch(d){const c=d.message.split(`
`).map(u=>u.replace(/^\s+/,"")).map(u=>u.replace(/For more info.*/,"")).filter(u=>!u.includes("at")).join(`
`);document.showToast(c,"error")}return a=qe(a,e),a=a.replace(/<!--___PHP____(\d+)-->/g,(d,c)=>i[c]),a=a.replace(/<!--___PROPS____(\d+)-->/g,(d,c)=>n[c]),a=a.replace(/<!--___COMMENT____(\d+)-->/g,(d,c)=>l[c]),a=a.replace(/<!--___EXTENDS____(\d+)-->/g,(d,c)=>o[c]),a}async function We(s,e){s=s.replace(/@php\s*/g,"").replace(/\s*@endphp/g,"");let i=`<?php
${s}`,a=await fe(i,e);return a=a.replace(/^<\?php\s*/,"").trim(),a=a.split(`
`).map(o=>" ".repeat(e)+o).join(`
`),a=`@php
${a}
@endphp`,a}function qe(s,e=2){const i=s.split(`
`);let a=0;const o=[];for(let n of i){let l=Xe(n);for(let d of l){let c=Ge(d);d.includes("<!--___PHP____")?(d=d.replace(/^\s+/,""),o.push(d)):(a=a+c.ident,o.push(" ".repeat(a*e)+c.line),a=a+c.after)}}return o.join(`
`)}function Xe(s){const e=s.match(/^(\s*)/),i=e?e[1]:"",a=s.split(/(?=@\w+)/).map(o=>o.trim()).filter(Boolean);return a.length<=1?[s]:a.map(o=>i+o)}function Ge(s){const e={if:{ident:0,after:1},elseif:{ident:-1,after:1},else:{ident:-1,after:1},endif:{ident:-1,after:0},section:{ident:0,after:1,extended:{ident:0,after:0}},endsection:{ident:-1,after:0},foreach:{ident:0,after:1},endforeach:{ident:-1,after:0},forelse:{ident:0,after:1},endforelse:{ident:-1,after:0},for:{ident:0,after:1},endfor:{ident:-1,after:0},yield:{ident:1,after:-1},while:{ident:0,after:1},endwhile:{ident:-1,after:0},section:{ident:0,after:1},endsection:{ident:-1,after:0},switch:{ident:0,after:1},case:{ident:-1,after:1},endswitch:{ident:-1,after:0},endcase:{ident:-1,after:0},php:{ident:0,after:1},endphp:{ident:-1,after:0},livewire:{ident:0,after:1},endlivewire:{ident:-1,after:0},component:{ident:0,after:1},endcomponent:{ident:-1,after:0},slot:{ident:0,after:1},endslot:{ident:-1,after:0},props:{ident:0,after:0},error:{ident:0,after:1},enderror:{ident:-1,after:0},once:{ident:0,after:1},endonce:{ident:-1,after:0},push:{ident:0,after:1},endpush:{ident:-1,after:0},stack:{ident:0,after:1},endstack:{ident:-1,after:0},verbatim:{ident:0,after:1},endverbatim:{ident:-1,after:0},can:{ident:0,after:1},endcan:{ident:-1,after:0},cannot:{ident:0,after:1},endcannot:{ident:-1,after:0},auth:{ident:0,after:1},endauth:{ident:-1,after:0},guest:{ident:0,after:1},endguest:{ident:-1,after:0},mproauth:{ident:0,after:1},endmproauth:{ident:-1,after:0}};let i=(s.match(/@\w+/)||[null])[0];if(!i)return{ident:0,after:0,line:s};if(i=i.replace("@",""),!e[i])return{ident:0,after:0,line:s};let a=s.replace(new RegExp(`${i}\\s*\\(`,"g"),`${i}(`),o=e[i];return o.line=a,o.extended&&(a.match(new RegExp(`${i}\\(([^)]*)\\)`))||[null,""])[1].split(",").length>1?(o=e[i].extended,o.line=a,res):o}function Qe(s){const e={};let i=s.match(/\{% *setMeta\('title', *'([^']+)'/);return e.title=i?i[1]:null,i=s.match(/\{% *setMeta\('htmlDescr', *'([^']+)'/),e.description=i?i[1].trim():null,i=s.match(/\{% *setMeta\('keywords', *'([^']+)'/),e.keywords=i?i[1].trim():null,i=s.match(/\{% *setMeta\('h1', *'([^']+)'/),e.h1=i?i[1].trim():null,console.log(e),` @extends('magic::main',[
  'title' => '${e.title}',
  'description' => '${e.description}',
  'keywords' => '${e.keywords}'
])
  

<h1>${e.h1}</h1>

`+s}const G=Oe("article",()=>{const s=h({}),e=ee(()=>{if(s.value.name!=="")return/^[a-z0-9_-]+$/i.test(s.value.name)}),i=ee(()=>/{%\s*.*?\s*%}/.test(s.value.body)),a=h(!1),o=h(!1),n=h(!1),l="chrome",d=["chrome","monokai","dracula","twilight"],c=h("tree"),u=h(!1),T=h(""),E=h("");async function j(w){const S=await Y({command:"getById",id:w});s.value=z(S),history.pushState(w,null,"#"+w),u.value=!0,document.title=s.value.title}function z(w){let S=w.routeParams;(Array.isArray(S)||S===null||typeof S!="object")&&(S={});const{adminOnly:le=!1,useController:_=!0,getEnable:y=!1,utmParamsEnable:B=!0,bindKeys:ne=!1,keysArr:R=[]}=S;return w.routeParams={useController:_,adminOnly:le,getEnable:y,utmParamsEnable:B,bindKeys:ne,keysArr:R},w}async function K(){s.value=await Y({command:"saveById",article:s.value}),document.showToast("Сохранено")}async function H(){try{const w=await Y({command:"getDefaultController",id:1});s.value.controller=w.controller}catch(w){console.log(w)}}async function U(w){try{const S=await Y({command:"articleByName",name:w});window.open(location.pathname+"#"+S.id,"_blank")}catch{}}async function $(){try{const w=await Y({command:"getDefaultLiveWareController",id:1});s.value.controller=w.controller}catch(w){console.log(w)}}async function C(w){try{return await Y({command:"search",text:w})}catch(S){console.log(S)}}async function P(){const w=await Ke(s.value.body,2);s.value.body=w;const S=await fe(s.value.controller,2);s.value.controller=S,document.showToast("Отформатировано")}function f(){s.value.name=ve(s.value.title.trim())}const p=w=>{if(w.ctrlKey&&w.code==="KeyS"){w.preventDefault(),K();return}if(w.altKey&&w.code==="Digit4"){addPannel.value=!addPannel.value,w.preventDefault();return}if(w.altKey&&w.code==="Digit6"){splitStatusEditorObj.value.set("hideController"),w.preventDefault();return}if(w.altKey&&w.code==="Digit5"){splitStatusEditorObj.value.set("hideBlade"),w.preventDefault();return}if(w.altKey&&w.code==="Digit3"){const S=splitTreeStatusObj.value.status=="hideTree"?"normal":"hideTree";splitTreeStatusObj.value.set(S),w.preventDefault();return}};function b(){s.value.body=Qe(s.value.body)}const m=h(),k=h("open"),V=h(),D=h("full");return window.addEventListener("keydown",p),{article:s,statusHelp:a,statusAddPannel:o,statusFileManager:n,aceTheme:l,aceThemes:d,hasTwig:i,statusTranslitButton:e,hasTwig:i,statusLeftPannel:c,toggleTreeSplitter:m,modeTreeSplitter:k,toggleEditorSplitter:V,modeEditorSplitter:D,searchTextController:T,searchTextView:E,articleReady:u,loadRec:j,saveRec:K,getController:H,getLiveWareController:$,gotoArticleByName:U,formatDocument:P,translit:f,convertFromMro:b,search:C}}),Je={class:"row gx-2 py-2 mx-0",style:{background:"#ffff001f"}},Ze={class:"col-auto"},Ye=["href"],et={key:1,class:"btn btn-sm btn-secondary fas fa-external-link-alt"},tt={class:"col-3"},nt={class:"input-group input-group-sm"},at={key:0,class:"col-3"},st={class:"input-group input-group-sm"},lt={class:"col-1"},ot={class:"input-group input-group-sm"},rt={class:"col-auto"},it={key:1,class:"col-auto"},ct={class:"col-auto align-self-center"},ut={class:"col-auto"},dt={class:"col-auto"},mt=["value"],pt={class:"col text-end"},ft={__name:"TopMenu",setup(s){const e=G(),i=h(""),a=ee(()=>e.article.name==="index"?"/":"/"+e.article.name);return(o,n)=>(v(),g("div",Je,[t("div",Ze,[r(e).article.isRoute?(v(),g("a",{key:0,target:"_blank",class:"fas fa-external-link-alt btn btn-sm btn-primary",href:a.value},null,8,Ye)):(v(),g("span",et))]),t("div",tt,[t("div",nt,[N(t("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":n[0]||(n[0]=l=>r(e).article.name=l)},null,512),[[Q,r(e).article.name]]),r(e).statusTranslitButton?A("",!0):(v(),g("button",{key:0,class:"btn btn-sm btn-primary",onClick:n[1]||(n[1]=l=>r(e).translit())},"Translit→"))])]),r(e).statusTranslitButton?(v(),g("div",at,[t("div",st,[N(t("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":n[2]||(n[2]=l=>r(e).article.title=l)},null,512),[[Q,r(e).article.title]]),t("button",{class:"btn btn-sm btn-primary",onClick:n[3]||(n[3]=l=>r(e).saveRec())},"Save→")])])):A("",!0),t("div",lt,[t("div",ot,[N(t("input",{placeholder:"перейти",type:"text",class:"form-control","onUpdate:modelValue":n[4]||(n[4]=l=>i.value=l)},null,512),[[Q,i.value]]),t("button",{class:"btn btn-primary fas fa-angle-right",onClick:n[5]||(n[5]=l=>r(e).gotoArticleByName(i.value))})])]),t("div",rt,[t("span",{class:q(["btn btn-success",{"fas fas fa-sitemap":r(e).modeTreeSplitter=="hidden","fas fa-ellipsis-h":r(e).modeTreeSplitter==="open"}]),onClick:n[6]||(n[6]=l=>r(e).toggleTreeSplitter())},null,2)]),r(e).article.routeParams.useController?(v(),g("div",it,[t("span",{class:q(["btn btn-success",{"fas fa-angle-left":r(e).modeEditorSplitter==="full","fas fa-angle-right":r(e).modeEditorSplitter==="view","fa fa-columns":r(e).modeEditorSplitter==="controller"}]),onClick:n[7]||(n[7]=l=>r(e).toggleEditorSplitter())},null,2)])):A("",!0),t("div",ct,[t("button",{class:"btn fas fa-magic btn-success",onClick:n[8]||(n[8]=l=>r(e).formatDocument())},"1")]),t("div",ut,[t("button",{onClick:n[9]||(n[9]=l=>r(e).statusHelp=!r(e).statusHelp),class:"fas fa-question btn btn-success"})]),t("div",dt,[N(t("select",{"onUpdate:modelValue":n[10]||(n[10]=l=>r(e).aceTheme=l),class:"form-select form-select-sm"},[(v(!0),g(W,null,J(r(e).aceThemes,l=>(v(),g("option",{key:l,value:l},L(l),9,mt))),128))],512),[[ge,r(e).aceTheme]])]),t("div",pt,[r(e).hasTwig?(v(),g("button",{key:0,class:"btn btn-success fas fa-sync-alt btn-sm me-2",onClick:n[11]||(n[11]=l=>r(e).convertFromMro())})):A("",!0),t("button",{class:"btn btn-success fas fa-folder-open",onClick:n[12]||(n[12]=l=>r(e).statusFileManager=!r(e).statusFileManager)}),t("button",{class:"ms-1 btn btn-success fas fa-bars",onClick:n[13]||(n[13]=l=>r(e).statusAddPannel=!r(e).statusAddPannel)})])]))}},vt={class:""},gt={class:"my-2 d-flex"},ht={class:"nowrap"},yt={class:"d-flex my-2"},_t={class:"nowrap"},bt={class:"my-2 d-flex"},wt={class:"nowrap"},$t={key:0},kt={class:"d-flex my-2"},Tt={class:"nowrap"},xt={class:"d-flex my-2"},Ct={class:"nowrap"},St={class:"d-flex my-2"},Pt={class:"nowrap"},Rt={class:"ms-2"},At={key:0},Et={class:"d-table"},Vt={class:"d-table-cell px-1 py-1 align-middle",style:{"min-width":"300px"}},Ut=["onUpdate:modelValue"],zt={class:"d-table-cell px-1 py-1"},Lt=["onClick"],Mt={class:"d-table-cell px-1 py-1"},Dt=["onClick"],Ft={class:"d-table-cell px-1 py-1"},Bt=["onClick"],Ot={class:"row my-2"},Nt={class:"col-9"},It={class:"col-1"},Ht={key:1,class:"fas fa-plus"},jt={key:0,class:"d-flex my-2"},Kt={class:"nowrap"},Wt={class:"mt-5"},qt={class:"my-2"},Xt={class:"my-2"},Gt=["href"],Qt={__name:"RouteParam",setup(s){const e=G(),i=h(""),a=h("");return(o,n)=>{const l=I("ToggleSwitch"),d=I("Drawer");return v(),X(d,{visible:r(e).statusAddPannel,"onUpdate:visible":n[11]||(n[11]=c=>r(e).statusAddPannel=c),header:"Параметры",position:"right",style:{width:"600px"}},{default:M(()=>[t("div",vt,[t("div",gt,[t("div",ht,[x(l,{modelValue:r(e).article.menuOn,"onUpdate:modelValue":n[0]||(n[0]=c=>r(e).article.menuOn=c)},null,8,["modelValue"])]),n[12]||(n[12]=t("div",{class:"ms-2"},"menu",-1))]),t("div",yt,[t("div",_t,[x(l,{modelValue:r(e).article.routeParams.useController,"onUpdate:modelValue":n[1]||(n[1]=c=>r(e).article.routeParams.useController=c)},null,8,["modelValue"])]),n[13]||(n[13]=t("div",{class:"ms-2"},[O(" Испольовать контроллер "),t("div",{class:"small"},"Если нет, то будет вызываться просто вьюха")],-1))]),t("div",bt,[t("div",wt,[x(l,{modelValue:r(e).article.isRoute,"onUpdate:modelValue":n[2]||(n[2]=c=>r(e).article.isRoute=c)},null,8,["modelValue"])]),n[14]||(n[14]=t("div",{class:"ms-2"},"route",-1))]),r(e).article.isRoute?(v(),g("div",$t,[t("div",kt,[t("div",Tt,[x(l,{modelValue:r(e).article.routeParams.adminOnly,"onUpdate:modelValue":n[3]||(n[3]=c=>r(e).article.routeParams.adminOnly=c)},null,8,["modelValue"])]),n[15]||(n[15]=t("div",{class:"ms-2"},"Только Админ (для отладки)",-1))]),t("div",xt,[t("div",Ct,[x(l,{modelValue:r(e).article.routeParams.utmParamsEnable,"onUpdate:modelValue":n[4]||(n[4]=c=>r(e).article.routeParams.utmParamsEnable=c)},null,8,["modelValue"])]),n[16]||(n[16]=t("div",{class:"ms-2"},"Разрешить Utm ?=utm...",-1))]),t("div",St,[t("div",Pt,[x(l,{modelValue:r(e).article.routeParams.getEnable,"onUpdate:modelValue":n[5]||(n[5]=c=>r(e).article.routeParams.getEnable=c)},null,8,["modelValue"])]),t("div",Rt,[n[20]||(n[20]=t("div",null,"Использовать GET параметры",-1)),r(e).article.routeParams.getEnable?(v(),g("div",At,[n[18]||(n[18]=t("div",{class:"mt-2"},"Допустимые параметры",-1)),n[19]||(n[19]=t("div",{class:"small"},"Если пусто то все",-1)),t("div",Et,[(v(!0),g(W,null,J(r(e).article.routeParams.keysArr,(c,u)=>(v(),g("div",{class:"d-table-row",key:u},[t("div",Vt,[N(t("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":T=>r(e).article.routeParams.keysArr[u]=T},null,8,Ut),[[Q,r(e).article.routeParams.keysArr[u]]])]),t("div",zt,[N(t("i",{class:"fas fa-arrow-circle-down",onClick:T=>{r(e).article.routeParams.swap=r(e).article.routeParams.keysArr[u+1],r(e).article.routeParams.keysArr[u+1]=r(e).article.routeParams.keysArr[u],r(e).article.routeParams.keysArr[u]=r(e).article.routeParams.swap,delete r(e).article.routeParams.swap}},null,8,Lt),[[ce,r(e).article.routeParams.keysArr.length-1>u&&r(e).article.routeParams.bindKeys]])]),t("div",Mt,[u>0&&r(e).article.routeParams.bindKeys?(v(),g("i",{key:0,class:"fas fa-arrow-circle-up",onClick:T=>{a.value=r(e).article.routeParams.keysArr[u-1],r(e).article.routeParams.keysArr[u-1]=r(e).article.routeParams.keysArr[u],r(e).article.routeParams.keysArr[u]=a.value}},null,8,Dt)):A("",!0)]),t("div",Ft,[t("i",{class:"fas fa-trash",onClick:T=>r(e).article.routeParams.keysArr.splice(u,1)},null,8,Bt)])]))),128))]),t("div",Ot,[t("div",Nt,[N(t("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":n[6]||(n[6]=c=>i.value=c)},null,512),[[Q,i.value]])]),t("div",It,[i.value.trim()!=""?(v(),g("span",{key:0,class:"fas fa-plus",onClick:n[7]||(n[7]=c=>{r(e).article.routeParams.keysArr.push(i.value),i.value=""})})):(v(),g("span",Ht))])]),r(e).article.routeParams.keysArr.length>0?(v(),g("div",jt,[t("div",Kt,[x(l,{modelValue:r(e).article.routeParams.bindKeys,"onUpdate:modelValue":n[8]||(n[8]=c=>r(e).article.routeParams.bindKeys=c)},null,8,["modelValue"])]),n[17]||(n[17]=t("div",{class:"ms-2"},[t("div",null,"Привязывать параметры"),t("div",{class:"small"},"Только для параметорв в / /")],-1))])):A("",!0)])):A("",!0)])])])):A("",!0),t("div",Wt,[t("button",{class:"btn btn-success btn-sm",onClick:n[9]||(n[9]=c=>r(e).getController())},"Обычный контроллер")]),t("div",qt,[t("button",{class:"btn btn-success btn-sm",onClick:n[10]||(n[10]=c=>r(e).getLiveWareController())},"LiveWare контроллер")]),t("div",Xt,[t("a",{href:"http://mpro2.test/a_dmin/api/exportArticle?id="+r(e).article.id,class:"btn btn-success btn-sm"}," Экспорт ",8,Gt)])]),t("pre",null,"        "+L(r(e).article)+`
    `,1)]),_:1},8,["visible"])}}},Jt={__name:"Help",setup(s){const e=G();return(i,a)=>{const o=I("Dialog");return v(),X(o,{visible:r(e).statusHelp,"onUpdate:visible":a[0]||(a[0]=n=>r(e).statusHelp=n),header:"Справка",modal:"",class:"w-50"},{default:M(()=>[...a[1]||(a[1]=[t("ul",{class:"list-unstyled m-0"},[t("li",null,[t("kbd",null,"Ctrl+S"),O(" — сохранить")]),t("li",null,[t("kbd",null,"Shift_"),O(" — снипеты блейда")]),t("li",null,[t("kbd",null,"Alt+1"),O(" — перейти в статье по выбранному слову")]),t("li",null,[t("kbd",null,"Alt+3"),O(" — панель дерева")]),t("li",null,[t("kbd",null,"Alt+4"),O(" — боковое меню")]),t("li",null,[t("kbd",null,"Alt+5"),O(" — панель контроллера")]),t("li",null,[t("kbd",null,"Alt+6"),O(" — скрыть/отобразить панель блейда")])],-1)])]),_:1},8,["visible"])}}};function Zt(){const s=pe.require("ace/mode/html_highlight_rules").HtmlHighlightRules;if(s.__bladePatched)return;const e=[{token:"comment",regex:/\{\{\-\-[\s\S]*?\-\-\}\}/},{token:"variable",regex:/\{\{[\s\S]*?\}\}/},{token:"entity.name.function",regex:/@[A-Za-z_]\w*/}],i=s.prototype.getRules;s.prototype.getRules=function(){const a=i.call(this);for(const o in a)a[o].unshift(...e);return a},s.__bladePatched=!0}function Yt(s){const e=[{tabTrigger:"",name:"_@auth",content:`@auth
	$0
@endauth`},{tabTrigger:"",name:"_@can",content:`@can(\${1:ability})
	$0
@endcan`},{tabTrigger:"",name:"_@cannot",content:`@cannot(\${1:ability})
	$0
@endcannot`},{tabTrigger:"",name:"_@csrf",content:"@csrf"},{tabTrigger:"",name:"_@dd",content:"@dd(${1:var})"},{tabTrigger:"",name:"_@dump",content:"@dump(${1:var})"},{tabTrigger:"",name:"_@else",content:`@else
	$0`},{tabTrigger:"",name:"_@elseif",content:"@elseif ($${1:user}->${2:active})"},{tabTrigger:"",name:"_@empty",content:`@empty ($\${1:arr})
	$0
@endempty`},{tabTrigger:"",name:"_@endauth",content:"@endauth"},{tabTrigger:"",name:"_@endcan",content:"@endcan"},{tabTrigger:"",name:"_@endcannot",content:"@endcannot"},{tabTrigger:"",name:"_@endempty",content:"@endempty"},{tabTrigger:"",name:"_@endforeach",content:"@endforeach"},{tabTrigger:"",name:"_@endif",content:"@endif"},{tabTrigger:"",name:"_@endfor",content:"@endfor"},{tabTrigger:"",name:"_@endguest",content:"@endguest"},{tabTrigger:"",name:"_@endisset",content:"@endisset"},{tabTrigger:"",name:"_@endonce",content:"@endonce"},{tabTrigger:"",name:"_@endprepend",content:"@endprepend"},{tabTrigger:"",name:"_@endphp",content:"@endphp"},{tabTrigger:"",name:"_@endpush",content:"@endpush"},{tabTrigger:"",name:"_@endsection",content:"@endsection"},{tabTrigger:"",name:"_@endswitch",content:"@endswitch"},{tabTrigger:"",name:"_@endwhile",content:"@endwhile"},{tabTrigger:"",name:"_@env",content:`@env(\${1:environment})
	$0
@endenv`},{tabTrigger:"",name:"_@error",content:`@error('\${1:field}')
	<div class="text-danger">{{ $message }}</div>
@enderror`},{tabTrigger:"",name:"_@extends",content:"@extends('${1:layout}')"},{tabTrigger:"",name:"_@for",content:"@for ($${1:i} = 0; $${1:i} < ${2:10}; $${1:i}++)\n	$0\n@endfor"},{tabTrigger:"",name:"_@foreach",content:"@foreach ($${1:items} as $${2:item})\n	$0\n@endforeach"},{tabTrigger:"",name:"_@foreach index",content:"@foreach ($${1:items} as $${2:ndex} => $${3:item})\n	$0\n@endforeach"},{tabTrigger:"",name:"_@guest",content:`@guest
	$0
@endguest`},{tabTrigger:"",name:"_@if",content:`@if ($\${1:var} > 0)
	$0
@endif`},{tabTrigger:"",name:"_@include",content:"@include('magic::${1:view}', [${2:data}])"},{tabTrigger:"",name:"_@includeFirst",content:"@includeFirst(['magic::${1:view1}', 'magic::${2:view2}'])"},{tabTrigger:"",name:"_@includeIf",content:"@includeIf('magic::${1:view}', [${2:data}])"},{tabTrigger:"",name:"_@includeWhen",content:"@includeWhen(${1:condition}, 'magic::${2:view}', [${3:data}])"},{tabTrigger:"",name:"_@includeUnless",content:"@includeUnless(${1:condition}, 'magic::${2:view}', [${3:data}])"},{tabTrigger:"",name:"_@isset",content:`@isset ($\${1:var})
	$0
@endisset`},{tabTrigger:"",name:"_@json",content:"@json(${1:data})"},{tabTrigger:"",name:"_@method",content:"@method('${1:PUT}')"},{tabTrigger:"",name:"_@once",content:`@once
	$0
@endonce`},{tabTrigger:"",name:"_@php",content:`@php
	$0
@endphp`},{tabTrigger:"",name:"_@prepend",content:`@prepend('\${1:stack}')
	$0
@endprepend`},{tabTrigger:"",name:"_@production",content:`@production
	$0
@endproduction`},{tabTrigger:"",name:"_@props",content:"@props(['${1:variable}' => ${2:default}])"},{tabTrigger:"",name:"_@push",content:`@push('\${1:stack}')
	$0
@endpush`},{tabTrigger:"",name:"_@section (block)",content:`@section('\${1:name}')
	$0
@endsection`},{tabTrigger:"",name:"_@section (inline)",content:"@section('${1:name}', '${2:content}')"},{tabTrigger:"",name:"_@stack",content:"@stack('${1:stack}')"},{tabTrigger:"",name:"_@switch",content:`@switch ($\${1:value})
	@case($\${2:key})
		$0
	@break
@endswitch`},{tabTrigger:"",name:"_@unless",content:`@unless ($\${1:cond})
	$0
@endunless`},{tabTrigger:"",name:"_@verbatim",content:`@verbatim
	$0
@endverbatim`},{tabTrigger:"",name:"_@while",content:`@while ($\${1:flag})
	$0
@endwhile`},{tabTrigger:"",name:"_@yield",content:"@yield('${1:section}')"},{tabTrigger:"",name:"_<x-magic",content:'<x-magic::${1:anonymus} :data="$${1:value}"></x-magic::${1:anonymus}>)'}],i=e.map(c=>c.tabTrigger.replace("@",""));ace.require("ace/snippets").snippetManager.register(e,"html");const o=ace.require("ace/autocomplete").Autocomplete,n=o.prototype.showPopup,l=o.prototype.updateCompletions;function d(c){c&&Array.isArray(c.data)&&(c.data=c.data.filter(u=>!i.includes(u.value)),c.setData(c.data))}o.prototype.showPopup=function(c){n.call(this,c),d(this.popup)},o.prototype.updateCompletions=function(c){l.call(this,c),d(this.popup)},s.commands.addCommand({name:"toggleLineMarkersCommand",bindKey:{win:"Alt-/",mac:"Alt-/"},exec:nn,readOnly:!1})}function en(s){let e,i;if(s.getSelectionRange().isEmpty()){const a=s.getCursorPosition();s.selection.selectLine(a.row),e=i=a.row}else{const a=s.getSelectionRange(),o=ace.require("ace/range").Range;e=a.start.row,i=a.end.row;const n=new o(e,0,i,s.session.getLine(i).length);s.selection.setRange(n)}return{startRow:e,endRow:i}}function tn(s){return/{{--.*--}}/.test(s)?(s=s.replace(/^\s*{{--\s?/,""),s=s.replace(/\s?--}}\s*$/,""),s):`{{-- ${s} --}}`}function nn(s){const{startRow:e,endRow:i}=en(s),a=s.session,o=ace.require("ace/range").Range;for(let n=e;n<=i;n++){const l=a.getLine(n),d=tn(l),c=l.length;a.replace(new o(n,0,n,c),d)}}const an=["id"],de={__name:"AceEditor",props:he({lang:{type:String,default:"html",validator:s=>["html","php","blade"].includes(s)},theme:{type:String,default:"monokai"},readOnly:{type:Boolean,default:!1},tabSize:{type:Number,default:4},wrap:{type:Boolean,default:!1},height:{type:Number,default:100}},{modelValue:{type:String,default:"XXXXXXXX"},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const e=G(),i=h(ye()),a=s,o=_e(s,"modelValue"),n=h(null);let l=null;const d=()=>a.lang==="php"?"ace/mode/php":"ace/mode/html",c=u=>`ace/theme/${u}`;return se(()=>{Zt(),l=pe.edit(i.value,{value:o.value,mode:d(a.lang),theme:c(a.theme),readOnly:a.readOnly,wrap:a.wrap,tabSize:a.tabSize,useWorker:!1}),l.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableEmmet:!0}),l.setFontSize(14),l.commands.addCommand({name:"sendSelectedToParent",bindKey:{win:"Alt-1",mac:"Alt-1"},exec(u){const T=u.session.getTextRange(u.getSelectionRange());if(T.trim()===""){document.showToast("Статья не выделена");return}e.gotoArticleByName(T)}}),a.lang!=="php"&&Yt(l),l.session.on("change",()=>{o.value=l.getValue()}),a.lang==="php"&&F(()=>e.searchTextController,u=>{u.trim()&&(l.find(u),l.execCommand("find"),e.searchTextController="")}),a.lang==="html"&&F(()=>e.searchTextView,u=>{u.trim()&&(l.find(e.searchTextView),l.execCommand("find"),e.searchTextView="")})}),F(o,u=>{if(!l)return;const T=l.getValue();u!==T&&l.setValue(u)}),be(()=>l?.destroy()),F(()=>a.lang,u=>l?.session.setMode(d())),F(()=>a.theme,u=>l?.setTheme(c(u))),F(()=>a.readOnly,u=>l?.setReadOnly(u)),F(()=>a.tabSize,u=>l?.session.setTabSize(u)),F(()=>a.wrap,u=>l?.session.setUseWrapMode(u)),(u,T)=>(v(),g("div",{style:Z("height: "+s.height+"px; width: 100%; position: relative;")},[t("div",{ref_key:"el",ref:n,id:i.value,style:{width:"100%",height:"100%"}},null,8,an)],4))}},sn={class:"ms-2 tree-pannel"},ln=["onDragover"],on=["onClick"],rn=["onContextmenu","onClick"],cn={key:0,class:"icon-small fa-link fas mx-1"},un={key:1,class:"icon-small fas fa-eye mx-1"},dn={__name:"TreeArticle",setup(s){const e=G();F(()=>e.article.id,()=>{u(e.article.id)}),F(()=>e.article,()=>{e?.article?.title&&typeof a?.text!=null&&(a.text=e?.article?.title,a.menuOn=e?.article?.menuOn,a.isRoute=e?.article?.isRoute,document.title=e.article.title)},{deep:!0}),se(()=>{u(e.article.id)});function i(f,p){p(f),f?.children&&f.children.forEach(b=>{i(b,p)})}let a=null;const o=h(e.article.id);F(o,()=>{e.loadRec(o.value)});const n=h(0),l=h([]),d=h(),c=h([]);async function u(f){const p=await apiArt({command:"makeHeTree",id:f});o.value=f,l.value=p,i(l.value[0],b=>{b.lazy=!!(b?.directory&&!b?.children),b?.id===f&&(a=b)})}async function T(f,p,b){try{const m=await apiArt({command:"createNew",id:f.id}),k={id:m.id,text:m.title,parentId:m.parentId,directory:!1,npp:f.npp,children:[]},V=p;b.add(k,V,p.children.length),V.open=!0,o.value=m.id,document.showToast("Создано")}catch{return}}async function E(f,p,b){if(f.id==1){document.showToast("Не стоит удалять root");return}if(!await document.confirmDialog("Удалить ?"+f.id))return;const m=p.parent;m||document.showToast("Ошибка удаления parent не найден","error");let k;try{k=await apiArt({command:"deleteById",id:f.id})}catch{return}if(!b.remove(p)){document.showToast("Ошибка удаления элемента, перезагрузите","error");return}o.value=m.data.id??null,m.open=!0,m.data.directory=k.directory,m.data.text=k.title,b.openNodeAndParents(m),document.showToast("Удалено")}function j(f,p,b,m){c.value=[{label:"Новой вкладке",icon:"fas fa-link",command:()=>{window.open(location.pathname+"#"+p.id,"_blank")}},{label:"Создать",icon:"fas fa-plus",command:()=>T(p,b,m)},{label:"Удалить",icon:"fas fa-trash",command:()=>E(p,b,m)},{label:"Копировать",icon:"fas fa-copy",command:()=>z(p,b,m)}],d.value.show(f)}async function z(f,p,b){try{const m=await apiArt({command:"copyRec",id:f.id}),k={id:m.id,text:m.title,parentId:f.id,directory:!1,npp:f.npp,children:[]},V=p.parent;b.add(k,V,f.npp),V.open=!0,o.value=m.id,document.showToast("Скопировано")}catch{return}}function K(f,p){o.value=f.id}async function H(f,p,b){if(f.lazy&&!p?.data?.lazyLoad){p.data.lazyLoad=!0;let m;try{f._loading=!0,m=await apiArt({command:"getChildrens",id:f.id}),lazyLoad=!1}catch{}finally{f._loading=!1,p.data.lazy=!1}b.batchUpdate(()=>{b.addMulti(m,p,p.children.length),p.open=!0})}else p.open=!p.open}let U=null;function $(){const{dragNode:f}=ue,p=f.parent??null,b=p?p.children.indexOf(f):0;U={parent:p,index:b},o.value=f.data.id}async function C(){const{dragNode:f,targetInfo:p}=ue,b=f.data.id;if(b===1){P(f);return}const m=p?.parent??null,k=m?.data?.id??null;if(!k){P(f);return}const V=p.siblings??m.children??[],D=V.findIndex(S=>S===f||S.data?.id===b),w=D>0?V[D-1].data?.id??0:0;try{const S=await apiArt({command:"move",id:b,newParentId:k,idBrotherUp:w});m&&(m.open=!0)}catch{P(f);return}}function P(f){const{targetTree:p}=ue;U?.parent&&p&&(p.move(f,U.parent,U.index),U.parent.open=!0)}return(f,p)=>{const b=I("ContextMenu");return v(),g("div",sn,[(v(),X(r(Ie),{class:"mtl-tree my-2",modelValue:l.value,"onUpdate:modelValue":p[0]||(p[0]=m=>l.value=m),key:n.value,onAfterDrop:C,ondragstart:$,treeLine:""},{default:M(({node:m,stat:k,tree:V})=>[t("div",{class:"d-flex pointer",onDragover:ae(D=>m.lazy?H(m,k,V):"",["stop","prevent"])},[t("div",null,[k.children.length?(v(),X(r(Ne),{key:0,open:k.open,class:"m-0 p-0",onClick:D=>k.open=!k.open},null,8,["open","onClick"])):A("",!0)]),m.lazy?(v(),g("div",{key:0,onClick:D=>H(m,k,V)},[...p[1]||(p[1]=[t("i",{class:"fas fa-chevron-right me-1"},null,-1)])],8,on)):A("",!0),t("div",{onContextmenu:ae(D=>j(D,m,k,V),["prevent"]),class:q({active:m.id==o.value,notroute:!m.isRoute,route:m.isRoute}),onClick:D=>K(m,k)},[t("span",{style:Z(m.directory?"margin-left:-3px":"margin-left:3px")},null,4),O(L(m.text)+" ",1),m.isRoute?(v(),g("i",cn)):A("",!0),m.menuOn?(v(),g("i",un)):A("",!0)],42,rn)],40,ln)]),_:1},8,["modelValue"])),x(b,{ref_key:"menu",ref:d,model:c.value},null,8,["model"])])}}},mn={class:"ms-2 tree-pannel"},pn={class:"row my-1"},fn={class:"input-group input-group-sm"},vn=["textContent","onClick"],gn={__name:"FindText",setup(s){const e=G(),i=h([]),a=h("");async function o(){i.value=await e.search(a.value)}async function n(l){await e.loadRec(l),e.article.body.search(a.value)>=0&&(e.searchTextView=a.value),e.article.controller.search(a.value)>=0&&(e.searchTextController=a.value)}return(l,d)=>(v(),g("div",mn,[t("div",pn,[t("div",fn,[t("button",{class:"btn btn-primary fas fa-times",onClick:d[0]||(d[0]=c=>r(e).statusLeftPannel="tree")}),N(t("input",{placeholder:"найти",type:"text",class:"form-control","onUpdate:modelValue":d[1]||(d[1]=c=>a.value=c)},null,512),[[Q,a.value]]),t("button",{class:"btn btn-primary fas fa-angle-right",onClick:d[2]||(d[2]=c=>o())})])]),(v(!0),g(W,null,J(i.value,c=>(v(),g("div",null,[t("span",{textContent:L(c.title),onClick:u=>n(c.id),class:q(["pointer",{active:r(e).article.id==c.id}])},null,10,vn)]))),256))]))}},hn=je(gn,[["__scopeId","data-v-f8b286bb"]]),yn={key:0},_n={style:{position:"relative"}},bn={__name:"EditArticle",setup(s){const e=G(),i=h({show:!1,x:0,y:0});function a(){e.article.routeParams.useController||(E.value=0,z.value="view"),e.article.routeParams.useController&&(E.value=50,z.value="full"),e.modeEditorSplitter=z.value,T.value.resetState()}const o=h(null),n=h(20);let l=0;const d=h("open"),c=U=>{n.value=U.sizes[0]};function u(){d.value=="open"?(l=n.value,n.value=0,d.value="hidden"):(n.value=l,d.value="open"),e.modeTreeSplitter=d.value,o.value.resetState()}const T=h(),E=h(50);let j=0;const z=h("full");F(T,()=>{a()});function K(U){E.value=U.sizes[0]}function H(){switch(z.value){case"full":j=E.value,E.value=0,z.value="view";break;case"view":E.value=100,z.value="controller";break;case"controller":E.value=j,z.value="full";break}e.modeEditorSplitter=z.value,T.value.resetState()}return se(()=>{const U=document.getElementById("editor-layer").getBoundingClientRect();i.value.y=window.innerHeight-U.top,i.value.x=window.innerWidth,i.value.show=!0,e.toggleTreeSplitter=u,e.toggleEditorSplitter=H,F(()=>e.article.routeParams.useController,()=>{a()})}),(U,$)=>{const C=I("SplitterPanel"),P=I("Splitter");return v(),g("div",null,[t("div",{style:Z({height:i.value.y+"px",width:i.value.x+"px"}),id:"editor-layer"},[i.value.show?(v(),g("div",yn,[x(P,{style:Z({height:i.value.y+"px",width:i.value.x+"px"}),onResizeend:c,ref_key:"splitterTreeRef",ref:o},{default:M(()=>[x(C,{size:n.value,minSize:0},{default:M(()=>[t("div",_n,[N(t("button",{style:{position:"absolute",right:"10px","z-index":"1000"},class:"btn btn-primary fas fa-search",onClick:$[0]||($[0]=f=>r(e).statusLeftPannel="find")},null,512),[[ce,r(e).statusLeftPannel==="tree"]])]),N(x(dn,null,null,512),[[ce,r(e).statusLeftPannel==="tree"]]),N(x(hn,null,null,512),[[ce,r(e).statusLeftPannel==="find"]])]),_:1},8,["size"]),x(C,{size:100-n.value,minSize:1},{default:M(()=>[x(P,{style:{height:"100%"},onResizeend:K,ref_key:"splitEditorRef",ref:T},{default:M(()=>[x(C,{size:E.value,minSize:1},{default:M(()=>[x(de,{modelValue:r(e).article.controller,"onUpdate:modelValue":$[1]||($[1]=f=>r(e).article.controller=f),lang:"php",theme:r(e).aceTheme,height:i.value.y},null,8,["modelValue","theme","height"])]),_:1},8,["size"]),x(C,{size:100-E.value,minSize:1},{default:M(()=>[x(de,{modelValue:r(e).article.body,"onUpdate:modelValue":$[2]||($[2]=f=>r(e).article.body=f),lang:"html",theme:r(e).aceTheme,height:i.value.y},null,8,["modelValue","theme","height"])]),_:1},8,["size"])]),_:1},512)]),_:1},8,["size"])]),_:1},8,["style"])])):A("",!0)],4)])}}},wn={class:"d-flex"},$n=["src"],kn={class:"flex-grow-1"},Tn={key:0,class:"text-danger"},xn={key:0},Cn={key:0,class:"text-danger ms-2"},Sn=["onClick"],Pn={class:"progress mt-2",style:{height:"10px"}},Rn={__name:"UploadFile",props:{path:{type:String,required:!0},directory:{type:Object,required:!0}},emits:["uploaded"],setup(s,{expose:e,emit:i}){const a=i,o=s,n=h(!1),l=h(!1),d=h([]),c=ee(()=>new Set((o.directory??[]).map($=>($.name??"").toLowerCase())));function u(){n.value=!0}function T(){n.value=!1,d.value=[]}function E($,C){return new Promise((P,f)=>{const p=new XMLHttpRequest,b=new URLSearchParams({command:"uploadBin",path:o.path,filename:$.name});p.open("POST",`/a_dmin/api/fileManager?${b.toString()}`,!0),p.responseType="json",p.upload.onprogress=m=>{m.lengthComputable&&(d.value[C].progress=Math.round(m.loaded/m.total*100))},p.onload=()=>{const m=p.response;if(d.value[C].progress=100,d.value[C].status=p.status===200&&m?.status===!0?"ok":"error",d.value[C].status==="ok")a("uploaded",m.data),P(m.data);else{const k=m?.errorMsg||m?.message||`Ошибка загрузки (${p.status})`;f(new Error(k))}},p.onerror=()=>{d.value[C].status="error",f(new Error("Ошибка сети при загрузке файла"))},p.onabort=()=>{d.value[C].status="error",f(new Error("Загрузка отменена"))},p.setRequestHeader("Content-Type","application/octet-stream"),p.send($)})}async function j($){const C=Array.isArray($?.files)?$.files:[];C.length&&(d.value=C.map(P=>({name:P.name,progress:0,status:"loading"})),l.value=!0,await Promise.all(C.map(async(P,f)=>{try{await E(P,f)}catch(p){document.showToast(p.message||"Ошибка загрузки файла","error")}})),l.value=!1,U.value?.clear())}function z($){return c.value.has($.toLowerCase())}function K($){return URL.createObjectURL($)}function H($){return!!$&&typeof $.type=="string"&&$.type.startsWith("image/")}const U=h(null);return e({open:u,close:T}),($,C)=>{const P=I("FileUpload"),f=I("Dialog");return v(),X(f,{visible:n.value,"onUpdate:visible":C[0]||(C[0]=p=>n.value=p),modal:"",header:"Загрузка файлов",class:"w-50"},{default:M(()=>[x(P,{name:"files[]",mode:"advanced",multiple:"",chooseLabel:"Выбрать файлы",uploadLabel:"Загрузить",cancelLabel:"Отмена",customUpload:"",auto:!1,maxFileSize:5e8,ref_key:"uploader",ref:U,onUploader:j},{content:M(({files:p})=>[(v(!0),g(W,null,J(p,(b,m)=>(v(),g("div",{key:b.name,class:"mb-2"},[t("div",null,[t("div",wn,[t("div",null,[H(b)?(v(),g("img",{key:0,src:K(b),alt:"",style:{width:"96px",height:"auto"},class:"me-2 rounded border"},null,8,$n)):A("",!0)]),t("div",kn,[t("div",null,[t("small",null,L(b.name),1)]),z(b.name)&&!l.value?(v(),g("div",Tn,"копия — будет переписан")):A("",!0),t("div",null,[d.value[m]?(v(),g("small",xn,L(d.value[m].progress)+"%",1)):A("",!0)])]),z(b.name)?(v(),g("div",Cn,[t("i",{class:"fas fa-times pointer",onClick:k=>p.splice(m,1)},null,8,Sn)])):A("",!0)])]),t("div",Pn,[t("div",{class:q(["progress-bar",{"bg-success":d.value[m]?.status==="ok","bg-danger":d.value[m]?.status==="error","progress-bar-striped progress-bar-animated":d.value[m]?.status==="loading"}]),role:"progressbar",style:Z({width:(d.value[m]?.progress||0)+"%"})},null,6)])]))),128))]),_:1},512)]),_:1},8,["visible"])}}},An={class:"me-2 icon"},En={key:0},Vn={class:"ms-1",style:{"font-size":"85%"}},Un={key:0,class:"thumb-pic"},zn=["src"],Ln={class:"file-name"},Mn={key:1,class:"thumb-file"},Dn={class:"fs-5 d-inline-block bg-dark text-light rounded px-2"},Fn={style:{"word-break":"break-all"}},Bn={__name:"FileItem",props:{el:{type:Object,required:!0},viewFull:Boolean,viewSize:Number,path:String,onRightClick:Function},setup(s){const e=s,i=ee(()=>{const o=e.el.name||"";return o.includes(".")?o.split(".").pop().toLowerCase():""});function a(o,n){return o>=n?"width:"+(e.viewSize-2)+"px;":"height:"+(e.viewSize-2)+"px;"}return(o,n)=>s.viewFull?(v(),g("div",{key:1,class:"thumb",style:Z(`width:${s.viewSize}px;height:${s.viewSize}px`),onContextmenu:n[1]||(n[1]=ae(l=>s.onRightClick(l,s.el),["prevent"]))},[s.el.isImage?(v(),g("div",Un,[t("img",{src:s.path+s.el.name+"?"+s.el.date,style:Z(a(s.el.width,s.el.height))},null,12,zn),t("div",Ln,[O(L(s.el.name),1),n[2]||(n[2]=t("br",null,null,-1)),O("("+L(s.el.width)+"x"+L(s.el.height)+")",1)])])):(v(),g("div",Mn,[t("div",Dn,L(i.value),1),t("div",Fn,L(s.el.name),1)]))],36)):(v(),g("div",{key:0,class:"d-flex my-1",onContextmenu:n[0]||(n[0]=ae(l=>s.onRightClick(l,s.el),["prevent"]))},[t("div",An,[t("i",{class:q({"far fa-file-image":s.el.isImage,"far fa-file":!s.el.isImage})},null,2)]),t("div",null,[O(L(s.el.name)+" ",1),s.el.isImage?(v(),g("span",En,[t("span",Vn,"("+L(s.el.width)+"x"+L(s.el.height)+")",1)])):A("",!0)])],32))}},On={class:"d-flex align-items-center gap-2 p-1 rounded w-100 border"},Nn={class:"flex-grow-1"},In=["onClick"],Hn={key:0,class:"mt-2"},jn={key:0,class:"my-5 py-5 text-center"},Kn={class:"d-flex folder"},Wn={class:"me-2"},qn=["onClick"],Xn=["onContextmenu","onClick"],Gn={key:1,class:"text-center p-3"},Qn={class:"mb-3"},Jn={__name:"FileManager",setup(s){const e=G(),i=h(null),a=h("/design/"),o=h("/design/");o.value=a.value;const n=h({}),l=h([]),d=h(!0),c=h(160),u=h(!1),T=h(!1),E=h("");se(async()=>{await K(o.value),await P(o.value)});async function j(){l.value.length>0&&(o.value=l.value.pop()),await P(o.value)}function z(){E.value="",T.value=!0}async function K(){try{u.value=!1;const _=await ie({command:"start"});a.value=_.startDirectory,o.value=_.startDirectory}catch(_){console.error(_)}finally{u.value=!0}}async function H(){if(E.value.trim())try{u.value=!1,await ie({command:"mkdir",path:o.value,name:E.value.trim()}),await P(o.value)}catch(_){console.error(_)}finally{T.value=!1,u.value=!0}}function U(){i.value.open()}async function $(_){try{u.value=!1,l.value.push(o.value),o.value=o.value+_+"/",await P(o.value)}catch(y){console.error(y)}finally{u.value=!0}}function C(_){document.showToast("Загружен "+_.name),n.value=n.value.filter(y=>y.name!==_.name),n.value.unshift(_)}async function P(_){try{u.value=!1,n.value=await ie({command:"dirList",path:_})}catch(y){console.error(y)}finally{u.value=!0}}async function f(_){if(await document.confirmDialog("Удалить?"+o.value+_))try{u.value=!1,await ie({command:"delete",path:o.value,name:_}),n.value=n.value.filter(y=>y.name!==_),document.showToast("Удален "+_)}catch(y){console.error(y)}finally{u.value=!0}}function p(_){const y=document.createElement("textarea");y.value=_,y.style.position="fixed",y.style.opacity="0",document.body.appendChild(y),y.select(),y.setSelectionRange(0,y.value.length);try{const B=document.execCommand("copy");document.showToast(B?"Скопирована ссылка "+_:"Ошибка копирования ссылки",B?"success":"error")}catch{document.showToast("Ошибка копирования ссылки","error")}finally{document.body.removeChild(y)}}function b(_){const y=`<img src="${encodeURI(o.value+_.name)}" alt="${_.name}" height="${_.height}" width="${_.width}" />`;p(y)}function m(_){p(encodeURI(o.value+_.name))}const k=h(),V=h([]),D=_=>{_.key==="Escape"&&(_.stopPropagation(),k.value?.hide&&k.value.hide(),document.removeEventListener("keydown",D,!0))};function w(_,y){document.addEventListener("keydown",D,!0),V.value=[{label:"Удалить",icon:"fas fa-trash",command:()=>{f(y.name)}},{label:"Переименовать",icon:"fas fa-plus",command:()=>{}}],y.type==="file"&&V.value.push({label:"Копировать путь",icon:"fas fa-link",command:()=>{m(y)}}),y.type==="file"&&y.isImage&&V.value.push({label:"Копировать Img",icon:"far fa-file-image",command:()=>{b(y)}}),k.value.show(_)}async function S(_){if(l.value.length!==0){if(_===0){o.value=a.value,l.value=[],await P(o.value);return}_>=l.value.length||(o.value=l.value[_],l.value=l.value.slice(0,_),await P(o.value))}}const le=ee(()=>o.value.split("/").filter(B=>B!=="").map((B,ne)=>({name:B,index:ne})));return(_,y)=>{const B=I("Dialog"),ne=I("ContextMenu");return v(),g(W,null,[x(B,{visible:r(e).statusFileManager,"onUpdate:visible":y[1]||(y[1]=R=>r(e).statusFileManager=R),modal:"",position:"top",class:"w-75 mt-4"},{header:M(()=>[t("div",On,[o.value!==a.value?(v(),g("button",{key:0,onClick:j,class:"btn btn-success fas fa-chevron-left"})):A("",!0),t("button",{onClick:z,class:"btn btn-success fas fa-folder-plus"}),t("button",{onClick:U,class:"btn btn-success fas fa-file-upload"}),t("div",Nn,[(v(!0),g(W,null,J(le.value,(R,oe)=>(v(),g("span",{key:oe},[t("span",{class:q(["path-element",{"path-end":oe===le.value.length-1}]),onClick:re=>S(oe)},L(R.name),11,In),y[5]||(y[5]=t("span",{class:"mx-1",style:{"font-size":"80%"}},"/",-1))]))),128))]),t("div",null,[t("button",{class:q(["btn btn-success",{"fas fa-list":d.value,"fas fa-th":!d.value}]),onClick:y[0]||(y[0]=R=>d.value=!d.value)},null,2)])])]),default:M(()=>[u.value?(v(),g("div",Hn,[n.value.length===0?(v(),g("div",jn,"...")):A("",!0),(v(!0),g(W,null,J(n.value.filter(R=>R.type==="dir"),(R,oe)=>(v(),g("div",null,[t("div",Kn,[t("div",Wn,[t("i",{class:"far fa-folder pointer",onClick:re=>$(R.name)},null,8,qn)]),t("div",{class:"pointer",onContextmenu:ae(re=>w(re,R),["prevent"]),onClick:re=>$(R.name)},L(R.name),41,Xn)])]))),256)),t("div",{class:q([{"d-flex flex-wrap":d.value},""])},[(v(!0),g(W,null,J(n.value.filter(R=>R.type!=="dir"),R=>(v(),X(Bn,{key:R.name,el:R,viewFull:d.value,viewSize:c.value,path:o.value,onRightClick:w},null,8,["el","viewFull","viewSize","path"]))),128))],2)])):(v(),g("div",Gn,[...y[6]||(y[6]=[t("div",{class:"spinner-border text-info"},null,-1)])]))]),_:1},8,["visible"]),x(B,{visible:T.value,"onUpdate:visible":y[4]||(y[4]=R=>T.value=R),header:"Создать папку",modal:""},{footer:M(()=>[t("button",{class:"btn btn-secondary btn-sm",onClick:y[3]||(y[3]=R=>T.value=!1)},"Отмена"),t("button",{class:"btn btn-success btn-sm",onClick:H},"Создать")]),default:M(()=>[t("div",Qn,[y[7]||(y[7]=t("label",{class:"form-label"},"Имя новой папки",-1)),N(t("input",{"onUpdate:modelValue":y[2]||(y[2]=R=>E.value=R),type:"text",class:"form-control",placeholder:"Новая папка",onKeyup:we(H,["enter"])},null,544),[[Q,E.value]])])]),_:1},8,["visible"]),x(Rn,{ref_key:"uploadRef",ref:i,path:o.value,directory:n.value,onUploaded:C,class:"w-50"},null,8,["path","directory"]),x(ne,{ref_key:"menu",ref:k,model:V.value},null,8,["model"])],64)}}},Zn={__name:"ArtEditor",setup(s){const e=$e(),i=ke(),a=G(),o=h(1);se(()=>{const l=new URLSearchParams(window.location.search);Object.fromEntries(l.entries()),a.loadRec(Number(location.hash.slice(1))||1),history.pushState(o.value,null,"#"+o.value),console.log("--start ediror--"),Te("#ff642f"),window.addEventListener("popstate",n),document.showToast=(d="",c="success")=>{const u=c==="success"?5e3:6e4;e.add({severity:c,detail:d,life:u}),c==="error"&&console.log(d)},document.confirmDialog=async d=>new Promise((c,u)=>{i.require({message:d,header:"",icon:"fas fa-question",acceptLabel:"Да",rejectLabel:"Нет",accept:()=>c(!0),reject:()=>c(!1)})}),document.showToast("article.value.ready "+a.articleReady)}),xe(()=>{window.removeEventListener("popstate",n)});const n=l=>{o.value=Number(location.hash.slice(1))||1};return(l,d)=>{const c=I("Toast"),u=I("ConfirmDialog");return v(),g(W,null,[r(a).articleReady?(v(),X(ft,{key:0})):A("",!0),r(a).articleReady?(v(),X(bn,{key:1})):A("",!0),x(Jn),x(Jt),r(a).articleReady?(v(),X(Qt,{key:2})):A("",!0),x(c,{position:"bottom-right"}),x(u)],64)}}},Yn=[me,Se,Pe,Re,Ae,Ee,Ve,Ue,ze,Be],te=Ce(Zn);Yn.forEach(s=>{te.component(s.name,s)});te.use(Le,{theme:{preset:Me,options:{cssLayer:{name:"primevue",order:"theme, base, primevue"}}}});te.use(De);te.use(me);te.use(He());te.mount("#art_editor");Object.assign(globalThis,Fe);
