import{Y as E,Z as P,R as T,$ as B,b as m,c as o,o as l,a as t,y as p,F as d,G as f,H as c,v as L,a0 as O,a1 as g,a2 as F,a3 as U,a4 as V,a5 as D,a6 as H,a7 as M,a8 as N,a9 as W,aa as j,ab as q,ac as G}from"./apiCall-BhOi8FOm.js";import{s as I}from"./index-C9nv6BOL.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"my-2"},Y={key:0},Z={class:"table table-sm table-bordered"},z={key:0},J={class:"link"},K=["href"],X={class:"me-2"},tt=["href"],et={class:"table table-sm table-bordered"},st={key:0},rt={class:"link"},at=["href"],nt={class:"me-2"},ot=["href"],lt={class:"table table-sm table-bordered"},ut={class:"link"},ct=["href"],it={class:"me-2"},dt=["href"],ht={__name:"Crawler",setup(b){E(),P(),T(()=>{console.log("startCrawler")}),B(()=>{});const u=m({}),i=m({}),h=m(!1),k=m("start");async function w(r){try{return await L({command:"checkUrlByPhp",url:r})}catch(e){throw new Error(e)}}function $(r){if(!h.value)return new Promise(async(e,a)=>{try{const s=await fetch(r);if(!s.ok)return a({status:s.status,statusText:s.statusText,error:`HTTP ${s.status}`});const n=await s.text(),C=[...new DOMParser().parseFromString(n,"text/html").querySelectorAll("a")].map(S=>S.getAttribute("href")).filter(Boolean);e(C)}catch(s){a({status:null,statusText:null,error:s.message})}})}async function A(r,e){if(k.value="working",h.value)return;await v(r,e);let a={};Object.keys(u.value).sort().forEach(s=>{a[s]=u.value[s]}),u.value=a,await x(),a={},Object.keys(i.value).sort().forEach(s=>{a[s]=i.value[s]}),i.value=a,k.value="end"}async function x(){if(!h.value)for(let r in i.value)try{const e=await w(r);i.value[r].status="done",i.value[r].check=e.check?"ok":e.code}catch{}}async function v(r,e){if(h.value||["#","/a_dmin","/f_ilament"].some(n=>r.startsWith(n)))return;if(["//","http://","https://"].some(n=>r.startsWith(n))){r in i.value||(i.value[r]={status:"reading",check:"unknown",parentArr:[]}),i.value[r].parentArr.push(e);return}if(r in u.value){u.value[r].check!="ok"&&u.value[r].parentArr.push(e);return}u.value[r]={status:"reading",check:"unknown",parentArr:[e]};try{const n=await $(r);u.value[r].check="ok";for(const y of n){if(h.value)return;await v(y,r)}}catch(n){u.value[r].check=n.error}finally{u.value[r].status="done"}}return(r,e)=>(l(),o(d,null,[e[5]||(e[5]=t("h1",null,"Crawler 0.6",-1)),t("div",R,[k.value=="start"?(l(),o("button",{key:0,class:"btn btn-primary fas fa-angle-right",onClick:e[0]||(e[0]=a=>A("/",""))})):p("",!0),k.value=="working"?(l(),o("button",{key:1,class:"btn btn-danger fas fa-stop ms-3",onClick:e[1]||(e[1]=a=>h.value=!0)})):p("",!0)]),k.value!="start"?(l(),o("div",Y,[e[2]||(e[2]=t("h3",null,"Error",-1)),t("table",Z,[t("tbody",null,[(l(!0),o(d,null,f(u.value,(a,s)=>(l(),o(d,{key:s},[a.check!="ok"?(l(),o("tr",z,[t("td",J,[t("a",{href:s,target:"_blank"},c(s),9,K)]),t("td",null,c(a.status),1),t("td",null,c(a.check),1),t("td",null,[(l(!0),o(d,null,f(a.parentArr,n=>(l(),o("span",X,[t("a",{href:n,target:"_blank"},c(n),9,tt)]))),256))])])):p("",!0)],64))),128))])]),e[3]||(e[3]=t("h3",null,"Ok",-1)),t("table",et,[t("tbody",null,[(l(!0),o(d,null,f(u.value,(a,s)=>(l(),o(d,{key:s},[a.check=="ok"?(l(),o("tr",st,[t("td",rt,[t("a",{href:s,target:"_blank"},c(s),9,at)]),t("td",null,c(a.status),1),t("td",null,c(a.check),1),t("td",null,[(l(!0),o(d,null,f(a.parentArr,n=>(l(),o("span",nt,[t("a",{href:n,target:"_blank"},c(n),9,ot)]))),256))])])):p("",!0)],64))),128))])]),e[4]||(e[4]=t("h2",null,"External",-1)),t("table",lt,[t("tbody",null,[(l(!0),o(d,null,f(i.value,(a,s)=>(l(),o("tr",{key:s},[t("td",ut,[t("a",{href:s,target:"_blank"},c(s),9,ct)]),t("td",null,c(a.status),1),t("td",null,c(a.check),1),t("td",null,[(l(!0),o(d,null,f(a.parentArr,n=>(l(),o("span",it,[t("a",{href:n,target:"_blank"},c(n),9,dt)]))),256))])]))),128))])])])):p("",!0)],64))}},ft=Q(ht,[["__scopeId","data-v-95e2e55e"]]),kt=[g,F,U,V,D,H,M,N,W,I],_=O(ft);kt.forEach(b=>{_.component(b.name,b)});_.use(j,{theme:{preset:q,options:{cssLayer:{name:"primevue",order:"theme, base, primevue"}}}});_.use(G);_.use(g);_.mount("#crawler");
