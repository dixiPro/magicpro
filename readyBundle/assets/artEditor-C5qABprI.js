import{r as E,c as q,a as $e,t as _t,b as C,o as _,d as u,e as M,u as m,w as re,v as ge,n as le,f as wt,F as Q,g as fe,h as W,i as se,j as ie,k as K,l as U,m as ae,p as Le,q as kt,s as $t,x as dt,y as ke,z as Z,A as xt,B as ee,C as xe,D as Y,E as ve,G as Me,H as Ae,I as Ce,J as Qe,K as St,L as et,M as Ct,N as Tt,_ as Dt,O as Et,T as ft,P as Pt,Q as Ot,R as Nt,S as Ft,U as Lt,V as At,W as Rt,X as Bt,Y as Vt,Z as Ut,$ as zt,a0 as Mt}from"./ToastConfirm-Dx9X-4_N.js";import{s as It}from"./index-C-hXeCQ3.js";import{d as Kt,a as pt,M as Ht,_ as jt,c as Wt}from"./EditFile-BnPBOO2K.js";import{_ as Xt}from"./_plugin-vue_export-helper-DlAUqK2U.js";async function ht(e,t=2){try{return await prettier.format(e,{parser:"php",plugins:prettierPlugins,tabWidth:t})}catch(a){throw console.error("Ошибка при форматировании Php:",a),new Error("Ошибка при форматировании Php")}}async function qt(e,t=2){let a=[],r=e.replace(/@php([\s\S]*?)@endphp/g,(s,c)=>{const i=a.length;return a.push(s),`<!--___PHP____${i}-->`}),o=[];r=r.replace(/@extends\s*\(\s*['"][^)]+?\[[\s\S]*?\]\s*\)/g,s=>{const c=o.length;return o.push(s),`<!--___EXTENDS____${c}-->`});let n=[];r=r.replace(/@props\s*\(\s*\[[\s\S]*?\]\s*\)/g,s=>{const c=n.length;return n.push(s),`<!--___PROPS____${c}-->`});let l=[];r=r.replace(/{{--([\s\S]*?)--}}/g,(s,c)=>{const i=l.length;return l.push(s),`<!--___COMMENT____${i}-->`}),a.length>0&&(a=await Promise.all(a.map(s=>Yt(s,t))));try{r=await prettier.format(r,{parser:"html",plugins:[prettierPlugins.html],tabWidth:t,printWidth:160})}catch(s){const c=s.message.split(`
`).map(i=>i.replace(/^\s+/,"")).map(i=>i.replace(/For more info.*/,"")).filter(i=>!i.includes("at")).join(`
`);document.showToast(c,"error")}return r=Zt(r,t),r=r.replace(/<!--___PHP____(\d+)-->/g,(s,c)=>a[c]),r=r.replace(/<!--___PROPS____(\d+)-->/g,(s,c)=>n[c]),r=r.replace(/<!--___COMMENT____(\d+)-->/g,(s,c)=>l[c]),r=r.replace(/<!--___EXTENDS____(\d+)-->/g,(s,c)=>o[c]),r}async function Yt(e,t){e=e.replace(/@php\s*/g,"").replace(/\s*@endphp/g,"");let a=`<?php
${e}`,r=await ht(a,t);return r=r.replace(/^<\?php\s*/,"").trim(),r=r.split(`
`).map(o=>" ".repeat(t)+o).join(`
`),r=`@php
${r}
@endphp`,r}function Zt(e,t=2){const a=e.split(`
`);let r=0;const o=[];for(let n of a){let l=Gt(n);for(let s of l){let c=Jt(s);s.includes("<!--___PHP____")?(s=s.replace(/^\s+/,""),o.push(s)):(r=r+c.ident,o.push(" ".repeat(r*t)+c.line),r=r+c.after)}}return o.join(`
`)}function Gt(e){const t=e.match(/^(\s*)/),a=t?t[1]:"",r=e.split(/(?=@\w+)/).map(o=>o.trim()).filter(Boolean);return r.length<=1?[e]:r.map(o=>a+o)}function Jt(e){const t={if:{ident:0,after:1},elseif:{ident:-1,after:1},else:{ident:-1,after:1},endif:{ident:-1,after:0},section:{ident:0,after:1,extended:{ident:0,after:0}},endsection:{ident:-1,after:0},foreach:{ident:0,after:1},endforeach:{ident:-1,after:0},forelse:{ident:0,after:1},endforelse:{ident:-1,after:0},for:{ident:0,after:1},endfor:{ident:-1,after:0},yield:{ident:1,after:-1},while:{ident:0,after:1},endwhile:{ident:-1,after:0},section:{ident:0,after:1},endsection:{ident:-1,after:0},switch:{ident:0,after:1},case:{ident:-1,after:1},endswitch:{ident:-1,after:0},endcase:{ident:-1,after:0},php:{ident:0,after:1},endphp:{ident:-1,after:0},livewire:{ident:0,after:1},endlivewire:{ident:-1,after:0},component:{ident:0,after:1},endcomponent:{ident:-1,after:0},slot:{ident:0,after:1},endslot:{ident:-1,after:0},props:{ident:0,after:0},error:{ident:0,after:1},enderror:{ident:-1,after:0},once:{ident:0,after:1},endonce:{ident:-1,after:0},push:{ident:0,after:1},endpush:{ident:-1,after:0},stack:{ident:0,after:1},endstack:{ident:-1,after:0},verbatim:{ident:0,after:1},endverbatim:{ident:-1,after:0},can:{ident:0,after:1},endcan:{ident:-1,after:0},cannot:{ident:0,after:1},endcannot:{ident:-1,after:0},auth:{ident:0,after:1},endauth:{ident:-1,after:0},guest:{ident:0,after:1},endguest:{ident:-1,after:0},mproauth:{ident:0,after:1},endmproauth:{ident:-1,after:0}};let a=(e.match(/@\w+/)||[null])[0];if(!a)return{ident:0,after:0,line:e};if(a=a.replace("@",""),!t[a])return{ident:0,after:0,line:e};let r=e.replace(new RegExp(`${a}\\s*\\(`,"g"),`${a}(`),o=t[a];return o.line=r,o.extended&&(r.match(new RegExp(`${a}\\(([^)]*)\\)`))||[null,""])[1].split(",").length>1?(o=t[a].extended,o.line=r,res):o}function Qt(e){const t={};let a=e.match(/\{% *setMeta\('title', *'([^']+)'/);return t.title=a?a[1]:null,a=e.match(/\{% *setMeta\('htmlDescr', *'([^']+)'/),t.description=a?a[1].trim():null,a=e.match(/\{% *setMeta\('keywords', *'([^']+)'/),t.keywords=a?a[1].trim():null,a=e.match(/\{% *setMeta\('h1', *'([^']+)'/),t.h1=a?a[1].trim():null,console.log(t),` @extends('magic::main',[
  'title' => '${t.title}',
  'description' => '${t.description}',
  'keywords' => '${t.keywords}'
])
  

<h1>${t.h1}</h1>

`+e}const ye=Kt("article",()=>{const e=E({}),t=q(()=>{if(e.value.name!=="")return/^[a-z0-9_-]+$/i.test(e.value.name)}),a=q(()=>/{%\s*.*?\s*%}/.test(e.value.body)),r=E(!1),o=E(!1),n=E(!1),l="chrome",s=["chrome","monokai","dracula","twilight"],c=E("tree"),i=E(!1),d=E(""),p=E("");async function f(L){const x=await $e({command:"getById",id:L});e.value=g(x),history.pushState(L,null,"#"+L),i.value=!0,document.title=e.value.title}function g(L){let x=L.routeParams;(Array.isArray(x)||x===null||typeof x!="object")&&(x={});const{adminOnly:$=!1,useController:h=!0,getEnable:w=!1,utmParamsEnable:H=!0,bindKeys:j=!1,keysArr:A=[]}=x;return L.routeParams={useController:h,adminOnly:$,getEnable:w,utmParamsEnable:H,bindKeys:j,keysArr:A},L}async function k(){e.value=await $e({command:"saveById",article:e.value}),document.showToast("Сохранено")}async function T(){try{const L=await $e({command:"getDefaultController",id:1});e.value.controller=L.controller}catch(L){console.log(L)}}async function P(L){try{const x=await $e({command:"articleByName",name:L});window.open(location.pathname+"#"+x.id,"_blank")}catch{}}async function O(){try{const L=await $e({command:"getDefaultLiveWareController",id:1});e.value.controller=L.controller}catch(L){console.log(L)}}async function R(L){try{return await $e({command:"search",text:L})}catch(x){console.log(x)}}async function B(){const L=await qt(e.value.body,2);e.value.body=L;const x=await ht(e.value.controller,2);e.value.controller=x,document.showToast("Отформатировано")}function v(){e.value.name=_t(e.value.title.trim())}const b=L=>{if(L.ctrlKey&&L.code==="KeyS"){L.preventDefault(),k();return}if(L.altKey&&L.code==="Digit4"){addPannel.value=!addPannel.value,L.preventDefault();return}if(L.altKey&&L.code==="Digit6"){splitStatusEditorObj.value.set("hideController"),L.preventDefault();return}if(L.altKey&&L.code==="Digit5"){splitStatusEditorObj.value.set("hideBlade"),L.preventDefault();return}if(L.altKey&&L.code==="Digit3"){const x=splitTreeStatusObj.value.status=="hideTree"?"normal":"hideTree";splitTreeStatusObj.value.set(x),L.preventDefault();return}};function D(){e.value.body=Qt(e.value.body)}const y=E(),F=E("open"),I=E(),X=E("full");return window.addEventListener("keydown",b),{article:e,statusHelp:r,statusAddPannel:o,statusFileManager:n,aceTheme:l,aceThemes:s,hasTwig:a,statusTranslitButton:t,hasTwig:a,statusLeftPannel:c,toggleTreeSplitter:y,modeTreeSplitter:F,toggleEditorSplitter:I,modeEditorSplitter:X,searchTextController:d,searchTextView:p,articleReady:i,loadRec:f,saveRec:k,getController:T,getLiveWareController:O,gotoArticleByName:P,formatDocument:B,translit:v,convertFromMro:D,search:R}}),en={class:"row gx-2 py-2 mx-0",style:{background:"#ffff001f"}},tn={class:"col-auto"},nn=["href"],an={key:1,class:"btn btn-sm btn-secondary fas fa-external-link-alt"},rn={class:"col-3"},ln={class:"input-group input-group-sm"},sn={key:0,class:"col-3"},on={class:"input-group input-group-sm"},cn={class:"col-1"},un={class:"input-group input-group-sm"},dn={class:"col-auto"},fn={key:1,class:"col-auto"},pn={class:"col-auto align-self-center"},hn={class:"col-auto"},mn={class:"col-auto"},gn=["value"],vn={class:"col text-end"},yn={__name:"TopMenu",setup(e){const t=ye(),a=E(""),r=q(()=>t.article.name==="index"?"/":"/"+t.article.name);return(o,n)=>(_(),C("div",en,[u("div",tn,[m(t).article.isRoute?(_(),C("a",{key:0,target:"_blank",class:"fas fa-external-link-alt btn btn-sm btn-primary",href:r.value},null,8,nn)):(_(),C("span",an))]),u("div",rn,[u("div",ln,[re(u("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":n[0]||(n[0]=l=>m(t).article.name=l)},null,512),[[ge,m(t).article.name]]),m(t).statusTranslitButton?M("",!0):(_(),C("button",{key:0,class:"btn btn-sm btn-primary",onClick:n[1]||(n[1]=l=>m(t).translit())},"Translit→"))])]),m(t).statusTranslitButton?(_(),C("div",sn,[u("div",on,[re(u("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":n[2]||(n[2]=l=>m(t).article.title=l)},null,512),[[ge,m(t).article.title]]),u("button",{class:"btn btn-sm btn-primary",onClick:n[3]||(n[3]=l=>m(t).saveRec())},"Save→")])])):M("",!0),u("div",cn,[u("div",un,[re(u("input",{placeholder:"перейти",type:"text",class:"form-control","onUpdate:modelValue":n[4]||(n[4]=l=>a.value=l)},null,512),[[ge,a.value]]),u("button",{class:"btn btn-primary fas fa-angle-right",onClick:n[5]||(n[5]=l=>m(t).gotoArticleByName(a.value))})])]),u("div",dn,[u("span",{class:le(["btn btn-success",{"fas fas fa-sitemap":m(t).modeTreeSplitter=="hidden","fas fa-ellipsis-h":m(t).modeTreeSplitter==="open"}]),onClick:n[6]||(n[6]=l=>m(t).toggleTreeSplitter())},null,2)]),m(t).article.routeParams.useController?(_(),C("div",fn,[u("span",{class:le(["btn btn-success",{"fas fa-angle-left":m(t).modeEditorSplitter==="full","fas fa-angle-right":m(t).modeEditorSplitter==="view","fa fa-columns":m(t).modeEditorSplitter==="controller"}]),onClick:n[7]||(n[7]=l=>m(t).toggleEditorSplitter())},null,2)])):M("",!0),u("div",pn,[u("button",{class:"btn fas fa-magic btn-success",onClick:n[8]||(n[8]=l=>m(t).formatDocument())},"1")]),u("div",hn,[u("button",{onClick:n[9]||(n[9]=l=>m(t).statusHelp=!m(t).statusHelp),class:"fas fa-question btn btn-success"})]),u("div",mn,[re(u("select",{"onUpdate:modelValue":n[10]||(n[10]=l=>m(t).aceTheme=l),class:"form-select form-select-sm"},[(_(!0),C(Q,null,fe(m(t).aceThemes,l=>(_(),C("option",{key:l,value:l},W(l),9,gn))),128))],512),[[wt,m(t).aceTheme]])]),u("div",vn,[n[14]||(n[14]=u("span",{class:"me-2"},"1.1.2",-1)),m(t).hasTwig?(_(),C("button",{key:0,class:"btn btn-success fas fa-sync-alt btn-sm me-2",onClick:n[11]||(n[11]=l=>m(t).convertFromMro())})):M("",!0),u("button",{class:"btn btn-success fas fa-folder-open",onClick:n[12]||(n[12]=l=>m(t).statusFileManager=!m(t).statusFileManager)}),u("button",{class:"ms-1 btn btn-success fas fa-bars",onClick:n[13]||(n[13]=l=>m(t).statusAddPannel=!m(t).statusAddPannel)})])]))}},bn={class:""},_n={class:"my-2 d-flex"},wn={class:"nowrap"},kn={class:"d-flex my-2"},$n={class:"nowrap"},xn={class:"my-2 d-flex"},Sn={class:"nowrap"},Cn={key:0},Tn={class:"d-flex my-2"},Dn={class:"nowrap"},En={class:"d-flex my-2"},Pn={class:"nowrap"},On={class:"d-flex my-2"},Nn={class:"nowrap"},Fn={class:"ms-2"},Ln={key:0},An={class:"d-table"},Rn={class:"d-table-cell px-1 py-1 align-middle",style:{"min-width":"300px"}},Bn=["onUpdate:modelValue"],Vn={class:"d-table-cell px-1 py-1"},Un=["onClick"],zn={class:"d-table-cell px-1 py-1"},Mn=["onClick"],In={class:"d-table-cell px-1 py-1"},Kn=["onClick"],Hn={class:"row my-2"},jn={class:"col-9"},Wn={class:"col-1"},Xn={key:1,class:"fas fa-plus"},qn={key:0,class:"d-flex my-2"},Yn={class:"nowrap"},Zn={class:"mt-5"},Gn={class:"my-2"},Jn={class:"my-2"},Qn=["href"],ea={__name:"RouteParam",setup(e){const t=ye(),a=E(""),r=E("");return(o,n)=>{const l=se("ToggleSwitch"),s=se("Drawer");return _(),ie(s,{visible:m(t).statusAddPannel,"onUpdate:visible":n[11]||(n[11]=c=>m(t).statusAddPannel=c),header:"Параметры",position:"right",style:{width:"600px"}},{default:K(()=>[u("div",bn,[u("div",_n,[u("div",wn,[U(l,{modelValue:m(t).article.menuOn,"onUpdate:modelValue":n[0]||(n[0]=c=>m(t).article.menuOn=c)},null,8,["modelValue"])]),n[12]||(n[12]=u("div",{class:"ms-2"},"menu",-1))]),u("div",kn,[u("div",$n,[U(l,{modelValue:m(t).article.routeParams.useController,"onUpdate:modelValue":n[1]||(n[1]=c=>m(t).article.routeParams.useController=c)},null,8,["modelValue"])]),n[13]||(n[13]=u("div",{class:"ms-2"},[ae(" Испольовать контроллер "),u("div",{class:"small"},"Если нет, то будет вызываться просто вьюха")],-1))]),u("div",xn,[u("div",Sn,[U(l,{modelValue:m(t).article.isRoute,"onUpdate:modelValue":n[2]||(n[2]=c=>m(t).article.isRoute=c)},null,8,["modelValue"])]),n[14]||(n[14]=u("div",{class:"ms-2"},"route",-1))]),m(t).article.isRoute?(_(),C("div",Cn,[u("div",Tn,[u("div",Dn,[U(l,{modelValue:m(t).article.routeParams.adminOnly,"onUpdate:modelValue":n[3]||(n[3]=c=>m(t).article.routeParams.adminOnly=c)},null,8,["modelValue"])]),n[15]||(n[15]=u("div",{class:"ms-2"},"Только Админ (для отладки)",-1))]),u("div",En,[u("div",Pn,[U(l,{modelValue:m(t).article.routeParams.utmParamsEnable,"onUpdate:modelValue":n[4]||(n[4]=c=>m(t).article.routeParams.utmParamsEnable=c)},null,8,["modelValue"])]),n[16]||(n[16]=u("div",{class:"ms-2"},"Разрешить Utm ?=utm...",-1))]),u("div",On,[u("div",Nn,[U(l,{modelValue:m(t).article.routeParams.getEnable,"onUpdate:modelValue":n[5]||(n[5]=c=>m(t).article.routeParams.getEnable=c)},null,8,["modelValue"])]),u("div",Fn,[n[20]||(n[20]=u("div",null,"Использовать GET параметры",-1)),m(t).article.routeParams.getEnable?(_(),C("div",Ln,[n[18]||(n[18]=u("div",{class:"mt-2"},"Допустимые параметры",-1)),n[19]||(n[19]=u("div",{class:"small"},"Если пусто то все",-1)),u("div",An,[(_(!0),C(Q,null,fe(m(t).article.routeParams.keysArr,(c,i)=>(_(),C("div",{class:"d-table-row",key:i},[u("div",Rn,[re(u("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":d=>m(t).article.routeParams.keysArr[i]=d},null,8,Bn),[[ge,m(t).article.routeParams.keysArr[i]]])]),u("div",Vn,[re(u("i",{class:"fas fa-arrow-circle-down",onClick:d=>{m(t).article.routeParams.swap=m(t).article.routeParams.keysArr[i+1],m(t).article.routeParams.keysArr[i+1]=m(t).article.routeParams.keysArr[i],m(t).article.routeParams.keysArr[i]=m(t).article.routeParams.swap,delete m(t).article.routeParams.swap}},null,8,Un),[[Le,m(t).article.routeParams.keysArr.length-1>i&&m(t).article.routeParams.bindKeys]])]),u("div",zn,[i>0&&m(t).article.routeParams.bindKeys?(_(),C("i",{key:0,class:"fas fa-arrow-circle-up",onClick:d=>{r.value=m(t).article.routeParams.keysArr[i-1],m(t).article.routeParams.keysArr[i-1]=m(t).article.routeParams.keysArr[i],m(t).article.routeParams.keysArr[i]=r.value}},null,8,Mn)):M("",!0)]),u("div",In,[u("i",{class:"fas fa-trash",onClick:d=>m(t).article.routeParams.keysArr.splice(i,1)},null,8,Kn)])]))),128))]),u("div",Hn,[u("div",jn,[re(u("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":n[6]||(n[6]=c=>a.value=c)},null,512),[[ge,a.value]])]),u("div",Wn,[a.value.trim()!=""?(_(),C("span",{key:0,class:"fas fa-plus",onClick:n[7]||(n[7]=c=>{m(t).article.routeParams.keysArr.push(a.value),a.value=""})})):(_(),C("span",Xn))])]),m(t).article.routeParams.keysArr.length>0?(_(),C("div",qn,[u("div",Yn,[U(l,{modelValue:m(t).article.routeParams.bindKeys,"onUpdate:modelValue":n[8]||(n[8]=c=>m(t).article.routeParams.bindKeys=c)},null,8,["modelValue"])]),n[17]||(n[17]=u("div",{class:"ms-2"},[u("div",null,"Привязывать параметры"),u("div",{class:"small"},"Только для параметорв в / /")],-1))])):M("",!0)])):M("",!0)])])])):M("",!0),u("div",Zn,[u("button",{class:"btn btn-success btn-sm",onClick:n[9]||(n[9]=c=>m(t).getController())},"Обычный контроллер")]),u("div",Gn,[u("button",{class:"btn btn-success btn-sm",onClick:n[10]||(n[10]=c=>m(t).getLiveWareController())},"LiveWare контроллер")]),u("div",Jn,[u("a",{href:"http://mpro2.test/a_dmin/api/exportArticle?id="+m(t).article.id,class:"btn btn-success btn-sm"}," Экспорт ",8,Qn)])]),u("pre",null,"        "+W(m(t).article)+`
    `,1)]),_:1},8,["visible"])}}},ta={__name:"Help",setup(e){const t=ye();return(a,r)=>{const o=se("Dialog");return _(),ie(o,{visible:m(t).statusHelp,"onUpdate:visible":r[0]||(r[0]=n=>m(t).statusHelp=n),header:"Справка",modal:"",class:"w-50"},{default:K(()=>[...r[1]||(r[1]=[u("ul",{class:"list-unstyled m-0"},[u("li",null,[u("kbd",null,"Ctrl+S"),ae(" — сохранить")]),u("li",null,[u("kbd",null,"Shift_"),ae(" — снипеты блейда")]),u("li",null,[u("kbd",null,"Alt+1"),ae(" — перейти в статье по выбранному слову")]),u("li",null,[u("kbd",null,"Alt+3"),ae(" — панель дерева")]),u("li",null,[u("kbd",null,"Alt+4"),ae(" — боковое меню")]),u("li",null,[u("kbd",null,"Alt+5"),ae(" — панель контроллера")]),u("li",null,[u("kbd",null,"Alt+6"),ae(" — скрыть/отобразить панель блейда")])],-1)])]),_:1},8,["visible"])}}};function na(){const e=pt.require("ace/mode/html_highlight_rules").HtmlHighlightRules;if(e.__bladePatched)return;const t=[{token:"comment",regex:/\{\{\-\-[\s\S]*?\-\-\}\}/},{token:"variable",regex:/\{\{[\s\S]*?\}\}/},{token:"entity.name.function",regex:/@[A-Za-z_]\w*/}],a=e.prototype.getRules;e.prototype.getRules=function(){const r=a.call(this);for(const o in r)r[o].unshift(...t);return r},e.__bladePatched=!0}function aa(e){const t=[{tabTrigger:"",name:"_@auth",content:`@auth
	$0
@endauth`},{tabTrigger:"",name:"_@can",content:`@can(\${1:ability})
	$0
@endcan`},{tabTrigger:"",name:"_@cannot",content:`@cannot(\${1:ability})
	$0
@endcannot`},{tabTrigger:"",name:"_@csrf",content:"@csrf"},{tabTrigger:"",name:"_@dd",content:"@dd(${1:var})"},{tabTrigger:"",name:"_@dump",content:"@dump(${1:var})"},{tabTrigger:"",name:"_@else",content:`@else
	$0`},{tabTrigger:"",name:"_@elseif",content:"@elseif ($${1:user}->${2:active})"},{tabTrigger:"",name:"_@empty",content:`@empty ($\${1:arr})
	$0
@endempty`},{tabTrigger:"",name:"_@endauth",content:"@endauth"},{tabTrigger:"",name:"_@endcan",content:"@endcan"},{tabTrigger:"",name:"_@endcannot",content:"@endcannot"},{tabTrigger:"",name:"_@endempty",content:"@endempty"},{tabTrigger:"",name:"_@endforeach",content:"@endforeach"},{tabTrigger:"",name:"_@endif",content:"@endif"},{tabTrigger:"",name:"_@endfor",content:"@endfor"},{tabTrigger:"",name:"_@endguest",content:"@endguest"},{tabTrigger:"",name:"_@endisset",content:"@endisset"},{tabTrigger:"",name:"_@endonce",content:"@endonce"},{tabTrigger:"",name:"_@endprepend",content:"@endprepend"},{tabTrigger:"",name:"_@endphp",content:"@endphp"},{tabTrigger:"",name:"_@endpush",content:"@endpush"},{tabTrigger:"",name:"_@endsection",content:"@endsection"},{tabTrigger:"",name:"_@endswitch",content:"@endswitch"},{tabTrigger:"",name:"_@endwhile",content:"@endwhile"},{tabTrigger:"",name:"_@env",content:`@env(\${1:environment})
	$0
@endenv`},{tabTrigger:"",name:"_@error",content:`@error('\${1:field}')
	<div class="text-danger">{{ $message }}</div>
@enderror`},{tabTrigger:"",name:"_@extends",content:"@extends('${1:layout}')"},{tabTrigger:"",name:"_@for",content:"@for ($${1:i} = 0; $${1:i} < ${2:10}; $${1:i}++)\n	$0\n@endfor"},{tabTrigger:"",name:"_@foreach",content:"@foreach ($${1:items} as $${2:item})\n	$0\n@endforeach"},{tabTrigger:"",name:"_@foreach index",content:"@foreach ($${1:items} as $${2:ndex} => $${3:item})\n	$0\n@endforeach"},{tabTrigger:"",name:"_@guest",content:`@guest
	$0
@endguest`},{tabTrigger:"",name:"_@if",content:`@if ($\${1:var} > 0)
	$0
@endif`},{tabTrigger:"",name:"_@include",content:"@include('magic::${1:view}', [${2:data}])"},{tabTrigger:"",name:"_@includeFirst",content:"@includeFirst(['magic::${1:view1}', 'magic::${2:view2}'])"},{tabTrigger:"",name:"_@includeIf",content:"@includeIf('magic::${1:view}', [${2:data}])"},{tabTrigger:"",name:"_@includeWhen",content:"@includeWhen(${1:condition}, 'magic::${2:view}', [${3:data}])"},{tabTrigger:"",name:"_@includeUnless",content:"@includeUnless(${1:condition}, 'magic::${2:view}', [${3:data}])"},{tabTrigger:"",name:"_@isset",content:`@isset ($\${1:var})
	$0
@endisset`},{tabTrigger:"",name:"_@json",content:"@json(${1:data})"},{tabTrigger:"",name:"_@method",content:"@method('${1:PUT}')"},{tabTrigger:"",name:"_@once",content:`@once
	$0
@endonce`},{tabTrigger:"",name:"_@php",content:`@php
	$0
@endphp`},{tabTrigger:"",name:"_@prepend",content:`@prepend('\${1:stack}')
	$0
@endprepend`},{tabTrigger:"",name:"_@production",content:`@production
	$0
@endproduction`},{tabTrigger:"",name:"_@props",content:"@props(['${1:variable}' => ${2:default}])"},{tabTrigger:"",name:"_@push",content:`@push('\${1:stack}')
	$0
@endpush`},{tabTrigger:"",name:"_@section (block)",content:`@section('\${1:name}')
	$0
@endsection`},{tabTrigger:"",name:"_@section (inline)",content:"@section('${1:name}', '${2:content}')"},{tabTrigger:"",name:"_@stack",content:"@stack('${1:stack}')"},{tabTrigger:"",name:"_@switch",content:`@switch ($\${1:value})
	@case($\${2:key})
		$0
	@break
@endswitch`},{tabTrigger:"",name:"_@unless",content:`@unless ($\${1:cond})
	$0
@endunless`},{tabTrigger:"",name:"_@verbatim",content:`@verbatim
	$0
@endverbatim`},{tabTrigger:"",name:"_@while",content:`@while ($\${1:flag})
	$0
@endwhile`},{tabTrigger:"",name:"_@yield",content:"@yield('${1:section}')"},{tabTrigger:"",name:"_<x-magic",content:'<x-magic::${1:anonymus} :data="$${1:value}"></x-magic::${1:anonymus}>)'}],a=t.map(c=>c.tabTrigger.replace("@",""));ace.require("ace/snippets").snippetManager.register(t,"html");const o=ace.require("ace/autocomplete").Autocomplete,n=o.prototype.showPopup,l=o.prototype.updateCompletions;function s(c){c&&Array.isArray(c.data)&&(c.data=c.data.filter(i=>!a.includes(i.value)),c.setData(c.data))}o.prototype.showPopup=function(c){n.call(this,c),s(this.popup)},o.prototype.updateCompletions=function(c){l.call(this,c),s(this.popup)},e.commands.addCommand({name:"toggleLineMarkersCommand",bindKey:{win:"Alt-/",mac:"Alt-/"},exec:sa,readOnly:!1})}function ra(e){let t,a;if(e.getSelectionRange().isEmpty()){const r=e.getCursorPosition();e.selection.selectLine(r.row),t=a=r.row}else{const r=e.getSelectionRange(),o=ace.require("ace/range").Range;t=r.start.row,a=r.end.row;const n=new o(t,0,a,e.session.getLine(a).length);e.selection.setRange(n)}return{startRow:t,endRow:a}}function la(e){return/{{--.*--}}/.test(e)?(e=e.replace(/^\s*{{--\s?/,""),e=e.replace(/\s?--}}\s*$/,""),e):`{{-- ${e} --}}`}function sa(e){const{startRow:t,endRow:a}=ra(e),r=e.session,o=ace.require("ace/range").Range;for(let n=t;n<=a;n++){const l=r.getLine(n),s=la(l),c=l.length;r.replace(new o(n,0,n,c),s)}}const oa=["id"],tt={__name:"AceEditor",props:kt({lang:{type:String,default:"html",validator:e=>["html","php","blade"].includes(e)},theme:{type:String,default:"monokai"},readOnly:{type:Boolean,default:!1},tabSize:{type:Number,default:4},wrap:{type:Boolean,default:!1},height:{type:Number,default:100}},{modelValue:{type:String,default:"XXXXXXXX"},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=ye(),a=E($t()),r=e,o=dt(e,"modelValue"),n=E(null);let l=null;const s=()=>r.lang==="php"?"ace/mode/php":"ace/mode/html",c=i=>`ace/theme/${i}`;return ke(()=>{na(),l=pt.edit(a.value,{value:o.value,mode:s(r.lang),theme:c(r.theme),readOnly:r.readOnly,wrap:r.wrap,tabSize:r.tabSize,useWorker:!1}),l.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableEmmet:!0}),l.setFontSize(14),l.commands.addCommand({name:"sendSelectedToParent",bindKey:{win:"Alt-1",mac:"Alt-1"},exec(i){const d=i.session.getTextRange(i.getSelectionRange());if(d.trim()===""){document.showToast("Статья не выделена");return}t.gotoArticleByName(d)}}),r.lang!=="php"&&aa(l),l.session.on("change",()=>{o.value=l.getValue()}),r.lang==="php"&&Z(()=>t.searchTextController,i=>{i.trim()&&(l.find(i),l.execCommand("find"),t.searchTextController="")}),r.lang==="html"&&Z(()=>t.searchTextView,i=>{i.trim()&&(l.find(t.searchTextView),l.execCommand("find"),t.searchTextView="")})}),Z(o,i=>{if(!l)return;const d=l.getValue();i!==d&&l.setValue(i)}),xt(()=>l?.destroy()),Z(()=>r.lang,i=>l?.session.setMode(s())),Z(()=>r.theme,i=>l?.setTheme(c(i))),Z(()=>r.readOnly,i=>l?.setReadOnly(i)),Z(()=>r.tabSize,i=>l?.session.setTabSize(i)),Z(()=>r.wrap,i=>l?.session.setUseWrapMode(i)),(i,d)=>(_(),C("div",{style:ee("height: "+e.height+"px; width: 100%; position: relative;")},[u("div",{ref_key:"el",ref:n,id:a.value,style:{width:"100%",height:"100%"}},null,8,oa)],4))}};var ia=!1,ca=!0;function Re(e){return Object.prototype.toString.call(e)==="[object Array]"}function nt(e){return Object.prototype.toString.call(e)==="[object Object]"}function ua(e){return typeof e=="function"}function da(e,t){return e<t?e:t}function mt(e,t){let a,r=0;for(;(a=e.indexOf(t))>-1;)e.splice(a,1),r++;return r}function gt(e){return e[e.length-1]}function fa(e){return Re(e)?e:[e]}function pa(e,t){let a=new Set(t);const r={};return a.forEach(o=>{r[o]=e[o]}),r}function ha(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){if(t.reverse)if(e.length!=null)for(let a=e.length-1;a>=0;a--){const r={value:e[a],index:a};(!t.exclude||!t.exclude(r))&&(yield r)}else if(nt(e)){const a=Object.keys(e);a.reverse();for(const r of a){const o={value:e[r],key:r};(!t.exclude||!t.exclude(o))&&(yield o)}}else throw"Unsupported type";else if(e.length!=null)for(let a=0;a<e.length;a++){const r={value:e[a],index:a};(!t.exclude||!t.exclude(r))&&(yield r)}else if(nt(e))for(const a of Object.keys(e)){const r={value:e[a],key:a};(!t.exclude||!t.exclude(r))&&(yield r)}else throw"Unsupported type"})()}function ma(e,t,a){e.hasOwnProperty(t)||(e[t]=a)}function vt(e,t){return Object.keys(t).forEach(a=>{ma(e,a,t[a])}),e}function ga(e){const t={};return Object.keys(e).forEach(a=>{e[a]!==void 0&&(t[a]=e[a])}),t}function ce(e,t){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};a=vt({...a},{childrenKey:"children"});const{childrenKey:r}=a,o=Re(e)?e:[e];class n{}const l=(s,c,i)=>{a.reverse&&(s=s.slice(),s.reverse());const d=s.length;for(let p=0;p<d;p++){const f=s[p],g=a.reverse?d-p-1:p,k=i?[...i,g]:[];a.childFirst&&f[r]!=null&&l(f[r],f,k);const T=t(f,g,c,k);if(T===!1)throw new n;if(T==="skip children")continue;if(T==="skip siblings")break;a.childFirst||f[r]!=null&&l(f[r],f,k)}};try{l(o,null,Re(e)?[]:null)}catch(s){if(!(s instanceof n))throw s}}function va(e,t){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r;return ce(e,function(){if(t(...arguments))return r={node:arguments.length<=0?void 0:arguments[0],index:arguments.length<=1?void 0:arguments[1],parent:arguments.length<=2?void 0:arguments[2],path:arguments.length<=3?void 0:arguments[3]},!1},a),r}function ya(e,t){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return va(e,t,a)?.node}function yt(e,t){const a={childrenKey:"children"};t&&Object.assign(a,t);const{childrenKey:r,nodeHandler:o}=a,n=new Ze;return n.childrenKey=r,ce(e,(l,s,c,i)=>{let d=Object.assign({},l);d[r]&&(d[r]=[]),o&&(d=o(d,{oldNode:l,index:s,parent:c,path:i})),n.set(i,d)},{childrenKey:r}),n.data}class Ze{data;childrenKey="children";constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.data=t}get rootChildren(){const{childrenKey:t}=this,{data:a}=this;return Re(a)?a:a[t]}iteratePath(t){var a=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const{childrenKey:o,rootChildren:n}=a;if(r.reverse){const l=[...a.iteratePath(t,{...r,reverse:!1})];l.reverse();for(const{path:s,node:c}of l)yield{path:s,node:c}}else{let l=[],s=n;for(const c of t){const i=[...l,c],d=s[c];yield{path:i,node:d},l=i,s=d[o]}}})()}getFamily(t){const a=[];for(const{node:r}of this.iteratePath(t))a.push(r);return a}get(t){return gt(this.getFamily(t))}getParentAndIndex(t){const a=t.slice(),r=a.pop();return{parent:this.get(a),index:r,parentPath:a}}getParent(t){return this.getParentAndIndex(t).parent}set(t,a){if(t==null||t.length===0)this.data=a;else{const{childrenKey:r}=this;let{rootChildren:o}=this;const{parent:n,index:l}=this.getParentAndIndex(t);let s;t.length===1?(o||(this.data?this.data[r]=[]:this.data=[]),s=o):(n[r]||(n[r]=[]),s=n[r]),s[l]=a}}delete(t){const{childrenKey:a,rootChildren:r}=this,{parent:o,index:n}=this.getParentAndIndex(t),l=t.length===1?r:o[a],s=l[n];return l.splice(n,1),s}walk(t,a){const{childrenKey:r,data:o}=this;return ce(o,t,r,a)}clone(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return yt(this.data),ga({childrenKey:this.childrenKey,nodeHandler:t.nodeHandler||void 0})}}function at(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ua(e)?e(...t):e}function ba(e,t){return function(){let r,o;try{r=e(...arguments)}catch(n){o=n}finally{}if(o)throw o;return r}}function Te(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=[];let r;const o={};let n=o;return{action:function(){for(var c=arguments.length,i=new Array(c),d=0;d<c;d++)i[d]=arguments[d];if(i.length===0)return n===o&&(n=e()),n;if(r||(r=new $a),!r.has(i)&&(r.set(i,e(...i)),t.capacity!=null)){a.push(i);const p=a.splice(0,a.length-t.capacity);for(const f of p)r.delete(f)}return r.get(i)},clearCache:()=>{r=null,a.splice(0,a.length)}}}function _a(){let e,t;return{promise:new Promise((r,o)=>{e=r,t=o}),resolve:e,reject:t}}function wa(e,t){for(;;){if(e.parentNode==null)return!1;if(e.parentNode===t)return!0;e=e.parentNode}}function Ie(e){let t=e.getBoundingClientRect();if(document.documentElement.clientTop>0){const a=t.top-document.documentElement.clientTop,r=t.bottom,o=t.left-document.documentElement.clientLeft,n=t.right,l=t.width||n-o,s=t.height||r-a,d={top:a,right:n,bottom:r,left:o,width:l,height:s,x:o,y:a};t={...d,toJSON:()=>d}}return t}function rt(e,t){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=a&&a.withSelf?e:e.parentElement;for(;r;){const o=a.until&&r===a.until;if(o&&!a.withUntil)return;const n=t(r);if(n==="break")return;if(n)return r;if(o)return;r=r.parentElement}}function Be(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function lt(e,t){for(const a of t)if(Be(e,a))return!0;return!1}function ue(e,t,a,r){e.addEventListener?e.addEventListener(t,a,r):e.attachEvent&&e.attachEvent(`on${t}`,a,r)}function de(e,t,a,r){e.removeEventListener?e.removeEventListener(t,a,r):e.detachEvent&&e.detachEvent(`on${t}`,a,r)}function ka(e){let t=[];const a=()=>{if(!o.listening){for(const n of e){ue.apply(this,n);const l=()=>de.apply(this,n);t.push(l)}o.listening=!0}},o={listening:!1,stop:()=>{if(o.listening){for(const n of t)n();t=[],o.listening=!1}},resume:a,start:a};return o.start(),o}function Ve(e,t){return getComputedStyle(e)[t]}function Ge(e,t){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};a={start:0,end:e.length-1,maxTimes:1e3,...a};let{start:r,end:o}=a;const{returnNearestIfNoHit:n,maxTimes:l}=a;let s,c;r==null&&(r=0,o=e.length-1);let i=0,d;for(;r>=0&&r<=o;){if(i>=l)throw Error(`binarySearch: loop times is over ${l}, you can increase the limit.`);s=Math.floor((o-r)/2+r),c=e[s];const p=i+1;if(d=t(c,s,p),d>0)o=s-1;else if(d<0)r=s+1;else return{index:s,value:c,count:p,hit:!0};i++}return n?{index:s,value:c,count:i+1,hit:!1,greater:d>0}:null}class $a{_map=new Map;_values={};_objCount=0;_keysToString(t){const{_map:a}=this;let r=[];for(const o of t){if(!a.has(o))return null;r.push(a.get(o)[0])}return r.toString()}has(t){return this._keysToString(t)!=null}get(t){const{_values:a}=this,r=this._keysToString(t);if(r==null)throw"Value not found by specified keys";return a[r][1]}set(t,a){const{_map:r,_values:o}=this;let n=[];for(const l of t){let s,c=1;r.has(l)?([s,c]=r.get(l),c++):(this._objCount++,s=this._objCount.toString()),r.set(l,[s,c]),n.push(s)}o[n.toString()]=[t.slice(),a]}delete(t){const{_values:a,_map:r}=this,o=this._keysToString(t);if(o==null)throw"Value not found by specified keys";delete a[o];for(const n of t){let[l,s]=r.get(n);s--,s===0?r.delete(n):r.set(n,[l,s])}}clear(){this._map.clear(),this._values={}}*entries(){const{_values:t}=this;for(const a in t){const[r,o]=t[a];yield[r,o]}}count(){return[...this.entries()].length}}const xa=xe({props:{table:Boolean}}),bt=(e,t)=>{const a=e.__vccOpts||e;for(const[r,o]of t)a[r]=o;return a},Sa={key:0},Ca={key:1};function Ta(e,t,a,r,o,n){return e.table?(_(),C("table",Sa,[Y(e.$slots,"prepend"),u("tbody",null,[Y(e.$slots,"default")]),Y(e.$slots,"append")])):(_(),C("div",Ca,[Y(e.$slots,"prepend"),Y(e.$slots,"default"),Y(e.$slots,"append")]))}const Da=bt(xa,[["render",Ta]]),Ea=xe({components:{VirtualListTable:Da},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const t=E(0),a=E(e.firstRender-1),r=q(()=>{var x;return da(a.value,(((x=e.items)==null?void 0:x.length)||1)-1)}),o=E(0),n=q(()=>f.value[t.value]?I(t.value):0),l=q(()=>f.value.length>0?I(f.value.length-1)+gt(p.value):0),s=q(()=>f.value[r.value]?l.value-I(r.value)-p.value[r.value]:0),c=q(()=>e.disabled?{}:{overflow:"auto"}),i=q(()=>{const x={display:"flex"};return e.disabled||(e.horizontal?Object.assign(x,{"margin-left":n.value+"px","margin-right":s.value+"px",width:l.value-s.value-n.value+"px"}):Object.assign(x,{"margin-top":n.value+"px","margin-bottom":s.value+"px"})),x["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete x.display,delete x["flex-direction"]),x}),d=q(()=>ve((e.items||[]).map(()=>null))),p=q(()=>(e.items||[]).map((x,$)=>{var h;if(d[$]!=null)return d[$];let w=(h=e.itemSize)==null?void 0:h.call(e,x,$);return w==null&&(w=o.value),w})),f=q(()=>{const x=[];return p.value.reduce(($,h)=>(x.push($),$+h),0),x});Z(()=>e.items,v);const g=q(()=>{if(!e.items||e.disabled)return;const x=[];for(let $=t.value;$<=r.value;$++){const h=e.items[$];if(!h)break;x.push({item:h,index:$})}return x}),k=E(),T=E();ke(async()=>{v();try{X()}catch{await Me(),v()}});let P;function O(){const x=k.value;if(!x)return;const $=y(x);P!=null&&e.buffer-Math.abs($-P)>=10||(P=$,v())}let R=!1,B=!1;async function v(){var x;if(R){B=!0;return}if(!e.items||e.disabled)return;R=!0;const $=k.value,h=(x=T.value)==null?void 0:x.$el;if(!$||!h)return;o.value||(o.value=Pe()),t.value=oe(),a.value=pe(),await Me();let w,H=0;const j={},A=e.table?h.querySelector("tbody").children:h.children;for(let V=0;V<A.length;V++){const z=A[V],G=Ve(z,"position");if(G&&["absolute","fixed"].includes(G))continue;const he=Ve(z,"display")!=="none"?D(z):0,be=z.getAttribute("vt-index"),Oe=be?parseInt(be):t.value+H;j[Oe]=(j[Oe]||0)+he,H++}for(const V of Object.keys(j)){const z=parseInt(V);d.value[z]!==j[z]&&(d.value[z]=j[z],w=!0)}w&&await Me(),R=!1,B&&(B=!1,v());function oe(){const V=y($)-F($)-e.buffer;return Ge(f.value,z=>z-V,{returnNearestIfNoHit:!0}).index}function pe(){const V=y($)-F($)+b($)+e.buffer;return Ge(f.value,z=>z-V,{returnNearestIfNoHit:!0}).index}function Pe(){const V=[],z=e.table?h.querySelector("tbody").children:h.children;for(let G=0;G<z.length;G++){const he=z[G],be=getComputedStyle(he);if(["absolute","fixed"].includes(be.position))continue;const Oe=D(he);if(V.push(Oe),V.length>=10)break}return V.length===0?0:V.reduce((G,he)=>G+he,0)/V.length}}function b(x){const $=getComputedStyle(x);let h=parseFloat(e.horizontal?$.width:$.height);return $.boxSizing==="border-box"&&(e.horizontal?h=h-parseFloat($.borderLeftWidth)-parseFloat($.borderRightWidth):h=h-parseFloat($.borderTopWidth)-parseFloat($.borderBottomWidth)),h}function D(x){let $=b(x);const h=getComputedStyle(x);return e.horizontal?$+=parseFloat(h.borderLeftWidth)+parseFloat(h.borderRightWidth)+parseFloat(h.marginLeft)+parseFloat(h.marginRight):$+=parseFloat(h.borderTopWidth)+parseFloat(h.borderBottomWidth)+parseFloat(h.marginTop)+parseFloat(h.marginBottom),$=Number.isNaN($)?0:$,$}function y(x){return e.horizontal?x.scrollLeft:x.scrollTop}function F(x){const $=getComputedStyle(x);return e.horizontal?parseFloat($.paddingLeft):parseFloat($.paddingTop)}function I(x){return f.value[x]}function X(){const x=k.value;new ResizeObserver($=>{for(let h of $)if(Be(h.target,"vtlist")){v();break}}).observe(x)}function L(x,$){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return $;if(typeof e.itemKey=="function")return e.itemKey(x,$)}}return{listElRef:k,listInnerRef:T,onscroll:O,listStyle:c,listInnerStyle:i,visibleItemsInfo:g,getItemKey:L,update:v,sizes:p,positions:f,runtimeSizes:d}}});function Pa(e,t,a,r,o,n){const l=se("VirtualListTable");return _(),C("div",{class:"vtlist",ref:"listElRef",style:ee(e.listStyle),onScrollPassive:t[0]||(t[0]=(...s)=>e.onscroll&&e.onscroll(...s))},[U(l,{class:"vtlist-inner",ref:"listInnerRef",style:ee(e.listInnerStyle),table:e.table},{prepend:K(()=>[Y(e.$slots,"prepend")]),append:K(()=>[Y(e.$slots,"append")]),default:K(()=>[e.disabled?(_(!0),C(Q,{key:0},fe(e.items,(s,c)=>Y(e.$slots,"default",{key:e.getItemKey(s,c),item:s,index:c})),128)):(_(!0),C(Q,{key:1},fe(e.visibleItemsInfo,({item:s,index:c})=>Y(e.$slots,"default",{key:e.getItemKey(s,c),item:s,index:c})),128))]),_:3},8,["style","table"])],36)}const Oa=bt(Ea,[["render",Pa]]);const we="children";function Na(e){const a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={...Fa,...a,data:e,stats:null,statsFlat:null,_statsMap:null,initialized:!1,init(){const{data:n,childrenKey:l}=this,s=new Ze([]);this._statsMap=new Map,ce(n,(i,d,p,f)=>{const g=this.statHandler({...st(),data:i,open:!!this.defaultOpen,parent:s.getParent(f),children:[],level:f.length});this._statsMap.set(i,g),s.set(f,g)},{childrenKey:l});const c=[];s.walk(i=>{c.push(i)}),this.stats=this.statsHandler(s.rootChildren),this.statsFlat=this.statsFlatHandler(c),this.initialized=!0},getStat(n){let l=this._statsMap.get(n);if(!l)throw new ot("Stat not found");return l},has(n){if(n.isStat)return this.statsFlat.indexOf(n)>-1;try{return!!this.getStat(n)}catch(l){if(l instanceof ot)return!1;throw l}},_getPathByStat(n){if(n==null)return[];const s=this.getSiblings(n).indexOf(n);return[...n.parent?this._getPathByStat(n.parent):[],s]},afterOneCheckChanged(n){const{checked:l}=n;if(n._ignoreCheckedOnce)return delete n._ignoreCheckedOnce,!1;const s=c=>{const{parent:i}=c;if(i){let d,p,f;for(const k of i.children)k.checked?d=!0:k.checked===0?f=!0:p=!0;const g=f?0:p?d?0:!1:!0;i.checked!==g&&(this._ignoreCheckedOnce(i),i.checked=g),s(i)}};return s(n),ce(n.children,c=>{c.checked!==l&&(this._ignoreCheckedOnce(c),c.checked=l)},{childrenKey:we}),!0},_ignoreCheckedOnce(n){n._ignoreCheckedOnce=!0,setTimeout(()=>{n._ignoreCheckedOnce&&(n._ignoreCheckedOnce=!1)},100)},isVisible(n){const l=n.isStat?n:this.getStat(n),s=c=>!c||!c.hidden&&c.open&&s(c.parent);return!!(!l.hidden&&s(l.parent))},updateCheck(){ce(this.stats,n=>{if(n.children&&n.children.length>0){const l=n.children.every(i=>i.checked===!0),s=n.children.every(i=>i.checked===!1),c=l?!0:s?!1:0;n.checked!==c&&(this._ignoreCheckedOnce(n),n.checked=c)}},{childFirst:!0,childrenKey:we})},getChecked(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.statsFlat.filter(l=>l.checked||n&&l.checked===0)},getUnchecked(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.statsFlat.filter(l=>n?!l.checked:l.checked===!1)},openAll(){for(const n of this.statsFlat)n.open=!0},closeAll(){for(const n of this.statsFlat)n.open=!1},openNodeAndParents(n){const l=n.isStat?n:this.getStat(n);for(const s of this.iterateParent(l,{withSelf:!0}))s.open=!0},_calcFlatIndex(n,l){let s=n?this.statsFlat.indexOf(n)+1:0;const c=n?n.children:this.stats;for(let i=0;i<l;i++)s+=this._count(c[i]);return s},add(n,l,s){if(this.has(n))throw"Can't add because data exists in tree";const c=l?l.children:this.stats;s==null&&(s=c.length);const i=this.statHandler({...st(),open:!!this.defaultOpen,data:n,parent:l||null,children:[],level:l?l.level+1:1});this._setPosition(i,l||null,s);const d=n[this.childrenKey];if(d){const p=d.slice();for(const f of p)this.add(f,i)}},remove(n){const l=this.getSiblings(n);if(l.includes(n)){mt(l,n);const s=this._flat(n);this.statsFlat.splice(this.statsFlat.indexOf(n),s.length);for(const c of s)this._statsMap.delete(c.data);return this.afterRemoveStat(n),!0}return!1},getSiblings(n){const{parent:l}=n;return l?l.children:this.stats},_setPosition(n,l,s){(l?l.children:this.stats).splice(s,0,n),n.parent=l,n.level=l?l.level+1:1;const i=this._calcFlatIndex(l,s),d=this._flat(n);this.statsFlat.splice(i,0,...d);for(const p of d)this._statsMap.has(p.data)||this._statsMap.set(p.data,p);ce(n,(p,f,g)=>{g&&(p.level=g.level+1)},{childrenKey:we}),this.afterSetStat(n,l,s)},*iterateParent(n,l){let s=l!=null&&l.withSelf?n:n.parent;for(;s;)yield s,s=s.parent},move(n,l,s){if(this.has(n)){if(n.parent===l&&this.getSiblings(n).indexOf(n)===s)return!1;if(n===l)throw new Error("Can't move node to it self");if(l&&n.level<l.level){let c;for(const i of this.iterateParent(l))if(i.level===n.level){c=i;break}if(n===c)throw new Error("Can't move node to its descendant")}this.remove(n)}return this._setPosition(n,l,s),!0},_flat(n){const l=[];return ce(n,s=>{l.push(s)},{childrenKey:we}),l},_count(n){return this._flat(n).length},getData(n,l){const{childrenKey:s}=this,c=new Ze([]);return c.childrenKey=s,ce(l||this.stats,(i,d,p,f)=>{let g={...i.data,[s]:[]};n&&(g=n(g)),c.set(f,g)},{childrenKey:we}),c.data}},o=r;return r.noInitialization||o.init(),o}const Fa={childrenKey:"children",defaultOpen:!1,statsHandler(e){return e},statsFlatHandler(e){return e},afterSetStat(e,t,a){},afterRemoveStat(e){},statHandler(e){return e}};function st(){return{isStat:!0,hidden:!1,checked:!1,style:null,class:null,draggable:null,droppable:null}}class ot extends Error{constructor(t){super(t),this.name="StatNotFoundError"}}const Ne={start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","touchend"]},Ke={isTouch(e){return e.type&&e.type.startsWith("touch")},_getStore(e){return e._wrapperStore||(e._wrapperStore=[]),e._wrapperStore},on(e,t,a,r){const{args:o,mouseArgs:n,touchArgs:l}=it(r),s=this._getStore(e),c=this,i=function(d){let p;if(c.isTouch(d))p={x:d.changedTouches[0].pageX,y:d.changedTouches[0].pageY,pageX:d.changedTouches[0].pageX,pageY:d.changedTouches[0].pageY,clientX:d.changedTouches[0].clientX,clientY:d.changedTouches[0].clientY,screenX:d.changedTouches[0].screenX,screenY:d.changedTouches[0].screenY};else if(p={x:d.pageX,y:d.pageY,pageX:d.pageX,pageY:d.pageY,clientX:d.clientX,clientY:d.clientY,screenX:d.screenX,screenY:d.screenY},t==="start"&&d.which!==1)return;return a.call(this,d,p)};s.push({handler:a,wrapper:i}),ue.call(null,e,Ne[t][0],i,...o,...n),ue.call(null,e,Ne[t][1],i,...o,...l)},off(e,t,a,r){const{args:o,mouseArgs:n}=it(r),l=this._getStore(e);for(let s=l.length-1;s>=0;s--){const{handler:c,wrapper:i}=l[s];a===c&&(de.call(null,e,Ne[t][0],i,...o,...n),de.call(null,e,Ne[t][1],i,...o,...n),l.splice(s,1))}}};function it(e){e||(e={});const t=e.args||[],a=e.mouseArgs||[],r=e.touchArgs||[];return{args:t,mouseArgs:a,touchArgs:r}}const He=new Map,me={triggerElement:null,dragElement:null,internal:!1,dropEffect:"none",preventDefault:!1},ne=me;function De(e){e.dataTransfer&&(e.dataTransfer.dropEffect=ne.dropEffect)}function La(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(He.has(e))throw"Already registered on specified element";const a={...t},r=a;vt(a,Aa),Ke.on(e,"start",o,{touchArgs:[{passive:!0}]}),Ke.on(e,"end",n);function o(p){var f;const g=p.target;g.nodeType===Node.ELEMENT_NODE&&(ne.triggerElement=g);const k=g;if(a.ingoreHTMLTags&&k.tagName&&a.ingoreHTMLTags.find(P=>P.toUpperCase()===k.tagName))return;const T=(f=a.beforeDragStart)===null||f===void 0?void 0:f.call(a,p);T&&(T.setAttribute("draggable","true"),ne.dragElement=T)}function n(p){ne.dragElement&&ne.dragElement.removeAttribute("draggable")}function l(p){var f;ne.internal=!0,(f=a.onDragStart)===null||f===void 0||f.call(a,p),De(p)}function s(p){var f;(f=a.onDrag)===null||f===void 0||f.call(a,p),De(p)}function c(p){var f;(f=a.onDragEnd)===null||f===void 0||f.call(a,p),ne.internal=!1,ne.dragElement&&ne.dragElement.removeAttribute("draggable"),ne.triggerElement=null,ne.dragElement=null,ne.dropEffect="none"}const i=Ba(e,{onDragLeave(p){var f;(f=a.onDragLeave)===null||f===void 0||f.call(a,p),De(p)},onDragEnter(p){var f;r.ifPreventDefault(p)&&p.preventDefault(),(f=a.onDragEnter)===null||f===void 0||f.call(a,p),De(p)},onDragOver(p){var f;r.ifPreventDefault(p)&&p.preventDefault(),(f=a.onDragOver)===null||f===void 0||f.call(a,p),De(p)},onDrop(p){var f;r.ifPreventDefault(p)&&p.preventDefault(),(f=a.onDrop)===null||f===void 0||f.call(a,p)},onEnter(p){var f;(f=a.onEnter)===null||f===void 0||f.call(a,p)},onLeave(p){var f;(f=a.onLeave)===null||f===void 0||f.call(a,p)}});return ue(e,"dragstart",l),ue(e,"drag",s),ue(e,"dragend",c),Object.assign(a,{root:e,destroy:()=>{Ke.off(e,"start",o,{touchArgs:[{passive:!0}]}),de(e,"dragstart",l),de(e,"drag",s),de(e,"dragend",c),i(),He.delete(e)}}),He.set(e,r),r}const Aa={ingoreHTMLTags:["INPUT","TEXTAREA","SELECT","OPTGROUP","OPTION"],ifPreventDefault(e){return me.dragElement?!0:ne.preventDefault},beforeDragStart(e){},onDragStart(e){},onDrag(e){},onDragEnter(e){},onDragLeave(e){},onDragOver(e){},onDragEnd(e){},onDrop(e){}};let Ue=null;const Ra=e=>{Ue=e,setTimeout(()=>{Ue=null},20)};function Ba(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=e;let r=!1;const o=g=>{var k;r=!0,(k=t.onEnter)===null||k===void 0||k.call(t,g),d.resume()},n=g=>{var k;Ra(g.target),(k=t.onDragEnter)===null||k===void 0||k.call(t,g),r||o(g)},l=g=>{var k;r||o(g),(k=t.onDragOver)===null||k===void 0||k.call(t,g)},s=g=>{var k;(k=t.onDragLeave)===null||k===void 0||k.call(t,g);const T=function(){var O;let R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:g;r=!1,(O=t.onLeave)===null||O===void 0||O.call(t,R),d.stop()},P=Ue;Ue=null,P&&wa(P,a)||T()},c=g=>{var k;(k=t.onDrop)===null||k===void 0||k.call(t,g)},i=g=>{var k;g instanceof KeyboardEvent&&g.key!=="Escape"||(r=!1,d.stop(),(k=t.onEndBeforeLeave)===null||k===void 0||k.call(t,g))},d=ka([[e,"drop",i],[window,"mouseup",i],[window,"touchend",i],[window,"keydown",i]]);d.stop();const p=()=>{ue(e,"dragenter",n),ue(e,"dragover",l),ue(e,"dragleave",s),ue(e,"drop",c)},f=()=>{de(e,"dragenter",n),de(e,"dragover",l),de(e,"dragleave",s),de(e,"drop",c),d.stop()};return p(),f}let ze=!1;const Va=()=>{ze=!0,setTimeout(()=>{ze=!1},100)},Ua=xe({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const a=q(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));Z(()=>e.stat.checked,n=>{ze||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),Z(()=>e.stat.open,n=>{ze||(t(n?"open":"close",e.stat),Va())});const r=q(()=>{const n=[],l=d=>{var p;if(d.parent){let f=(p=d.parent)==null?void 0:p.children.indexOf(d);do{f++;let g=d.parent.children[f];if(g){if(!g.hidden)return!0}else break}while(!0)}return!1},s=e.rtl?"right":"left",c=e.btt?"top":"bottom";let i=e.stat;for(;i;){let d=(i.level-2)*e.indent+e.treeLineOffset;const p=l(i),f=()=>{n.push({style:{[s]:d+"px",[c]:p?0:"50%"}})};i===e.stat?i.level>1&&f():p&&f(),i=i.parent}return n}),o=q(()=>{let n=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:n+"px"}});return{indentStyle:a,vLines:r,hLineStyle:o}}}),Je=(e,t)=>{const a=e.__vccOpts||e;for(const[r,o]of t)a[r]=o;return a},za={class:"tree-node-inner"},Ma={key:1,class:"tree-node",ref:"el"};function Ia(e,t,a,r,o,n){return e.table?(_(),C("tr",Ma,[Y(e.$slots,"default",{indentStyle:e.indentStyle})],512)):(_(),C("div",{key:0,class:le(["tree-node",{"tree-node--with-tree-line":e.treeLine}]),style:ee(e.indentStyle),ref:"el"},[e.treeLine?(_(),C(Q,{key:0},[(_(!0),C(Q,null,fe(e.vLines,l=>(_(),C("div",{class:"tree-line tree-vline",style:ee(l.style)},null,4))),256)),e.stat.level>1?(_(),C("div",{key:0,class:"tree-line tree-hline",style:ee(e.hLineStyle)},null,4)):M("",!0)],64)):M("",!0),u("div",za,[Y(e.$slots,"default",{indentStyle:e.indentStyle})])],6))}const Ka=Je(Ua,[["render",Ia]]);function Ha(e,t={}){const a={...t,statHandler(r){return this._statHandler2&&(r=this._statHandler2(r)),je(t.statHandler,ve(r))},statsHandler(r){return je(t.statsHandler,ve(r))},statsFlatHandler(r){return je(t.statsFlatHandler,ve(r))}};return Na(e,a)}function je(e,t){return e?e(t):t}const ja=xe({components:{VirtualList:Oa,TreeNode:Ka},props:{value:{required:ia,type:Array},modelValue:{required:ca,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>Ha([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return this.modelValue||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let a=e;return this.btt&&(a=a.slice(),a.reverse()),a.filter(r=>t(r))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit("update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:We(te("getStat")),has:We(te("has")),updateCheck:te("updateCheck"),getChecked:te("getChecked"),getUnchecked:te("getUnchecked"),openAll:te("openAll"),closeAll:te("closeAll"),openNodeAndParents:te("openNodeAndParents"),isVisible:te("isVisible"),move:ct("move"),add:We(ct("add")),addMulti(e,t,a){this.batchUpdate(()=>{let r=a;for(const o of e)this.add(o,t,r),r!=null&&r++})},remove:te("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const a of t)this.remove(a)})},iterateParent:te("iterateParent"),getSiblings:te("getSiblings"),getData:te("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const a=e();return this.batchUpdateWaiting=t,a}},watch:{processor:{immediate:!0,handler(e){if(e){const t=a=>{if(a){const{childrenKey:r}=this;return a[r]||(a[r]=[]),a[r]}else return this.valueComputed};e._statHandler2=this.statHandler?a=>a.data===this.placeholderData?a:this.statHandler(a):null,e.afterSetStat=(a,r,o)=>{const{childrenKey:n,updateBehavior:l}=this;let s=this.valueComputed;if(l==="new"){if(this.batchUpdateWaiting)return;s=this.getData()}else if(l==="modify"){const c=t(r?.data);c.includes(a.data)||c.splice(o,0,a.data)}this.batchUpdateWaiting||this._updateValue(s)},e.afterRemoveStat=a=>{var r;const{childrenKey:o,updateBehavior:n}=this;let l=this.valueComputed;if(n==="new"){if(this.batchUpdateWaiting)return;l=this.getData()}else if(n==="modify"){const s=t((r=a.parent)==null?void 0:r.data);mt(s,a.data)}this.batchUpdateWaiting||this._updateValue(l)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,pa(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:t}=this;t.data=e,t.init(),this.stats=t.stats,this.statsFlat=t.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function te(e){return function(...t){return this.processor[e](...t)}}function ct(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function We(e){return function(t,...a){return t&&(t=ve(t)),e.call(this,t,...a)}}const Wa={key:0,class:"drag-placeholder he-tree-drag-placeholder"},Xa=["colspan"],qa={class:"drag-placeholder he-tree-drag-placeholder"};function Ya(e,t,a,r,o,n){const l=se("TreeNode"),s=se("VirtualList");return _(),ie(s,{class:le(["he-tree",{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering}]),ref:"vtlist",items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},{prepend:K(()=>[Y(e.$slots,"prepend",{tree:e.self})]),default:K(({item:c,index:i})=>[U(l,{"vt-index":i,class:le([c.class,{"drag-placeholder-wrapper":c.data===e.placeholderData,"dragging-node":c===e.dragNode}]),style:ee(c.style),stat:c,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor,onClick:d=>e.$emit("click:node",c),onOpen:t[0]||(t[0]=d=>e.$emit("open:node",d)),onClose:t[1]||(t[1]=d=>e.$emit("close:node",d)),onCheck:t[2]||(t[2]=d=>e.$emit("check:node",d))},{default:K(({indentStyle:d})=>[c.data===e.placeholderData?(_(),C(Q,{key:0},[e.table?(_(),C("td",{key:1,style:ee(d),colspan:e.placeholderColspan},[u("div",qa,[Y(e.$slots,"placeholder",{tree:e.self})])],12,Xa)):(_(),C("div",Wa,[Y(e.$slots,"placeholder",{tree:e.self})]))],64)):Y(e.$slots,"default",{key:1,node:c.data,stat:c,indentStyle:d,tree:e.self},()=>[ae(W(c.data[e.textKey]),1)])]),_:2},1032,["vt-index","class","style","stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor","onClick"])]),append:K(()=>[Y(e.$slots,"append",{tree:e.self})]),_:3},8,["class","items","disabled","table","itemKey"])}const Za=Je(ja,[["render",Ya]]);let N=null,S=null,Xe,Ee,_e,Fe,qe,J,ut;const Ye={get targetInfo(){return Ee},get dragNode(){return J},get targetTree(){return S}},Ga=xe({extends:Za,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function},dragOverThrottleInterval:{type:Number,default:0}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const a=this.eachDraggable(e);if(a!=null)return a}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return at(this.rootDroppable,[this,N]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const a=this.eachDroppable(e);if(a!=null)return a}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return at((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(i,d)=>{let p=!0;return N&&N!==this&&(p=p&&this._isMoved),this.table&&!this._isDragCopy&&(p=p&&this._isDragCopy),p&&(i.x!==d.x||i.y!==d.y)},t=(i,d)=>{S.ignoreUpdate(()=>{if(!S.has(S.placeholderData)){if(S.table){let f=0;const g=S.getRootEl().querySelector("tr");if(g)for(const{value:k}of ha(g.children))Ve(k,"display")!=="none"&&(f+=k.colSpan||1);f<1&&(f=1),S.placeholderColspan=f}S.add(S.placeholderData)}const p=S.getStat(S.placeholderData);S.move(p,i,d)})},a=()=>{const i=this;if(i.has(i.placeholderData))return i.remove(i.getStat(i.placeholderData)),!0},r=i=>{i?me.dropEffect=N!=null&&N.dragCopy?"copy":"move":me.dropEffect="none"},o=i=>{const d=this;i?r(!0):d.keepPlaceholder?d.has(d.placeholderData)||r(!1):(a(),r(!1))};let n={x:0,y:0};const l=this.getRootEl();let s=null;const c=()=>{S!=null&&S.has(S.placeholderData)&&S.ignoreUpdate(()=>{S.remove(S.getStat(S.placeholderData)),N&&(N.dragNode.hidden=!1,N.dragOvering=!1)})};this.treeDraggableInstance=La(l,{beforeDragStart:i=>{if(!me.triggerElement)return;let d=this.triggerClass;(!d||d.length===0)&&(d="tree-node");let p=fa(d),f=rt(me.triggerElement,g=>{if(lt(g,p))return!0;if(Be(g,"tree-node"))return"break"},{withSelf:!0,until:l});if(s=rt(f,g=>{if(Be(g,"tree-node"))return!0},{withSelf:!0,until:l}),!!s){if(J=this.getNodeByElement(s),!J)throw"Can't find drag node";if(this.isDraggable(J))return this.$emit("before-drag-start",J),this.$emit("beforeDragStart",J),l}},onDragStart:i=>{var d,p,f;if(!s||!J)return;{const{x:T,y:P}=s.getBoundingClientRect(),{clientX:O,clientY:R}=i;(d=i.dataTransfer)==null||d.setDragImage(s,O-T,R-P)}qe={x:i.clientX,y:i.clientY},N=this,N.dragNode=J,Fe=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:i.clientX,y:i.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(s);{let T,P=0;if(this.table){let O=s.getBoundingClientRect();T={x:O.x,y:O.y},this.rtl&&(T.x=O.right),P=O.height}else if(!this.rtl)T=s.children[0].getBoundingClientRect().toJSON(),P=T.height;else{const O=s.children[0].getBoundingClientRect();T={x:O.right,y:O.y},P=O.height}return this.btt&&(T.y+=P),T}})(),this.dragOvering=!0;const g=N.getSiblings(N.dragNode),k=g.indexOf(J);Xe={tree:N,dragNode:J,parent:J.parent,siblings:g,indexBeforeDrop:k},S=this,(p=i.dataTransfer)==null||p.setData("text",`he-tree drag start at ${new Date().toISOString()}`),N._eachDroppable()||setTimeout(()=>{J.hidden=!0,t(J.parent,k+1)},0),(f=this.ondragstart)==null||f.call(this,i)},onEnter:i=>{this.$emit("enter",i)},onLeave:i=>{_e=null,this.dragOvering=!1,me.preventDefault=!1,a(),this.$emit("leave",i)},onDragOver:ba(i=>{if(!N){if(!this.onExternalDragOver||this.onExternalDragOver(i)===!1)return;me.preventDefault=!0}if(this.dragOverThrottleInterval>0)if(this._lastValidDragOver==null)this._lastValidDragOver=new Date().getTime();else{let h=new Date().getTime();if(h-this._lastValidDragOver>this.dragOverThrottleInterval)this._lastValidDragOver=h;else return}const d={x:i.clientX,y:i.clientY},p=e(d,n);if(n=d,!p)return;this.dragOvering=!0,S=this;const f=Fe?{x:Fe.x+(d.x-qe.x),y:Fe.y+(d.y-qe.y)}:{...d},{btt:g,rtl:k}=S;if(S.disableDrop){me.dropEffect="none";return}let T,P;const O=S.getRootEl().querySelectorAll(".tree-node"),R=[];O.forEach(h=>{!lt(h,["drag-placeholder-wrapper","dragging-node"])&&Ve(h,"display")!=="none"&&R.push(h)});const B=Ge(R,h=>Ie(h)[g?"bottom":"top"]-f.y,{returnNearestIfNoHit:!0});let v=null,b,D;B.hit||(B.greater?g||(v=B.index-1,R[v]||v++):g&&(v=B.index+1,R[v]||v--)),v==null&&(v=B.index),b=R[v],D=g?R[v-1]:R[v+1],T=b&&S.getNodeByElement(b),P=D&&S.getNodeByElement(D);const{indent:y}=S,F=Te(()=>{if(S.table){let h=Ie(b).toJSON();const w=y*(T.level-1);return k?(h.width-=w,h.right-=w):h.x+=w,h}else return Ie(b.firstElementChild)}).action,I=Te(()=>g?f.y>F().y+F().height/2:f.y<F().y+F().height/2).action,X=Te(()=>g?!b||v===R.length-1&&I():!b||v===0&&I()).action,L=Te(()=>k?f.x-(F().x+F().width):F().x-f.x).action,x=Te(()=>k?f.x<F().x+F().width-y:f.x>F().x+y).action;let $;if(X())$=1,T=null;else if(T)L()>0?$=T.level-Math.ceil(L()/y):x()?$=T.level+1:$=T.level;else return;P&&$<P.level&&($=P.level),(async()=>{let h,w,H=!1,j=null;const A=async V=>{if(V.open)return!0;if(S.dragOpen)if(S.dragOpenDelay)if(j=V,_e===V)H=!0;else{let z=_a();_e=V;const G=V;return setTimeout(async()=>{G!==_e?(H=!0,z.resolve(!0)):(S.beforeDragOpen&&await S.beforeDragOpen(V),G!==_e?(H=!0,z.resolve(!0)):(V.open=!0,j=null,z.resolve(!0)))},S.dragOpenDelay),await z.promise}else return S.beforeDragOpen&&await S.beforeDragOpen(V),V.open=!0,!0;else return!1},oe=async()=>{if(S.isDroppable(T)&&await A(T)){if(H)return;h=T,w=null}else return!1},pe=(V=$)=>{let z=T,G=[];for(;z&&z.level>=V;)z=z.parent||null,G.unshift(z);let he=0;for(const be of G){if(S.isDroppable(be))return h=be,w=G[he+1]||T,!0;he++}return!1};ut=T||null,T?$>T.level?await oe()===!1&&pe(T.level):pe()===!1&&await oe():S.isDroppable(null)&&(h=null),_e=j;const Pe=!!(!H&&(h||h===null));return{cancelled:H,success:Pe,parent:h,index:Pe?w?(h?h.children:S.stats).filter(V=>V.data!==S.placeholderData).indexOf(w)+1:0:-1}})().then(h=>{if(!h.cancelled){if(!h.success){o(!1);return}if(S.maxLevel!=null&&S.maxLevel>0){let w=1;if(N){const H=N.dragNode;let j=0;ce(H,A=>{A.level>j&&(j=A.level)},{childrenKey:we}),w=j-H.level+1}if(w+(h.parent?h.parent.level:0)>S.maxLevel){o(!1);return}}o(!0),t(h.parent,h.index)}})}),onDrop:i=>{S=this;const d=!N;if(!S)return;const p=N?.dragNode;let f,g=(()=>{var k;let T=!0;if(!S.has(S.placeholderData))T=!1;else if(d)f=(k=this.externalDataHandler)==null?void 0:k.call(this,i),T=f!=null;else if(!N.dragCopy){const P=S.getStat(S.placeholderData);N===S&&P.parent===p.parent&&ya(p,O=>O===P)}return T})();if(g){const k=S.getStat(S.placeholderData),T=S.getSiblings(k);Ee={tree:S,dragNode:p,parent:k.parent,siblings:T,indexBeforeDrop:T.indexOf(k)}}(()=>{if(c(),g){let k=Ee.indexBeforeDrop;N&&!N.dragCopy&&N===S&&Xe.parent==Ee.parent&&Xe.indexBeforeDrop<k&&k--,N&&N!==S&&!N._eachDroppable()&&N.batchUpdate(()=>{N.remove(p),N.updateCheck()}),S.batchUpdate(()=>{let T=N?.dragNode,P;f?P=f:N._eachDroppable()&&(P=yt(N.dragNode.data,{childrenKey:N.childrenKey}),N.dragCopyDataHandler&&(P=N.dragCopyDataHandler(P))),P&&(S.add(P),T=S.getStat(P)),S.move(T,Ee.parent,k),S.updateCheck()})}S.$emit("after-drop"),g&&(N&&(N.dragCopy||N.$emit("change")),S!==N&&S.$emit("change"))})()},onDragEnd:i=>{c(),N&&(N.dragNode&&(N.dragNode.hidden=!1),N.dragNode=null,N.dragOvering=!1,N=null),S=null,_e=null,J=null,ut=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),Ja=xe({props:{open:{type:Boolean}}}),Qa=u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[u("title",null,"chevron-right"),u("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"})],-1),er=[Qa];function tr(e,t,a,r,o,n){return _(),C("a",{class:le(["he-tree__open-icon",{open:e.open}])},er,2)}const nr=Je(Ja,[["render",tr]]),ar={class:"ms-2 tree-pannel"},rr=["onDragover"],lr=["onClick"],sr=["onContextmenu","onClick"],or={key:0,class:"icon-small fa-link fas mx-1"},ir={key:1,class:"icon-small fas fa-eye mx-1"},cr={__name:"TreeArticle",setup(e){const t=ye();Z(()=>t.article.id,()=>{i(t.article.id)}),Z(()=>t.article,()=>{t?.article?.title&&typeof r?.text!=null&&(r.text=t?.article?.title,r.menuOn=t?.article?.menuOn,r.isRoute=t?.article?.isRoute,document.title=t.article.title)},{deep:!0}),ke(()=>{i(t.article.id)});function a(v,b){b(v),v?.children&&v.children.forEach(D=>{a(D,b)})}let r=null;const o=E(t.article.id);Z(o,()=>{t.loadRec(o.value)});const n=E(0),l=E([]),s=E(),c=E([]);async function i(v){const b=await apiArt({command:"makeHeTree",id:v});o.value=v,l.value=b,a(l.value[0],D=>{D.lazy=!!(D?.directory&&!D?.children),D?.id===v&&(r=D)})}async function d(v,b,D){try{const y=await apiArt({command:"createNew",id:v.id}),F={id:y.id,text:y.title,parentId:y.parentId,directory:!1,npp:v.npp,children:[]},I=b;D.add(F,I,b.children.length),I.open=!0,o.value=y.id,document.showToast("Создано")}catch{return}}async function p(v,b,D){if(v.id==1){document.showToast("Не стоит удалять root");return}if(!await document.confirmDialog("Удалить ?"+v.id))return;const y=b.parent;y||document.showToast("Ошибка удаления parent не найден","error");let F;try{F=await apiArt({command:"deleteById",id:v.id})}catch{return}if(!D.remove(b)){document.showToast("Ошибка удаления элемента, перезагрузите","error");return}o.value=y.data.id??null,y.open=!0,y.data.directory=F.directory,y.data.text=F.title,D.openNodeAndParents(y),document.showToast("Удалено")}function f(v,b,D,y){c.value=[{label:"Новой вкладке",icon:"fas fa-link",command:()=>{window.open(location.pathname+"#"+b.id,"_blank")}},{label:"Создать",icon:"fas fa-plus",command:()=>d(b,D,y)},{label:"Удалить",icon:"fas fa-trash",command:()=>p(b,D,y)},{label:"Копировать",icon:"fas fa-copy",command:()=>g(b,D,y)}],s.value.show(v)}async function g(v,b,D){try{const y=await apiArt({command:"copyRec",id:v.id}),F={id:y.id,text:y.title,parentId:v.id,directory:!1,npp:v.npp,children:[]},I=b.parent;D.add(F,I,v.npp),I.open=!0,o.value=y.id,document.showToast("Скопировано")}catch{return}}function k(v,b){o.value=v.id}async function T(v,b,D){if(v.lazy&&!b?.data?.lazyLoad){b.data.lazyLoad=!0;let y;try{v._loading=!0,y=await apiArt({command:"getChildrens",id:v.id}),lazyLoad=!1}catch{}finally{v._loading=!1,b.data.lazy=!1}D.batchUpdate(()=>{D.addMulti(y,b,b.children.length),b.open=!0})}else b.open=!b.open}let P=null;function O(){const{dragNode:v}=Ye,b=v.parent??null,D=b?b.children.indexOf(v):0;P={parent:b,index:D},o.value=v.data.id}async function R(){const{dragNode:v,targetInfo:b}=Ye,D=v.data.id;if(D===1){B(v);return}const y=b?.parent??null,F=y?.data?.id??null;if(!F){B(v);return}const I=b.siblings??y.children??[],X=I.findIndex(x=>x===v||x.data?.id===D),L=X>0?I[X-1].data?.id??0:0;try{const x=await apiArt({command:"move",id:D,newParentId:F,idBrotherUp:L});y&&(y.open=!0)}catch{B(v);return}}function B(v){const{targetTree:b}=Ye;P?.parent&&b&&(b.move(v,P.parent,P.index),P.parent.open=!0)}return(v,b)=>{const D=se("ContextMenu");return _(),C("div",ar,[(_(),ie(m(Ga),{class:"mtl-tree my-2",modelValue:l.value,"onUpdate:modelValue":b[0]||(b[0]=y=>l.value=y),key:n.value,onAfterDrop:R,ondragstart:O,treeLine:""},{default:K(({node:y,stat:F,tree:I})=>[u("div",{class:"d-flex pointer",onDragover:Ae(X=>y.lazy?T(y,F,I):"",["stop","prevent"])},[u("div",null,[F.children.length?(_(),ie(m(nr),{key:0,open:F.open,class:"m-0 p-0",onClick:X=>F.open=!F.open},null,8,["open","onClick"])):M("",!0)]),y.lazy?(_(),C("div",{key:0,onClick:X=>T(y,F,I)},[...b[1]||(b[1]=[u("i",{class:"fas fa-chevron-right me-1"},null,-1)])],8,lr)):M("",!0),u("div",{onContextmenu:Ae(X=>f(X,y,F,I),["prevent"]),class:le({active:y.id==o.value,notroute:!y.isRoute,route:y.isRoute}),onClick:X=>k(y,F)},[u("span",{style:ee(y.directory?"margin-left:-3px":"margin-left:3px")},null,4),ae(W(y.text)+" ",1),y.isRoute?(_(),C("i",or)):M("",!0),y.menuOn?(_(),C("i",ir)):M("",!0)],42,sr)],40,rr)]),_:1},8,["modelValue"])),U(D,{ref_key:"menu",ref:s,model:c.value},null,8,["model"])])}}},ur={class:"ms-2 tree-pannel"},dr={class:"row my-1"},fr={class:"input-group input-group-sm"},pr=["textContent","onClick"],hr={__name:"FindText",setup(e){const t=ye(),a=E([]),r=E("");async function o(){a.value=await t.search(r.value)}async function n(l){await t.loadRec(l),t.article.body.search(r.value)>=0&&(t.searchTextView=r.value),t.article.controller.search(r.value)>=0&&(t.searchTextController=r.value)}return(l,s)=>(_(),C("div",ur,[u("div",dr,[u("div",fr,[u("button",{class:"btn btn-primary fas fa-times",onClick:s[0]||(s[0]=c=>m(t).statusLeftPannel="tree")}),re(u("input",{placeholder:"найти",type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=c=>r.value=c)},null,512),[[ge,r.value]]),u("button",{class:"btn btn-primary fas fa-angle-right",onClick:s[2]||(s[2]=c=>o())})])]),(_(!0),C(Q,null,fe(a.value,c=>(_(),C("div",null,[u("span",{textContent:W(c.title),onClick:i=>n(c.id),class:le(["pointer",{active:m(t).article.id==c.id}])},null,10,pr)]))),256))]))}},mr=Xt(hr,[["__scopeId","data-v-f8b286bb"]]),gr={key:0},vr={style:{position:"relative"}},yr={__name:"EditArticle",setup(e){const t=ye(),a=E({show:!1,x:0,y:0});function r(){t.article.routeParams.useController||(p.value=0,g.value="view"),t.article.routeParams.useController&&(p.value=50,g.value="full"),t.modeEditorSplitter=g.value,d.value.resetState()}const o=E(null),n=E(20);let l=0;const s=E("open"),c=P=>{n.value=P.sizes[0]};function i(){s.value=="open"?(l=n.value,n.value=0,s.value="hidden"):(n.value=l,s.value="open"),t.modeTreeSplitter=s.value,o.value.resetState()}const d=E(),p=E(50);let f=0;const g=E("full");Z(d,()=>{r()});function k(P){p.value=P.sizes[0]}function T(){switch(g.value){case"full":f=p.value,p.value=0,g.value="view";break;case"view":p.value=100,g.value="controller";break;case"controller":p.value=f,g.value="full";break}t.modeEditorSplitter=g.value,d.value.resetState()}return ke(()=>{const P=document.getElementById("editor-layer").getBoundingClientRect();a.value.y=window.innerHeight-P.top,a.value.x=window.innerWidth,a.value.show=!0,t.toggleTreeSplitter=i,t.toggleEditorSplitter=T,Z(()=>t.article.routeParams.useController,()=>{r()})}),(P,O)=>{const R=se("SplitterPanel"),B=se("Splitter");return _(),C("div",null,[u("div",{style:ee({height:a.value.y+"px",width:a.value.x+"px"}),id:"editor-layer"},[a.value.show?(_(),C("div",gr,[U(B,{style:ee({height:a.value.y+"px",width:a.value.x+"px"}),onResizeend:c,ref_key:"splitterTreeRef",ref:o},{default:K(()=>[U(R,{size:n.value,minSize:0},{default:K(()=>[u("div",vr,[re(u("button",{style:{position:"absolute",right:"10px","z-index":"1000"},class:"btn btn-primary fas fa-search",onClick:O[0]||(O[0]=v=>m(t).statusLeftPannel="find")},null,512),[[Le,m(t).statusLeftPannel==="tree"]])]),re(U(cr,null,null,512),[[Le,m(t).statusLeftPannel==="tree"]]),re(U(mr,null,null,512),[[Le,m(t).statusLeftPannel==="find"]])]),_:1},8,["size"]),U(R,{size:100-n.value,minSize:1},{default:K(()=>[U(B,{style:{height:"100%"},onResizeend:k,ref_key:"splitEditorRef",ref:d},{default:K(()=>[U(R,{size:p.value,minSize:1},{default:K(()=>[U(tt,{modelValue:m(t).article.controller,"onUpdate:modelValue":O[1]||(O[1]=v=>m(t).article.controller=v),lang:"php",theme:m(t).aceTheme,height:a.value.y},null,8,["modelValue","theme","height"])]),_:1},8,["size"]),U(R,{size:100-p.value,minSize:1},{default:K(()=>[U(tt,{modelValue:m(t).article.body,"onUpdate:modelValue":O[2]||(O[2]=v=>m(t).article.body=v),lang:"html",theme:m(t).aceTheme,height:a.value.y},null,8,["modelValue","theme","height"])]),_:1},8,["size"])]),_:1},512)]),_:1},8,["size"])]),_:1},8,["style"])])):M("",!0)],4)])}}},br={class:"d-flex"},_r=["src"],wr={class:"flex-grow-1"},kr={key:0,class:"text-danger"},$r={key:0},xr={key:0,class:"text-danger ms-2"},Sr=["onClick"],Cr={class:"progress mt-2",style:{height:"10px"}},Tr={__name:"UploadFile",props:{path:{type:String,required:!0},directory:{type:Object,required:!0}},emits:["uploaded"],setup(e,{expose:t,emit:a}){const r=a,o=e,n=E(!1),l=E(!1),s=E([]),c=q(()=>new Set((o.directory??[]).map(O=>(O.name??"").toLowerCase())));function i(){n.value=!0}function d(){n.value=!1,s.value=[]}function p(O,R){return new Promise((B,v)=>{const b=new XMLHttpRequest,D=new URLSearchParams({command:"uploadBin",path:o.path,filename:O.name});b.open("POST",`/a_dmin/api/fileManager?${D.toString()}`,!0),b.responseType="json",b.upload.onprogress=y=>{y.lengthComputable&&(s.value[R].progress=Math.round(y.loaded/y.total*100))},b.onload=()=>{const y=b.response;if(s.value[R].progress=100,s.value[R].status=b.status===200&&y?.status===!0?"ok":"error",s.value[R].status==="ok")r("uploaded",y.data),B(y.data);else{const F=y?.errorMsg||y?.message||`Ошибка загрузки (${b.status})`;v(new Error(F))}},b.onerror=()=>{s.value[R].status="error",v(new Error("Ошибка сети при загрузке файла"))},b.onabort=()=>{s.value[R].status="error",v(new Error("Загрузка отменена"))},b.setRequestHeader("Content-Type","application/octet-stream"),b.send(O)})}async function f(O){const R=Array.isArray(O?.files)?O.files:[];R.length&&(s.value=R.map(B=>({name:B.name,progress:0,status:"loading"})),l.value=!0,await Promise.all(R.map(async(B,v)=>{try{await p(B,v)}catch(b){document.showToast(b.message||"Ошибка загрузки файла","error")}})),l.value=!1,P.value?.clear())}function g(O){return c.value.has(O.toLowerCase())}function k(O){return URL.createObjectURL(O)}function T(O){return!!O&&typeof O.type=="string"&&O.type.startsWith("image/")}const P=E(null);return t({open:i,close:d}),(O,R)=>{const B=se("FileUpload"),v=se("Dialog");return _(),ie(v,{visible:n.value,"onUpdate:visible":R[0]||(R[0]=b=>n.value=b),modal:"",header:"Загрузка файлов",class:"w-50"},{default:K(()=>[U(B,{name:"files[]",mode:"advanced",multiple:"",chooseLabel:"Выбрать файлы",uploadLabel:"Загрузить",cancelLabel:"Отмена",customUpload:"",auto:!1,maxFileSize:5e8,ref_key:"uploader",ref:P,onUploader:f},{content:K(({files:b})=>[(_(!0),C(Q,null,fe(b,(D,y)=>(_(),C("div",{key:D.name,class:"mb-2"},[u("div",null,[u("div",br,[u("div",null,[T(D)?(_(),C("img",{key:0,src:k(D),alt:"",style:{width:"96px",height:"auto"},class:"me-2 rounded border"},null,8,_r)):M("",!0)]),u("div",wr,[u("div",null,[u("small",null,W(D.name),1)]),g(D.name)&&!l.value?(_(),C("div",kr,"копия — будет переписан")):M("",!0),u("div",null,[s.value[y]?(_(),C("small",$r,W(s.value[y].progress)+"%",1)):M("",!0)])]),g(D.name)?(_(),C("div",xr,[u("i",{class:"fas fa-times pointer",onClick:F=>b.splice(y,1)},null,8,Sr)])):M("",!0)])]),u("div",Cr,[u("div",{class:le(["progress-bar",{"bg-success":s.value[y]?.status==="ok","bg-danger":s.value[y]?.status==="error","progress-bar-striped progress-bar-animated":s.value[y]?.status==="loading"}]),role:"progressbar",style:ee({width:(s.value[y]?.progress||0)+"%"})},null,6)])]))),128))]),_:1},512)]),_:1},8,["visible"])}}},Dr={key:0,class:"d-flex my-1"},Er={class:"me-2 icon"},Pr={key:0},Or={class:"ms-1",style:{"font-size":"85%"}},Nr=["textContent"],Fr={key:0,class:"thumb-pic"},Lr=["src"],Ar={class:"file-name"},Rr={class:"file-name file-size"},Br=["textContent"],Vr={key:1,class:"thumb-file"},Ur={style:{"word-break":"break-all"}},zr={class:"text-center file-size"},Mr=["textContent"],Ir={__name:"FileItem",props:{el:{type:Object,required:!0},viewFull:Boolean,viewSize:Number,path:String},setup(e){const t=e,a=E("");function r(n){if(t.el.type!=="file")return"dir";let l=Number(t.el.size);return l>1e6?(l/1e6).toFixed(1)+" m":l>1e3?(l/1e3).toFixed(1)+" k":l+" b"}ke(()=>{a.value=r()});function o(n,l){return t.viewSize>n&&t.viewSize>l?`width: ${n} px; height:  ${l} px;`:n>=l?"width:"+(t.viewSize-2)+"px;":"height:"+(t.viewSize-2)+"px;"}return(n,l)=>e.viewFull?(_(),C("div",{key:1,class:"thumb",style:ee(`width:${e.viewSize}px;`)},[e.el.isImage?(_(),C("div",Fr,[u("img",{src:e.path+e.el.name+"?"+e.el.date,style:ee(o(e.el.width,e.el.height))},null,12,Lr),u("div",Ar,[ae(W(e.el.name),1),l[0]||(l[0]=u("br",null,null,-1)),ae("("+W(e.el.width)+"x"+W(e.el.height)+")",1)]),u("div",Rr,[u("span",{textContent:W(a.value)},null,8,Br)])])):(_(),C("div",Vr,[l[1]||(l[1]=u("i",{class:"far fa-file",style:{"font-size":"300%",color:"#777"}},null,-1)),u("div",Ur,W(e.el.name),1),u("div",zr,[u("span",{textContent:W(a.value)},null,8,Mr)])]))],4)):(_(),C("div",Dr,[u("div",Er,[u("i",{class:le({"far fa-file-image":e.el.isImage,"far fa-file":!e.el.isImage})},null,2)]),u("div",null,[ae(W(e.el.name)+" ",1),e.el.isImage?(_(),C("span",Pr,[u("span",Or,"("+W(e.el.width)+"x"+W(e.el.height)+")",1)])):M("",!0),u("span",{class:"ms-1 file-size",textContent:W(a.value)},null,8,Nr)])]))}},Kr={class:"d-flex align-items-center gap-2 p-1 rounded w-100 border"},Hr={class:"flex-grow-1"},jr=["onClick"],Wr={key:0,class:"mt-2"},Xr={key:0,class:"my-5 py-5 text-center"},qr={class:"d-flex folder"},Yr={class:"me-2"},Zr=["onClick"],Gr=["onContextmenu","onClick"],Jr={key:1,class:"text-center p-3"},Qr={class:"mb-3"},el={class:"mb-3"},tl={__name:"FileManager",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:["update:visible"],setup(e){const t=dt(e,"visible"),a=E(null),r=E("/design/"),o=E("/design/");o.value=r.value;const n=E([]),l=E([]),s=E(!0),c=E(160),i=E(!1),d=ve({visible:!1,newFolderName:""});ke(async()=>{await g(o.value),await B(o.value)});async function p(){l.value.length>0&&(o.value=l.value.pop()),await B(o.value)}function f(){d.newFolderName="",d.visible=!0}async function g(){try{i.value=!1;const h=await Ce({command:"start"});r.value=h.startDirectory,o.value=h.startDirectory}catch(h){console.error(h)}finally{i.value=!0}}async function k(h){if(await document.confirmDialog("Удалить?"+o.value+h))try{i.value=!1,await Ce({command:"delete",deleteFile:o.value+h}),n.value=n.value.filter(w=>w.name!==h),document.showToast("Удален "+h)}catch(w){console.error(w)}finally{i.value=!0}}async function T(){if(d.newFolderName.trim())try{i.value=!1,await Ce({command:"mkdir",folderName:o.value+d.newFolderName.trim()}),await B(o.value)}catch(h){console.error(h)}finally{d.visible=!1,i.value=!0}}function P(){a.value.open()}async function O(h){try{i.value=!1,l.value.push(o.value),o.value=o.value+h+"/",await B(o.value)}catch(w){console.error(w)}finally{i.value=!0}}function R(h){document.showToast("Загружен "+h.name),n.value=n.value.filter(w=>w.name!==h.name),n.value.unshift(h)}async function B(h){try{i.value=!1,n.value=await Ce({command:"dirList",path:h})}catch(w){console.error(w)}finally{i.value=!0}}function v(h){const w=`<img src="${encodeURI(o.value+h.name)}" alt="${h.name}" height="${h.height}" width="${h.width}" />`;et(w)}function b(h){et(encodeURI(o.value+h.name))}const D=ve({visible:!1,fileName:"",edit:function(h){this.fileName=o.value+h.name,this.visible=!0}}),y=E(),F=E([]),I=h=>{h.key==="Escape"&&(h.stopPropagation(),y.value?.hide&&y.value.hide(),document.removeEventListener("keydown",I,!0))};function X(h,w,H){document.addEventListener("keydown",I,!0),F.value=[],w.type==="file"&&F.value.push({label:"Копировать путь",icon:"fas fa-link",command:()=>{b(w)}}),w.type==="file"&&w.isImage&&F.value.push({label:"Копировать Img",icon:"far fa-file-image",command:()=>{v(w)}}),w.type==="file"&&["css","js","ts","txt","csv","json","md"].includes(St(w.name))&&F.value.push({label:"Редактировать",icon:"fas fa-pen",command:()=>{D.edit(w)}}),F.value.push({label:"Переименовать",icon:"fas fa-plus",command:()=>{$.visible=!0,$.newName=w.name,$.oldName=w.name}}),F.value.push({label:"Удалить",icon:"fas fa-trash",command:()=>{k(w.name)}}),y.value.show(h)}async function L(h){if(l.value.length!==0){if(h===0){o.value=r.value,l.value=[],await B(o.value);return}h>=l.value.length||(o.value=l.value[h],l.value=l.value.slice(0,h),await B(o.value))}}const x=q(()=>o.value.split("/").filter(H=>H!=="").map((H,j)=>({name:H,index:j}))),$=ve({visible:!1,oldName:"",newName:"",rename:async function(){try{i.value=!1,await Ce({command:"rename",oldName:o.value+this.oldName,newName:o.value+this.newName}),n.value=n.value.map(h=>(h.name==this.oldName&&(h.name=this.newName),h)),this.visible=!1,document.showToast("Готово")}catch(h){console.error(h)}finally{i.value=!0}}});return(h,w)=>{const H=se("Dialog"),j=se("ContextMenu");return _(),C(Q,null,[U(Ht,{visible:t.value,"onUpdate:visible":w[1]||(w[1]=A=>t.value=A),zIndex:1e3},{header:K(()=>[u("div",Kr,[o.value!==r.value?(_(),C("button",{key:0,onClick:p,class:"btn btn-success fas fa-chevron-left"})):M("",!0),u("button",{onClick:f,class:"btn btn-success fas fa-folder-plus"}),u("button",{onClick:P,class:"btn btn-success fas fa-file-upload"}),u("div",Hr,[(_(!0),C(Q,null,fe(x.value,(A,oe)=>(_(),C("span",{key:oe},[u("span",{class:le(["path-element",{"path-end":oe===x.value.length-1}]),onClick:pe=>L(oe)},W(A.name),11,jr),w[11]||(w[11]=u("span",{class:"mx-1",style:{"font-size":"80%"}},"/",-1))]))),128))]),u("div",null,[u("button",{class:le(["btn btn-success",{"fas fa-list":s.value,"fas fa-th":!s.value}]),onClick:w[0]||(w[0]=A=>s.value=!s.value)},null,2)])])]),default:K(()=>[i.value?(_(),C("div",Wr,[n.value.length===0?(_(),C("div",Xr,"...")):M("",!0),(_(!0),C(Q,null,fe(n.value.filter(A=>A.type==="dir"),(A,oe)=>(_(),C("div",null,[u("div",qr,[u("div",Yr,[u("i",{class:"far fa-folder pointer",onClick:pe=>O(A.name)},null,8,Zr)]),u("div",{class:"pointer",onContextmenu:Ae(pe=>X(pe,A,oe),["prevent"]),onClick:pe=>O(A.name)},W(A.name),41,Gr)])]))),256)),u("div",{class:le([{"d-flex flex-wrap":s.value},""])},[(_(!0),C(Q,null,fe(n.value.filter(A=>A.type!=="dir"),A=>(_(),ie(Ir,{onContextmenu:Ae(oe=>X(oe,A,h.index),["prevent"]),key:A.name,el:A,viewFull:s.value,viewSize:c.value,path:o.value},null,8,["onContextmenu","el","viewFull","viewSize","path"]))),128))],2)])):(_(),C("div",Jr,[...w[12]||(w[12]=[u("div",{class:"spinner-border text-info"},null,-1)])]))]),_:1},8,["visible"]),U(H,{visible:d.visible,"onUpdate:visible":w[4]||(w[4]=A=>d.visible=A),header:"Создать папку",modal:""},{footer:K(()=>[u("button",{class:"btn btn-secondary btn-sm",onClick:w[3]||(w[3]=A=>d.visible=!1)},"Отмена"),u("button",{class:"btn btn-success btn-sm",onClick:T},"Создать")]),default:K(()=>[u("div",Qr,[w[13]||(w[13]=u("label",{class:"form-label"},"Имя новой папки",-1)),re(u("input",{"onUpdate:modelValue":w[2]||(w[2]=A=>d.newFolderName=A),type:"text",class:"form-control",placeholder:"Новая папка",onKeyup:Qe(T,["enter"])},null,544),[[ge,d.newFolderName]])])]),_:1},8,["visible"]),U(H,{visible:$.visible,"onUpdate:visible":w[9]||(w[9]=A=>$.visible=A),header:"Rename",modal:""},{footer:K(()=>[u("button",{class:"btn btn-secondary btn-sm",onClick:w[7]||(w[7]=A=>$.visible=!1)},"Отмена"),u("button",{class:"btn btn-success btn-sm",onClick:w[8]||(w[8]=(...A)=>$.rename&&$.rename(...A))},"Готово")]),default:K(()=>[u("div",el,[re(u("input",{"onUpdate:modelValue":w[5]||(w[5]=A=>$.newName=A),type:"text",class:"form-control",placeholder:"Новое имя",onKeyup:w[6]||(w[6]=Qe((...A)=>$.rename&&$.rename(...A),["enter"]))},null,544),[[ge,$.newName]])])]),_:1},8,["visible"]),U(Tr,{ref_key:"uploadRef",ref:a,path:o.value,directory:n.value,onUploaded:R,class:"w-50"},null,8,["path","directory"]),U(j,{ref_key:"menu",ref:y,model:F.value},null,8,["model"]),D.visible?(_(),ie(jt,{key:0,fileName:D.fileName,zIndex:1e3,onClose:w[10]||(w[10]=A=>D.visible=!1)},null,8,["fileName"])):M("",!0)],64)}}},nl={__name:"ArtEditor",setup(e){const t=ye(),a=E(1);ke(()=>{const o=new URLSearchParams(window.location.search);Object.fromEntries(o.entries()),t.loadRec(Number(location.hash.slice(1))||1),history.pushState(a.value,null,"#"+a.value),console.log("--start ediror--"),Ct("#ff642f"),window.addEventListener("popstate",r)}),Tt(()=>{window.removeEventListener("popstate",r)});const r=o=>{a.value=Number(location.hash.slice(1))||1};return(o,n)=>(_(),C(Q,null,[m(t).articleReady?(_(),ie(yn,{key:0})):M("",!0),m(t).articleReady?(_(),ie(yr,{key:1})):M("",!0),U(tl,{visible:m(t).statusFileManager,"onUpdate:visible":n[0]||(n[0]=l=>m(t).statusFileManager=l)},null,8,["visible"]),U(ta),m(t).articleReady?(_(),ie(ea,{key:2})):M("",!0),U(Dt)],64))}},al=[ft,Pt,Ot,Nt,Ft,Lt,At,Rt,Bt,It],Se=Et(nl);al.forEach(e=>{Se.component(e.name,e)});Se.use(Vt,{theme:{preset:Ut,options:{cssLayer:{name:"primevue",order:"theme, base, primevue"}}}});Se.use(zt);Se.use(ft);Se.use(Wt());Se.mount("#art_editor");Object.assign(globalThis,Mt);
