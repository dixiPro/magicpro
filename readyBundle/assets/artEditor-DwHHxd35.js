import{r as C,c as X,a as xe,t as xt,b as $,o as y,d as u,e as K,u as h,w as ie,v as ke,n as se,f as $t,F as te,g as pe,h as Z,i as oe,j as ce,k as H,l as z,m as le,p as Ne,q as dt,s as ft,x as Qe,y as ve,z as q,A as pt,B as ne,C as Se,D as G,E as Pe,G as Ie,H as Oe,I as $e,J as ht,K as St,L as Ct,M as Tt,N as Dt,T as mt,O as Et,P as Pt,Q as Ot,R as Lt,S as At,U as Ft,V as Nt,W as Rt,X as Vt,Y as Bt,Z as Ut,_ as zt}from"./apiCall-BbAjuLGo.js";import{s as Mt}from"./index-BspGk_zj.js";import{d as It,a as Re,M as gt,c as Kt}from"./javascript-53trRzPJ.js";import{_ as Ht}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Wt}from"./ToastConfirm-Elz3hPV4.js";async function vt(e,t=2){try{return await prettier.format(e,{parser:"php",plugins:prettierPlugins,tabWidth:t})}catch(a){throw console.error("Ошибка при форматировании Php:",a),new Error("Ошибка при форматировании Php")}}async function jt(e,t=2){let a=[],r=e.replace(/@php([\s\S]*?)@endphp/g,(o,c)=>{const i=a.length;return a.push(o),`<!--___PHP____${i}-->`}),s=[];r=r.replace(/@extends\s*\(\s*['"][^)]+?\[[\s\S]*?\]\s*\)/g,o=>{const c=s.length;return s.push(o),`<!--___EXTENDS____${c}-->`});let n=[];r=r.replace(/@props\s*\(\s*\[[\s\S]*?\]\s*\)/g,o=>{const c=n.length;return n.push(o),`<!--___PROPS____${c}-->`});let l=[];r=r.replace(/{{--([\s\S]*?)--}}/g,(o,c)=>{const i=l.length;return l.push(o),`<!--___COMMENT____${i}-->`}),a.length>0&&(a=await Promise.all(a.map(o=>Xt(o,t))));try{r=await prettier.format(r,{parser:"html",plugins:[prettierPlugins.html],tabWidth:t,printWidth:160})}catch(o){const c=o.message.split(`
`).map(i=>i.replace(/^\s+/,"")).map(i=>i.replace(/For more info.*/,"")).filter(i=>!i.includes("at")).join(`
`);document.showToast(c,"error")}return r=qt(r,t),r=r.replace(/<!--___PHP____(\d+)-->/g,(o,c)=>a[c]),r=r.replace(/<!--___PROPS____(\d+)-->/g,(o,c)=>n[c]),r=r.replace(/<!--___COMMENT____(\d+)-->/g,(o,c)=>l[c]),r=r.replace(/<!--___EXTENDS____(\d+)-->/g,(o,c)=>s[c]),r}async function Xt(e,t){e=e.replace(/@php\s*/g,"").replace(/\s*@endphp/g,"");let a=`<?php
${e}`,r=await vt(a,t);return r=r.replace(/^<\?php\s*/,"").trim(),r=r.split(`
`).map(s=>" ".repeat(t)+s).join(`
`),r=`@php
${r}
@endphp`,r}function qt(e,t=2){const a=e.split(`
`);let r=0;const s=[];for(let n of a){let l=Yt(n);for(let o of l){let c=Zt(o);o.includes("<!--___PHP____")?(o=o.replace(/^\s+/,""),s.push(o)):(r=r+c.ident,s.push(" ".repeat(r*t)+c.line),r=r+c.after)}}return s.join(`
`)}function Yt(e){const t=e.match(/^(\s*)/),a=t?t[1]:"",r=e.split(/(?=@\w+)/).map(s=>s.trim()).filter(Boolean);return r.length<=1?[e]:r.map(s=>a+s)}function Zt(e){const t={if:{ident:0,after:1},elseif:{ident:-1,after:1},else:{ident:-1,after:1},endif:{ident:-1,after:0},section:{ident:0,after:1,extended:{ident:0,after:0}},endsection:{ident:-1,after:0},foreach:{ident:0,after:1},endforeach:{ident:-1,after:0},forelse:{ident:0,after:1},endforelse:{ident:-1,after:0},for:{ident:0,after:1},endfor:{ident:-1,after:0},yield:{ident:1,after:-1},while:{ident:0,after:1},endwhile:{ident:-1,after:0},section:{ident:0,after:1},endsection:{ident:-1,after:0},switch:{ident:0,after:1},case:{ident:-1,after:1},endswitch:{ident:-1,after:0},endcase:{ident:-1,after:0},php:{ident:0,after:1},endphp:{ident:-1,after:0},livewire:{ident:0,after:1},endlivewire:{ident:-1,after:0},component:{ident:0,after:1},endcomponent:{ident:-1,after:0},slot:{ident:0,after:1},endslot:{ident:-1,after:0},props:{ident:0,after:0},error:{ident:0,after:1},enderror:{ident:-1,after:0},once:{ident:0,after:1},endonce:{ident:-1,after:0},push:{ident:0,after:1},endpush:{ident:-1,after:0},stack:{ident:0,after:1},endstack:{ident:-1,after:0},verbatim:{ident:0,after:1},endverbatim:{ident:-1,after:0},can:{ident:0,after:1},endcan:{ident:-1,after:0},cannot:{ident:0,after:1},endcannot:{ident:-1,after:0},auth:{ident:0,after:1},endauth:{ident:-1,after:0},guest:{ident:0,after:1},endguest:{ident:-1,after:0},mproauth:{ident:0,after:1},endmproauth:{ident:-1,after:0}};let a=(e.match(/@\w+/)||[null])[0];if(!a)return{ident:0,after:0,line:e};if(a=a.replace("@",""),!t[a])return{ident:0,after:0,line:e};let r=e.replace(new RegExp(`${a}\\s*\\(`,"g"),`${a}(`),s=t[a];return s.line=r,s.extended&&(r.match(new RegExp(`${a}\\(([^)]*)\\)`))||[null,""])[1].split(",").length>1?(s=t[a].extended,s.line=r,res):s}function Gt(e){const t={};let a=e.match(/\{% *setMeta\('title', *'([^']+)'/);return t.title=a?a[1]:null,a=e.match(/\{% *setMeta\('htmlDescr', *'([^']+)'/),t.description=a?a[1].trim():null,a=e.match(/\{% *setMeta\('keywords', *'([^']+)'/),t.keywords=a?a[1].trim():null,a=e.match(/\{% *setMeta\('h1', *'([^']+)'/),t.h1=a?a[1].trim():null,console.log(t),` @extends('magic::main',[
  'title' => '${t.title}',
  'description' => '${t.description}',
  'keywords' => '${t.keywords}'
])
  

<h1>${t.h1}</h1>

`+e}const ye=It("article",()=>{const e=C({}),t=X(()=>{if(e.value.name!=="")return/^[a-z0-9_-]+$/i.test(e.value.name)}),a=X(()=>/{%\s*.*?\s*%}/.test(e.value.body)),r=C(!1),s=C(!1),n=C(!1),l="chrome",o=["chrome","monokai","dracula","twilight"],c=C("tree"),i=C(!1),d=C(""),f=C("");async function p(F){const w=await xe({command:"getById",id:F});e.value=m(w),history.pushState(F,null,"#"+F),i.value=!0,document.title=e.value.title}function m(F){let w=F.routeParams;(Array.isArray(w)||w===null||typeof w!="object")&&(w={});const{adminOnly:E=!1,useController:k=!0,getEnable:W=!1,utmParamsEnable:Y=!0,bindKeys:D=!1,keysArr:T=[]}=w;return F.routeParams={useController:k,adminOnly:E,getEnable:W,utmParamsEnable:Y,bindKeys:D,keysArr:T},F}async function _(){e.value=await xe({command:"saveById",article:e.value}),document.showToast("Сохранено")}async function S(){try{const F=await xe({command:"getDefaultController",id:1});e.value.controller=F.controller}catch(F){console.log(F)}}async function P(F){try{const w=await xe({command:"articleByName",name:F});window.open(location.pathname+"#"+w.id,"_blank")}catch{}}async function O(){try{const F=await xe({command:"getDefaultLiveWareController",id:1});e.value.controller=F.controller}catch(F){console.log(F)}}async function N(F){try{return await xe({command:"search",text:F})}catch(w){console.log(w)}}async function B(){const F=await jt(e.value.body,2);e.value.body=F;const w=await vt(e.value.controller,2);e.value.controller=w,document.showToast("Отформатировано")}function g(){e.value.name=xt(e.value.title.trim())}const v=F=>{if(F.ctrlKey&&F.code==="KeyS"){F.preventDefault(),_();return}if(F.altKey&&F.code==="Digit4"){addPannel.value=!addPannel.value,F.preventDefault();return}if(F.altKey&&F.code==="Digit6"){splitStatusEditorObj.value.set("hideController"),F.preventDefault();return}if(F.altKey&&F.code==="Digit5"){splitStatusEditorObj.value.set("hideBlade"),F.preventDefault();return}if(F.altKey&&F.code==="Digit3"){const w=splitTreeStatusObj.value.status=="hideTree"?"normal":"hideTree";splitTreeStatusObj.value.set(w),F.preventDefault();return}};function L(){e.value.body=Gt(e.value.body)}const b=C(),R=C("open"),M=C(),j=C("full");return window.addEventListener("keydown",v),{article:e,statusHelp:r,statusAddPannel:s,statusFileManager:n,aceTheme:l,aceThemes:o,hasTwig:a,statusTranslitButton:t,hasTwig:a,statusLeftPannel:c,toggleTreeSplitter:b,modeTreeSplitter:R,toggleEditorSplitter:M,modeEditorSplitter:j,searchTextController:d,searchTextView:f,articleReady:i,loadRec:p,saveRec:_,getController:S,getLiveWareController:O,gotoArticleByName:P,formatDocument:B,translit:g,convertFromMro:L,search:N}}),Jt={class:"row gx-2 py-2 mx-0",style:{background:"#ffff001f"}},Qt={class:"col-auto"},en=["href"],tn={key:1,class:"btn btn-sm btn-secondary fas fa-external-link-alt"},nn={class:"col-3"},an={class:"input-group input-group-sm"},rn={key:0,class:"col-3"},ln={class:"input-group input-group-sm"},sn={class:"col-1"},on={class:"input-group input-group-sm"},cn={class:"col-auto"},un={key:1,class:"col-auto"},dn={class:"col-auto align-self-center"},fn={class:"col-auto"},pn={class:"col-auto"},hn=["value"],mn={class:"col text-end"},gn={__name:"TopMenu",setup(e){const t=ye(),a=C(""),r=X(()=>t.article.name==="index"?"/":"/"+t.article.name);return(s,n)=>(y(),$("div",Jt,[u("div",Qt,[h(t).article.isRoute?(y(),$("a",{key:0,target:"_blank",class:"fas fa-external-link-alt btn btn-sm btn-primary",href:r.value},null,8,en)):(y(),$("span",tn))]),u("div",nn,[u("div",an,[ie(u("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":n[0]||(n[0]=l=>h(t).article.name=l)},null,512),[[ke,h(t).article.name]]),h(t).statusTranslitButton?K("",!0):(y(),$("button",{key:0,class:"btn btn-sm btn-primary",onClick:n[1]||(n[1]=l=>h(t).translit())},"Translit→"))])]),h(t).statusTranslitButton?(y(),$("div",rn,[u("div",ln,[ie(u("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":n[2]||(n[2]=l=>h(t).article.title=l)},null,512),[[ke,h(t).article.title]]),u("button",{class:"btn btn-sm btn-primary",onClick:n[3]||(n[3]=l=>h(t).saveRec())},"Save→")])])):K("",!0),u("div",sn,[u("div",on,[ie(u("input",{placeholder:"перейти",type:"text",class:"form-control","onUpdate:modelValue":n[4]||(n[4]=l=>a.value=l)},null,512),[[ke,a.value]]),u("button",{class:"btn btn-primary fas fa-angle-right",onClick:n[5]||(n[5]=l=>h(t).gotoArticleByName(a.value))})])]),u("div",cn,[u("span",{class:se(["btn btn-success",{"fas fas fa-sitemap":h(t).modeTreeSplitter=="hidden","fas fa-ellipsis-h":h(t).modeTreeSplitter==="open"}]),onClick:n[6]||(n[6]=l=>h(t).toggleTreeSplitter())},null,2)]),h(t).article.routeParams.useController?(y(),$("div",un,[u("span",{class:se(["btn btn-success",{"fas fa-angle-left":h(t).modeEditorSplitter==="full","fas fa-angle-right":h(t).modeEditorSplitter==="view","fa fa-columns":h(t).modeEditorSplitter==="controller"}]),onClick:n[7]||(n[7]=l=>h(t).toggleEditorSplitter())},null,2)])):K("",!0),u("div",dn,[u("button",{class:"btn fas fa-magic btn-success",onClick:n[8]||(n[8]=l=>h(t).formatDocument())},"1")]),u("div",fn,[u("button",{onClick:n[9]||(n[9]=l=>h(t).statusHelp=!h(t).statusHelp),class:"fas fa-question btn btn-success"})]),u("div",pn,[ie(u("select",{"onUpdate:modelValue":n[10]||(n[10]=l=>h(t).aceTheme=l),class:"form-select form-select-sm"},[(y(!0),$(te,null,pe(h(t).aceThemes,l=>(y(),$("option",{key:l,value:l},Z(l),9,hn))),128))],512),[[$t,h(t).aceTheme]])]),u("div",mn,[h(t).hasTwig?(y(),$("button",{key:0,class:"btn btn-success fas fa-sync-alt btn-sm me-2",onClick:n[11]||(n[11]=l=>h(t).convertFromMro())})):K("",!0),u("button",{class:"btn btn-success fas fa-folder-open",onClick:n[12]||(n[12]=l=>h(t).statusFileManager=!h(t).statusFileManager)}),u("button",{class:"ms-1 btn btn-success fas fa-bars",onClick:n[13]||(n[13]=l=>h(t).statusAddPannel=!h(t).statusAddPannel)})])]))}},vn={class:""},yn={class:"my-2 d-flex"},bn={class:"nowrap"},_n={class:"d-flex my-2"},wn={class:"nowrap"},kn={class:"my-2 d-flex"},xn={class:"nowrap"},$n={key:0},Sn={class:"d-flex my-2"},Cn={class:"nowrap"},Tn={class:"d-flex my-2"},Dn={class:"nowrap"},En={class:"d-flex my-2"},Pn={class:"nowrap"},On={class:"ms-2"},Ln={key:0},An={class:"d-table"},Fn={class:"d-table-cell px-1 py-1 align-middle",style:{"min-width":"300px"}},Nn=["onUpdate:modelValue"],Rn={class:"d-table-cell px-1 py-1"},Vn=["onClick"],Bn={class:"d-table-cell px-1 py-1"},Un=["onClick"],zn={class:"d-table-cell px-1 py-1"},Mn=["onClick"],In={class:"row my-2"},Kn={class:"col-9"},Hn={class:"col-1"},Wn={key:1,class:"fas fa-plus"},jn={key:0,class:"d-flex my-2"},Xn={class:"nowrap"},qn={class:"mt-5"},Yn={class:"my-2"},Zn={class:"my-2"},Gn=["href"],Jn={__name:"RouteParam",setup(e){const t=ye(),a=C(""),r=C("");return(s,n)=>{const l=oe("ToggleSwitch"),o=oe("Drawer");return y(),ce(o,{visible:h(t).statusAddPannel,"onUpdate:visible":n[11]||(n[11]=c=>h(t).statusAddPannel=c),header:"Параметры",position:"right",style:{width:"600px"}},{default:H(()=>[u("div",vn,[u("div",yn,[u("div",bn,[z(l,{modelValue:h(t).article.menuOn,"onUpdate:modelValue":n[0]||(n[0]=c=>h(t).article.menuOn=c)},null,8,["modelValue"])]),n[12]||(n[12]=u("div",{class:"ms-2"},"menu",-1))]),u("div",_n,[u("div",wn,[z(l,{modelValue:h(t).article.routeParams.useController,"onUpdate:modelValue":n[1]||(n[1]=c=>h(t).article.routeParams.useController=c)},null,8,["modelValue"])]),n[13]||(n[13]=u("div",{class:"ms-2"},[le(" Испольовать контроллер "),u("div",{class:"small"},"Если нет, то будет вызываться просто вьюха")],-1))]),u("div",kn,[u("div",xn,[z(l,{modelValue:h(t).article.isRoute,"onUpdate:modelValue":n[2]||(n[2]=c=>h(t).article.isRoute=c)},null,8,["modelValue"])]),n[14]||(n[14]=u("div",{class:"ms-2"},"route",-1))]),h(t).article.isRoute?(y(),$("div",$n,[u("div",Sn,[u("div",Cn,[z(l,{modelValue:h(t).article.routeParams.adminOnly,"onUpdate:modelValue":n[3]||(n[3]=c=>h(t).article.routeParams.adminOnly=c)},null,8,["modelValue"])]),n[15]||(n[15]=u("div",{class:"ms-2"},"Только Админ (для отладки)",-1))]),u("div",Tn,[u("div",Dn,[z(l,{modelValue:h(t).article.routeParams.utmParamsEnable,"onUpdate:modelValue":n[4]||(n[4]=c=>h(t).article.routeParams.utmParamsEnable=c)},null,8,["modelValue"])]),n[16]||(n[16]=u("div",{class:"ms-2"},"Разрешить Utm ?=utm...",-1))]),u("div",En,[u("div",Pn,[z(l,{modelValue:h(t).article.routeParams.getEnable,"onUpdate:modelValue":n[5]||(n[5]=c=>h(t).article.routeParams.getEnable=c)},null,8,["modelValue"])]),u("div",On,[n[20]||(n[20]=u("div",null,"Использовать GET параметры",-1)),h(t).article.routeParams.getEnable?(y(),$("div",Ln,[n[18]||(n[18]=u("div",{class:"mt-2"},"Допустимые параметры",-1)),n[19]||(n[19]=u("div",{class:"small"},"Если пусто то все",-1)),u("div",An,[(y(!0),$(te,null,pe(h(t).article.routeParams.keysArr,(c,i)=>(y(),$("div",{class:"d-table-row",key:i},[u("div",Fn,[ie(u("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":d=>h(t).article.routeParams.keysArr[i]=d},null,8,Nn),[[ke,h(t).article.routeParams.keysArr[i]]])]),u("div",Rn,[ie(u("i",{class:"fas fa-arrow-circle-down",onClick:d=>{h(t).article.routeParams.swap=h(t).article.routeParams.keysArr[i+1],h(t).article.routeParams.keysArr[i+1]=h(t).article.routeParams.keysArr[i],h(t).article.routeParams.keysArr[i]=h(t).article.routeParams.swap,delete h(t).article.routeParams.swap}},null,8,Vn),[[Ne,h(t).article.routeParams.keysArr.length-1>i&&h(t).article.routeParams.bindKeys]])]),u("div",Bn,[i>0&&h(t).article.routeParams.bindKeys?(y(),$("i",{key:0,class:"fas fa-arrow-circle-up",onClick:d=>{r.value=h(t).article.routeParams.keysArr[i-1],h(t).article.routeParams.keysArr[i-1]=h(t).article.routeParams.keysArr[i],h(t).article.routeParams.keysArr[i]=r.value}},null,8,Un)):K("",!0)]),u("div",zn,[u("i",{class:"fas fa-trash",onClick:d=>h(t).article.routeParams.keysArr.splice(i,1)},null,8,Mn)])]))),128))]),u("div",In,[u("div",Kn,[ie(u("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":n[6]||(n[6]=c=>a.value=c)},null,512),[[ke,a.value]])]),u("div",Hn,[a.value.trim()!=""?(y(),$("span",{key:0,class:"fas fa-plus",onClick:n[7]||(n[7]=c=>{h(t).article.routeParams.keysArr.push(a.value),a.value=""})})):(y(),$("span",Wn))])]),h(t).article.routeParams.keysArr.length>0?(y(),$("div",jn,[u("div",Xn,[z(l,{modelValue:h(t).article.routeParams.bindKeys,"onUpdate:modelValue":n[8]||(n[8]=c=>h(t).article.routeParams.bindKeys=c)},null,8,["modelValue"])]),n[17]||(n[17]=u("div",{class:"ms-2"},[u("div",null,"Привязывать параметры"),u("div",{class:"small"},"Только для параметорв в / /")],-1))])):K("",!0)])):K("",!0)])])])):K("",!0),u("div",qn,[u("button",{class:"btn btn-success btn-sm",onClick:n[9]||(n[9]=c=>h(t).getController())},"Обычный контроллер")]),u("div",Yn,[u("button",{class:"btn btn-success btn-sm",onClick:n[10]||(n[10]=c=>h(t).getLiveWareController())},"LiveWare контроллер")]),u("div",Zn,[u("a",{href:"http://mpro2.test/a_dmin/api/exportArticle?id="+h(t).article.id,class:"btn btn-success btn-sm"}," Экспорт ",8,Gn)])]),u("pre",null,"        "+Z(h(t).article)+`
    `,1)]),_:1},8,["visible"])}}},Qn={__name:"Help",setup(e){const t=ye();return(a,r)=>{const s=oe("Dialog");return y(),ce(s,{visible:h(t).statusHelp,"onUpdate:visible":r[0]||(r[0]=n=>h(t).statusHelp=n),header:"Справка",modal:"",class:"w-50"},{default:H(()=>[...r[1]||(r[1]=[u("ul",{class:"list-unstyled m-0"},[u("li",null,[u("kbd",null,"Ctrl+S"),le(" — сохранить")]),u("li",null,[u("kbd",null,"Shift_"),le(" — снипеты блейда")]),u("li",null,[u("kbd",null,"Alt+1"),le(" — перейти в статье по выбранному слову")]),u("li",null,[u("kbd",null,"Alt+3"),le(" — панель дерева")]),u("li",null,[u("kbd",null,"Alt+4"),le(" — боковое меню")]),u("li",null,[u("kbd",null,"Alt+5"),le(" — панель контроллера")]),u("li",null,[u("kbd",null,"Alt+6"),le(" — скрыть/отобразить панель блейда")])],-1)])]),_:1},8,["visible"])}}};function ea(){const e=Re.require("ace/mode/html_highlight_rules").HtmlHighlightRules;if(e.__bladePatched)return;const t=[{token:"comment",regex:/\{\{\-\-[\s\S]*?\-\-\}\}/},{token:"variable",regex:/\{\{[\s\S]*?\}\}/},{token:"entity.name.function",regex:/@[A-Za-z_]\w*/}],a=e.prototype.getRules;e.prototype.getRules=function(){const r=a.call(this);for(const s in r)r[s].unshift(...t);return r},e.__bladePatched=!0}function ta(e){const t=[{tabTrigger:"",name:"_@auth",content:`@auth
	$0
@endauth`},{tabTrigger:"",name:"_@can",content:`@can(\${1:ability})
	$0
@endcan`},{tabTrigger:"",name:"_@cannot",content:`@cannot(\${1:ability})
	$0
@endcannot`},{tabTrigger:"",name:"_@csrf",content:"@csrf"},{tabTrigger:"",name:"_@dd",content:"@dd(${1:var})"},{tabTrigger:"",name:"_@dump",content:"@dump(${1:var})"},{tabTrigger:"",name:"_@else",content:`@else
	$0`},{tabTrigger:"",name:"_@elseif",content:"@elseif ($${1:user}->${2:active})"},{tabTrigger:"",name:"_@empty",content:`@empty ($\${1:arr})
	$0
@endempty`},{tabTrigger:"",name:"_@endauth",content:"@endauth"},{tabTrigger:"",name:"_@endcan",content:"@endcan"},{tabTrigger:"",name:"_@endcannot",content:"@endcannot"},{tabTrigger:"",name:"_@endempty",content:"@endempty"},{tabTrigger:"",name:"_@endforeach",content:"@endforeach"},{tabTrigger:"",name:"_@endif",content:"@endif"},{tabTrigger:"",name:"_@endfor",content:"@endfor"},{tabTrigger:"",name:"_@endguest",content:"@endguest"},{tabTrigger:"",name:"_@endisset",content:"@endisset"},{tabTrigger:"",name:"_@endonce",content:"@endonce"},{tabTrigger:"",name:"_@endprepend",content:"@endprepend"},{tabTrigger:"",name:"_@endphp",content:"@endphp"},{tabTrigger:"",name:"_@endpush",content:"@endpush"},{tabTrigger:"",name:"_@endsection",content:"@endsection"},{tabTrigger:"",name:"_@endswitch",content:"@endswitch"},{tabTrigger:"",name:"_@endwhile",content:"@endwhile"},{tabTrigger:"",name:"_@env",content:`@env(\${1:environment})
	$0
@endenv`},{tabTrigger:"",name:"_@error",content:`@error('\${1:field}')
	<div class="text-danger">{{ $message }}</div>
@enderror`},{tabTrigger:"",name:"_@extends",content:"@extends('${1:layout}')"},{tabTrigger:"",name:"_@for",content:"@for ($${1:i} = 0; $${1:i} < ${2:10}; $${1:i}++)\n	$0\n@endfor"},{tabTrigger:"",name:"_@foreach",content:"@foreach ($${1:items} as $${2:item})\n	$0\n@endforeach"},{tabTrigger:"",name:"_@foreach index",content:"@foreach ($${1:items} as $${2:ndex} => $${3:item})\n	$0\n@endforeach"},{tabTrigger:"",name:"_@guest",content:`@guest
	$0
@endguest`},{tabTrigger:"",name:"_@if",content:`@if ($\${1:var} > 0)
	$0
@endif`},{tabTrigger:"",name:"_@include",content:"@include('magic::${1:view}', [${2:data}])"},{tabTrigger:"",name:"_@includeFirst",content:"@includeFirst(['magic::${1:view1}', 'magic::${2:view2}'])"},{tabTrigger:"",name:"_@includeIf",content:"@includeIf('magic::${1:view}', [${2:data}])"},{tabTrigger:"",name:"_@includeWhen",content:"@includeWhen(${1:condition}, 'magic::${2:view}', [${3:data}])"},{tabTrigger:"",name:"_@includeUnless",content:"@includeUnless(${1:condition}, 'magic::${2:view}', [${3:data}])"},{tabTrigger:"",name:"_@isset",content:`@isset ($\${1:var})
	$0
@endisset`},{tabTrigger:"",name:"_@json",content:"@json(${1:data})"},{tabTrigger:"",name:"_@method",content:"@method('${1:PUT}')"},{tabTrigger:"",name:"_@once",content:`@once
	$0
@endonce`},{tabTrigger:"",name:"_@php",content:`@php
	$0
@endphp`},{tabTrigger:"",name:"_@prepend",content:`@prepend('\${1:stack}')
	$0
@endprepend`},{tabTrigger:"",name:"_@production",content:`@production
	$0
@endproduction`},{tabTrigger:"",name:"_@props",content:"@props(['${1:variable}' => ${2:default}])"},{tabTrigger:"",name:"_@push",content:`@push('\${1:stack}')
	$0
@endpush`},{tabTrigger:"",name:"_@section (block)",content:`@section('\${1:name}')
	$0
@endsection`},{tabTrigger:"",name:"_@section (inline)",content:"@section('${1:name}', '${2:content}')"},{tabTrigger:"",name:"_@stack",content:"@stack('${1:stack}')"},{tabTrigger:"",name:"_@switch",content:`@switch ($\${1:value})
	@case($\${2:key})
		$0
	@break
@endswitch`},{tabTrigger:"",name:"_@unless",content:`@unless ($\${1:cond})
	$0
@endunless`},{tabTrigger:"",name:"_@verbatim",content:`@verbatim
	$0
@endverbatim`},{tabTrigger:"",name:"_@while",content:`@while ($\${1:flag})
	$0
@endwhile`},{tabTrigger:"",name:"_@yield",content:"@yield('${1:section}')"},{tabTrigger:"",name:"_<x-magic",content:'<x-magic::${1:anonymus} :data="$${1:value}"></x-magic::${1:anonymus}>)'}],a=t.map(c=>c.tabTrigger.replace("@",""));ace.require("ace/snippets").snippetManager.register(t,"html");const s=ace.require("ace/autocomplete").Autocomplete,n=s.prototype.showPopup,l=s.prototype.updateCompletions;function o(c){c&&Array.isArray(c.data)&&(c.data=c.data.filter(i=>!a.includes(i.value)),c.setData(c.data))}s.prototype.showPopup=function(c){n.call(this,c),o(this.popup)},s.prototype.updateCompletions=function(c){l.call(this,c),o(this.popup)},e.commands.addCommand({name:"toggleLineMarkersCommand",bindKey:{win:"Alt-/",mac:"Alt-/"},exec:ra,readOnly:!1})}function na(e){let t,a;if(e.getSelectionRange().isEmpty()){const r=e.getCursorPosition();e.selection.selectLine(r.row),t=a=r.row}else{const r=e.getSelectionRange(),s=ace.require("ace/range").Range;t=r.start.row,a=r.end.row;const n=new s(t,0,a,e.session.getLine(a).length);e.selection.setRange(n)}return{startRow:t,endRow:a}}function aa(e){return/{{--.*--}}/.test(e)?(e=e.replace(/^\s*{{--\s?/,""),e=e.replace(/\s?--}}\s*$/,""),e):`{{-- ${e} --}}`}function ra(e){const{startRow:t,endRow:a}=na(e),r=e.session,s=ace.require("ace/range").Range;for(let n=t;n<=a;n++){const l=r.getLine(n),o=aa(l),c=l.length;r.replace(new s(n,0,n,c),o)}}const la=["id"],tt={__name:"AceEditor",props:dt({lang:{type:String,default:"html",validator:e=>["html","php","blade"].includes(e)},theme:{type:String,default:"monokai"},readOnly:{type:Boolean,default:!1},tabSize:{type:Number,default:4},wrap:{type:Boolean,default:!1},height:{type:Number,default:100}},{modelValue:{type:String,default:"XXXXXXXX"},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=ye(),a=C(ft()),r=e,s=Qe(e,"modelValue"),n=C(null);let l=null;const o=()=>r.lang==="php"?"ace/mode/php":"ace/mode/html",c=i=>`ace/theme/${i}`;return ve(()=>{ea(),l=Re.edit(a.value,{value:s.value,mode:o(r.lang),theme:c(r.theme),readOnly:r.readOnly,wrap:r.wrap,tabSize:r.tabSize,useWorker:!1}),l.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableEmmet:!0}),l.setFontSize(14),l.commands.addCommand({name:"sendSelectedToParent",bindKey:{win:"Alt-1",mac:"Alt-1"},exec(i){const d=i.session.getTextRange(i.getSelectionRange());if(d.trim()===""){document.showToast("Статья не выделена");return}t.gotoArticleByName(d)}}),r.lang!=="php"&&ta(l),l.session.on("change",()=>{s.value=l.getValue()}),r.lang==="php"&&q(()=>t.searchTextController,i=>{i.trim()&&(l.find(i),l.execCommand("find"),t.searchTextController="")}),r.lang==="html"&&q(()=>t.searchTextView,i=>{i.trim()&&(l.find(t.searchTextView),l.execCommand("find"),t.searchTextView="")})}),q(s,i=>{if(!l)return;const d=l.getValue();i!==d&&l.setValue(i)}),pt(()=>l?.destroy()),q(()=>r.lang,i=>l?.session.setMode(o())),q(()=>r.theme,i=>l?.setTheme(c(i))),q(()=>r.readOnly,i=>l?.setReadOnly(i)),q(()=>r.tabSize,i=>l?.session.setTabSize(i)),q(()=>r.wrap,i=>l?.session.setUseWrapMode(i)),(i,d)=>(y(),$("div",{style:ne("height: "+e.height+"px; width: 100%; position: relative;")},[u("div",{ref_key:"el",ref:n,id:a.value,style:{width:"100%",height:"100%"}},null,8,la)],4))}};var sa=!1,oa=!0;function Ve(e){return Object.prototype.toString.call(e)==="[object Array]"}function nt(e){return Object.prototype.toString.call(e)==="[object Object]"}function ia(e){return typeof e=="function"}function ca(e,t){return e<t?e:t}function yt(e,t){let a,r=0;for(;(a=e.indexOf(t))>-1;)e.splice(a,1),r++;return r}function bt(e){return e[e.length-1]}function ua(e){return Ve(e)?e:[e]}function da(e,t){let a=new Set(t);const r={};return a.forEach(s=>{r[s]=e[s]}),r}function fa(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){if(t.reverse)if(e.length!=null)for(let a=e.length-1;a>=0;a--){const r={value:e[a],index:a};(!t.exclude||!t.exclude(r))&&(yield r)}else if(nt(e)){const a=Object.keys(e);a.reverse();for(const r of a){const s={value:e[r],key:r};(!t.exclude||!t.exclude(s))&&(yield s)}}else throw"Unsupported type";else if(e.length!=null)for(let a=0;a<e.length;a++){const r={value:e[a],index:a};(!t.exclude||!t.exclude(r))&&(yield r)}else if(nt(e))for(const a of Object.keys(e)){const r={value:e[a],key:a};(!t.exclude||!t.exclude(r))&&(yield r)}else throw"Unsupported type"})()}function pa(e,t,a){e.hasOwnProperty(t)||(e[t]=a)}function _t(e,t){return Object.keys(t).forEach(a=>{pa(e,a,t[a])}),e}function ha(e){const t={};return Object.keys(e).forEach(a=>{e[a]!==void 0&&(t[a]=e[a])}),t}function ue(e,t){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};a=_t({...a},{childrenKey:"children"});const{childrenKey:r}=a,s=Ve(e)?e:[e];class n{}const l=(o,c,i)=>{a.reverse&&(o=o.slice(),o.reverse());const d=o.length;for(let f=0;f<d;f++){const p=o[f],m=a.reverse?d-f-1:f,_=i?[...i,m]:[];a.childFirst&&p[r]!=null&&l(p[r],p,_);const S=t(p,m,c,_);if(S===!1)throw new n;if(S==="skip children")continue;if(S==="skip siblings")break;a.childFirst||p[r]!=null&&l(p[r],p,_)}};try{l(s,null,Ve(e)?[]:null)}catch(o){if(!(o instanceof n))throw o}}function ma(e,t){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r;return ue(e,function(){if(t(...arguments))return r={node:arguments.length<=0?void 0:arguments[0],index:arguments.length<=1?void 0:arguments[1],parent:arguments.length<=2?void 0:arguments[2],path:arguments.length<=3?void 0:arguments[3]},!1},a),r}function ga(e,t){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return ma(e,t,a)?.node}function wt(e,t){const a={childrenKey:"children"};t&&Object.assign(a,t);const{childrenKey:r,nodeHandler:s}=a,n=new Ge;return n.childrenKey=r,ue(e,(l,o,c,i)=>{let d=Object.assign({},l);d[r]&&(d[r]=[]),s&&(d=s(d,{oldNode:l,index:o,parent:c,path:i})),n.set(i,d)},{childrenKey:r}),n.data}class Ge{data;childrenKey="children";constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.data=t}get rootChildren(){const{childrenKey:t}=this,{data:a}=this;return Ve(a)?a:a[t]}iteratePath(t){var a=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const{childrenKey:s,rootChildren:n}=a;if(r.reverse){const l=[...a.iteratePath(t,{...r,reverse:!1})];l.reverse();for(const{path:o,node:c}of l)yield{path:o,node:c}}else{let l=[],o=n;for(const c of t){const i=[...l,c],d=o[c];yield{path:i,node:d},l=i,o=d[s]}}})()}getFamily(t){const a=[];for(const{node:r}of this.iteratePath(t))a.push(r);return a}get(t){return bt(this.getFamily(t))}getParentAndIndex(t){const a=t.slice(),r=a.pop();return{parent:this.get(a),index:r,parentPath:a}}getParent(t){return this.getParentAndIndex(t).parent}set(t,a){if(t==null||t.length===0)this.data=a;else{const{childrenKey:r}=this;let{rootChildren:s}=this;const{parent:n,index:l}=this.getParentAndIndex(t);let o;t.length===1?(s||(this.data?this.data[r]=[]:this.data=[]),o=s):(n[r]||(n[r]=[]),o=n[r]),o[l]=a}}delete(t){const{childrenKey:a,rootChildren:r}=this,{parent:s,index:n}=this.getParentAndIndex(t),l=t.length===1?r:s[a],o=l[n];return l.splice(n,1),o}walk(t,a){const{childrenKey:r,data:s}=this;return ue(s,t,r,a)}clone(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return wt(this.data),ha({childrenKey:this.childrenKey,nodeHandler:t.nodeHandler||void 0})}}function at(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ia(e)?e(...t):e}function va(e,t){return function(){let r,s;try{r=e(...arguments)}catch(n){s=n}finally{}if(s)throw s;return r}}function Te(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=[];let r;const s={};let n=s;return{action:function(){for(var c=arguments.length,i=new Array(c),d=0;d<c;d++)i[d]=arguments[d];if(i.length===0)return n===s&&(n=e()),n;if(r||(r=new wa),!r.has(i)&&(r.set(i,e(...i)),t.capacity!=null)){a.push(i);const f=a.splice(0,a.length-t.capacity);for(const p of f)r.delete(p)}return r.get(i)},clearCache:()=>{r=null,a.splice(0,a.length)}}}function ya(){let e,t;return{promise:new Promise((r,s)=>{e=r,t=s}),resolve:e,reject:t}}function ba(e,t){for(;;){if(e.parentNode==null)return!1;if(e.parentNode===t)return!0;e=e.parentNode}}function Ke(e){let t=e.getBoundingClientRect();if(document.documentElement.clientTop>0){const a=t.top-document.documentElement.clientTop,r=t.bottom,s=t.left-document.documentElement.clientLeft,n=t.right,l=t.width||n-s,o=t.height||r-a,d={top:a,right:n,bottom:r,left:s,width:l,height:o,x:s,y:a};t={...d,toJSON:()=>d}}return t}function rt(e,t){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=a&&a.withSelf?e:e.parentElement;for(;r;){const s=a.until&&r===a.until;if(s&&!a.withUntil)return;const n=t(r);if(n==="break")return;if(n)return r;if(s)return;r=r.parentElement}}function Be(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function lt(e,t){for(const a of t)if(Be(e,a))return!0;return!1}function de(e,t,a,r){e.addEventListener?e.addEventListener(t,a,r):e.attachEvent&&e.attachEvent(`on${t}`,a,r)}function fe(e,t,a,r){e.removeEventListener?e.removeEventListener(t,a,r):e.detachEvent&&e.detachEvent(`on${t}`,a,r)}function _a(e){let t=[];const a=()=>{if(!s.listening){for(const n of e){de.apply(this,n);const l=()=>fe.apply(this,n);t.push(l)}s.listening=!0}},s={listening:!1,stop:()=>{if(s.listening){for(const n of t)n();t=[],s.listening=!1}},resume:a,start:a};return s.start(),s}function Ue(e,t){return getComputedStyle(e)[t]}function Je(e,t){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};a={start:0,end:e.length-1,maxTimes:1e3,...a};let{start:r,end:s}=a;const{returnNearestIfNoHit:n,maxTimes:l}=a;let o,c;r==null&&(r=0,s=e.length-1);let i=0,d;for(;r>=0&&r<=s;){if(i>=l)throw Error(`binarySearch: loop times is over ${l}, you can increase the limit.`);o=Math.floor((s-r)/2+r),c=e[o];const f=i+1;if(d=t(c,o,f),d>0)s=o-1;else if(d<0)r=o+1;else return{index:o,value:c,count:f,hit:!0};i++}return n?{index:o,value:c,count:i+1,hit:!1,greater:d>0}:null}class wa{_map=new Map;_values={};_objCount=0;_keysToString(t){const{_map:a}=this;let r=[];for(const s of t){if(!a.has(s))return null;r.push(a.get(s)[0])}return r.toString()}has(t){return this._keysToString(t)!=null}get(t){const{_values:a}=this,r=this._keysToString(t);if(r==null)throw"Value not found by specified keys";return a[r][1]}set(t,a){const{_map:r,_values:s}=this;let n=[];for(const l of t){let o,c=1;r.has(l)?([o,c]=r.get(l),c++):(this._objCount++,o=this._objCount.toString()),r.set(l,[o,c]),n.push(o)}s[n.toString()]=[t.slice(),a]}delete(t){const{_values:a,_map:r}=this,s=this._keysToString(t);if(s==null)throw"Value not found by specified keys";delete a[s];for(const n of t){let[l,o]=r.get(n);o--,o===0?r.delete(n):r.set(n,[l,o])}}clear(){this._map.clear(),this._values={}}*entries(){const{_values:t}=this;for(const a in t){const[r,s]=t[a];yield[r,s]}}count(){return[...this.entries()].length}}const ka=Se({props:{table:Boolean}}),kt=(e,t)=>{const a=e.__vccOpts||e;for(const[r,s]of t)a[r]=s;return a},xa={key:0},$a={key:1};function Sa(e,t,a,r,s,n){return e.table?(y(),$("table",xa,[G(e.$slots,"prepend"),u("tbody",null,[G(e.$slots,"default")]),G(e.$slots,"append")])):(y(),$("div",$a,[G(e.$slots,"prepend"),G(e.$slots,"default"),G(e.$slots,"append")]))}const Ca=kt(ka,[["render",Sa]]),Ta=Se({components:{VirtualListTable:Ca},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const t=C(0),a=C(e.firstRender-1),r=X(()=>{var w;return ca(a.value,(((w=e.items)==null?void 0:w.length)||1)-1)}),s=C(0),n=X(()=>p.value[t.value]?M(t.value):0),l=X(()=>p.value.length>0?M(p.value.length-1)+bt(f.value):0),o=X(()=>p.value[r.value]?l.value-M(r.value)-f.value[r.value]:0),c=X(()=>e.disabled?{}:{overflow:"auto"}),i=X(()=>{const w={display:"flex"};return e.disabled||(e.horizontal?Object.assign(w,{"margin-left":n.value+"px","margin-right":o.value+"px",width:l.value-o.value-n.value+"px"}):Object.assign(w,{"margin-top":n.value+"px","margin-bottom":o.value+"px"})),w["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete w.display,delete w["flex-direction"]),w}),d=X(()=>Pe((e.items||[]).map(()=>null))),f=X(()=>(e.items||[]).map((w,E)=>{var k;if(d[E]!=null)return d[E];let W=(k=e.itemSize)==null?void 0:k.call(e,w,E);return W==null&&(W=s.value),W})),p=X(()=>{const w=[];return f.value.reduce((E,k)=>(w.push(E),E+k),0),w});q(()=>e.items,g);const m=X(()=>{if(!e.items||e.disabled)return;const w=[];for(let E=t.value;E<=r.value;E++){const k=e.items[E];if(!k)break;w.push({item:k,index:E})}return w}),_=C(),S=C();ve(async()=>{g();try{j()}catch{await Ie(),g()}});let P;function O(){const w=_.value;if(!w)return;const E=b(w);P!=null&&e.buffer-Math.abs(E-P)>=10||(P=E,g())}let N=!1,B=!1;async function g(){var w;if(N){B=!0;return}if(!e.items||e.disabled)return;N=!0;const E=_.value,k=(w=S.value)==null?void 0:w.$el;if(!E||!k)return;s.value||(s.value=I()),t.value=Q(),a.value=ge(),await Ie();let W,Y=0;const D={},T=e.table?k.querySelector("tbody").children:k.children;for(let V=0;V<T.length;V++){const U=T[V],J=Ue(U,"position");if(J&&["absolute","fixed"].includes(J))continue;const he=Ue(U,"display")!=="none"?L(U):0,be=U.getAttribute("vt-index"),Le=be?parseInt(be):t.value+Y;D[Le]=(D[Le]||0)+he,Y++}for(const V of Object.keys(D)){const U=parseInt(V);d.value[U]!==D[U]&&(d.value[U]=D[U],W=!0)}W&&await Ie(),N=!1,B&&(B=!1,g());function Q(){const V=b(E)-R(E)-e.buffer;return Je(p.value,U=>U-V,{returnNearestIfNoHit:!0}).index}function ge(){const V=b(E)-R(E)+v(E)+e.buffer;return Je(p.value,U=>U-V,{returnNearestIfNoHit:!0}).index}function I(){const V=[],U=e.table?k.querySelector("tbody").children:k.children;for(let J=0;J<U.length;J++){const he=U[J],be=getComputedStyle(he);if(["absolute","fixed"].includes(be.position))continue;const Le=L(he);if(V.push(Le),V.length>=10)break}return V.length===0?0:V.reduce((J,he)=>J+he,0)/V.length}}function v(w){const E=getComputedStyle(w);let k=parseFloat(e.horizontal?E.width:E.height);return E.boxSizing==="border-box"&&(e.horizontal?k=k-parseFloat(E.borderLeftWidth)-parseFloat(E.borderRightWidth):k=k-parseFloat(E.borderTopWidth)-parseFloat(E.borderBottomWidth)),k}function L(w){let E=v(w);const k=getComputedStyle(w);return e.horizontal?E+=parseFloat(k.borderLeftWidth)+parseFloat(k.borderRightWidth)+parseFloat(k.marginLeft)+parseFloat(k.marginRight):E+=parseFloat(k.borderTopWidth)+parseFloat(k.borderBottomWidth)+parseFloat(k.marginTop)+parseFloat(k.marginBottom),E=Number.isNaN(E)?0:E,E}function b(w){return e.horizontal?w.scrollLeft:w.scrollTop}function R(w){const E=getComputedStyle(w);return e.horizontal?parseFloat(E.paddingLeft):parseFloat(E.paddingTop)}function M(w){return p.value[w]}function j(){const w=_.value;new ResizeObserver(E=>{for(let k of E)if(Be(k.target,"vtlist")){g();break}}).observe(w)}function F(w,E){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return E;if(typeof e.itemKey=="function")return e.itemKey(w,E)}}return{listElRef:_,listInnerRef:S,onscroll:O,listStyle:c,listInnerStyle:i,visibleItemsInfo:m,getItemKey:F,update:g,sizes:f,positions:p,runtimeSizes:d}}});function Da(e,t,a,r,s,n){const l=oe("VirtualListTable");return y(),$("div",{class:"vtlist",ref:"listElRef",style:ne(e.listStyle),onScrollPassive:t[0]||(t[0]=(...o)=>e.onscroll&&e.onscroll(...o))},[z(l,{class:"vtlist-inner",ref:"listInnerRef",style:ne(e.listInnerStyle),table:e.table},{prepend:H(()=>[G(e.$slots,"prepend")]),append:H(()=>[G(e.$slots,"append")]),default:H(()=>[e.disabled?(y(!0),$(te,{key:0},pe(e.items,(o,c)=>G(e.$slots,"default",{key:e.getItemKey(o,c),item:o,index:c})),128)):(y(!0),$(te,{key:1},pe(e.visibleItemsInfo,({item:o,index:c})=>G(e.$slots,"default",{key:e.getItemKey(o,c),item:o,index:c})),128))]),_:3},8,["style","table"])],36)}const Ea=kt(Ta,[["render",Da]]);const we="children";function Pa(e){const a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={...Oa,...a,data:e,stats:null,statsFlat:null,_statsMap:null,initialized:!1,init(){const{data:n,childrenKey:l}=this,o=new Ge([]);this._statsMap=new Map,ue(n,(i,d,f,p)=>{const m=this.statHandler({...st(),data:i,open:!!this.defaultOpen,parent:o.getParent(p),children:[],level:p.length});this._statsMap.set(i,m),o.set(p,m)},{childrenKey:l});const c=[];o.walk(i=>{c.push(i)}),this.stats=this.statsHandler(o.rootChildren),this.statsFlat=this.statsFlatHandler(c),this.initialized=!0},getStat(n){let l=this._statsMap.get(n);if(!l)throw new ot("Stat not found");return l},has(n){if(n.isStat)return this.statsFlat.indexOf(n)>-1;try{return!!this.getStat(n)}catch(l){if(l instanceof ot)return!1;throw l}},_getPathByStat(n){if(n==null)return[];const o=this.getSiblings(n).indexOf(n);return[...n.parent?this._getPathByStat(n.parent):[],o]},afterOneCheckChanged(n){const{checked:l}=n;if(n._ignoreCheckedOnce)return delete n._ignoreCheckedOnce,!1;const o=c=>{const{parent:i}=c;if(i){let d,f,p;for(const _ of i.children)_.checked?d=!0:_.checked===0?p=!0:f=!0;const m=p?0:f?d?0:!1:!0;i.checked!==m&&(this._ignoreCheckedOnce(i),i.checked=m),o(i)}};return o(n),ue(n.children,c=>{c.checked!==l&&(this._ignoreCheckedOnce(c),c.checked=l)},{childrenKey:we}),!0},_ignoreCheckedOnce(n){n._ignoreCheckedOnce=!0,setTimeout(()=>{n._ignoreCheckedOnce&&(n._ignoreCheckedOnce=!1)},100)},isVisible(n){const l=n.isStat?n:this.getStat(n),o=c=>!c||!c.hidden&&c.open&&o(c.parent);return!!(!l.hidden&&o(l.parent))},updateCheck(){ue(this.stats,n=>{if(n.children&&n.children.length>0){const l=n.children.every(i=>i.checked===!0),o=n.children.every(i=>i.checked===!1),c=l?!0:o?!1:0;n.checked!==c&&(this._ignoreCheckedOnce(n),n.checked=c)}},{childFirst:!0,childrenKey:we})},getChecked(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.statsFlat.filter(l=>l.checked||n&&l.checked===0)},getUnchecked(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.statsFlat.filter(l=>n?!l.checked:l.checked===!1)},openAll(){for(const n of this.statsFlat)n.open=!0},closeAll(){for(const n of this.statsFlat)n.open=!1},openNodeAndParents(n){const l=n.isStat?n:this.getStat(n);for(const o of this.iterateParent(l,{withSelf:!0}))o.open=!0},_calcFlatIndex(n,l){let o=n?this.statsFlat.indexOf(n)+1:0;const c=n?n.children:this.stats;for(let i=0;i<l;i++)o+=this._count(c[i]);return o},add(n,l,o){if(this.has(n))throw"Can't add because data exists in tree";const c=l?l.children:this.stats;o==null&&(o=c.length);const i=this.statHandler({...st(),open:!!this.defaultOpen,data:n,parent:l||null,children:[],level:l?l.level+1:1});this._setPosition(i,l||null,o);const d=n[this.childrenKey];if(d){const f=d.slice();for(const p of f)this.add(p,i)}},remove(n){const l=this.getSiblings(n);if(l.includes(n)){yt(l,n);const o=this._flat(n);this.statsFlat.splice(this.statsFlat.indexOf(n),o.length);for(const c of o)this._statsMap.delete(c.data);return this.afterRemoveStat(n),!0}return!1},getSiblings(n){const{parent:l}=n;return l?l.children:this.stats},_setPosition(n,l,o){(l?l.children:this.stats).splice(o,0,n),n.parent=l,n.level=l?l.level+1:1;const i=this._calcFlatIndex(l,o),d=this._flat(n);this.statsFlat.splice(i,0,...d);for(const f of d)this._statsMap.has(f.data)||this._statsMap.set(f.data,f);ue(n,(f,p,m)=>{m&&(f.level=m.level+1)},{childrenKey:we}),this.afterSetStat(n,l,o)},*iterateParent(n,l){let o=l!=null&&l.withSelf?n:n.parent;for(;o;)yield o,o=o.parent},move(n,l,o){if(this.has(n)){if(n.parent===l&&this.getSiblings(n).indexOf(n)===o)return!1;if(n===l)throw new Error("Can't move node to it self");if(l&&n.level<l.level){let c;for(const i of this.iterateParent(l))if(i.level===n.level){c=i;break}if(n===c)throw new Error("Can't move node to its descendant")}this.remove(n)}return this._setPosition(n,l,o),!0},_flat(n){const l=[];return ue(n,o=>{l.push(o)},{childrenKey:we}),l},_count(n){return this._flat(n).length},getData(n,l){const{childrenKey:o}=this,c=new Ge([]);return c.childrenKey=o,ue(l||this.stats,(i,d,f,p)=>{let m={...i.data,[o]:[]};n&&(m=n(m)),c.set(p,m)},{childrenKey:we}),c.data}},s=r;return r.noInitialization||s.init(),s}const Oa={childrenKey:"children",defaultOpen:!1,statsHandler(e){return e},statsFlatHandler(e){return e},afterSetStat(e,t,a){},afterRemoveStat(e){},statHandler(e){return e}};function st(){return{isStat:!0,hidden:!1,checked:!1,style:null,class:null,draggable:null,droppable:null}}class ot extends Error{constructor(t){super(t),this.name="StatNotFoundError"}}const Ae={start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","touchend"]},He={isTouch(e){return e.type&&e.type.startsWith("touch")},_getStore(e){return e._wrapperStore||(e._wrapperStore=[]),e._wrapperStore},on(e,t,a,r){const{args:s,mouseArgs:n,touchArgs:l}=it(r),o=this._getStore(e),c=this,i=function(d){let f;if(c.isTouch(d))f={x:d.changedTouches[0].pageX,y:d.changedTouches[0].pageY,pageX:d.changedTouches[0].pageX,pageY:d.changedTouches[0].pageY,clientX:d.changedTouches[0].clientX,clientY:d.changedTouches[0].clientY,screenX:d.changedTouches[0].screenX,screenY:d.changedTouches[0].screenY};else if(f={x:d.pageX,y:d.pageY,pageX:d.pageX,pageY:d.pageY,clientX:d.clientX,clientY:d.clientY,screenX:d.screenX,screenY:d.screenY},t==="start"&&d.which!==1)return;return a.call(this,d,f)};o.push({handler:a,wrapper:i}),de.call(null,e,Ae[t][0],i,...s,...n),de.call(null,e,Ae[t][1],i,...s,...l)},off(e,t,a,r){const{args:s,mouseArgs:n}=it(r),l=this._getStore(e);for(let o=l.length-1;o>=0;o--){const{handler:c,wrapper:i}=l[o];a===c&&(fe.call(null,e,Ae[t][0],i,...s,...n),fe.call(null,e,Ae[t][1],i,...s,...n),l.splice(o,1))}}};function it(e){e||(e={});const t=e.args||[],a=e.mouseArgs||[],r=e.touchArgs||[];return{args:t,mouseArgs:a,touchArgs:r}}const We=new Map,me={triggerElement:null,dragElement:null,internal:!1,dropEffect:"none",preventDefault:!1},re=me;function De(e){e.dataTransfer&&(e.dataTransfer.dropEffect=re.dropEffect)}function La(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(We.has(e))throw"Already registered on specified element";const a={...t},r=a;_t(a,Aa),He.on(e,"start",s,{touchArgs:[{passive:!0}]}),He.on(e,"end",n);function s(f){var p;const m=f.target;m.nodeType===Node.ELEMENT_NODE&&(re.triggerElement=m);const _=m;if(a.ingoreHTMLTags&&_.tagName&&a.ingoreHTMLTags.find(P=>P.toUpperCase()===_.tagName))return;const S=(p=a.beforeDragStart)===null||p===void 0?void 0:p.call(a,f);S&&(S.setAttribute("draggable","true"),re.dragElement=S)}function n(f){re.dragElement&&re.dragElement.removeAttribute("draggable")}function l(f){var p;re.internal=!0,(p=a.onDragStart)===null||p===void 0||p.call(a,f),De(f)}function o(f){var p;(p=a.onDrag)===null||p===void 0||p.call(a,f),De(f)}function c(f){var p;(p=a.onDragEnd)===null||p===void 0||p.call(a,f),re.internal=!1,re.dragElement&&re.dragElement.removeAttribute("draggable"),re.triggerElement=null,re.dragElement=null,re.dropEffect="none"}const i=Na(e,{onDragLeave(f){var p;(p=a.onDragLeave)===null||p===void 0||p.call(a,f),De(f)},onDragEnter(f){var p;r.ifPreventDefault(f)&&f.preventDefault(),(p=a.onDragEnter)===null||p===void 0||p.call(a,f),De(f)},onDragOver(f){var p;r.ifPreventDefault(f)&&f.preventDefault(),(p=a.onDragOver)===null||p===void 0||p.call(a,f),De(f)},onDrop(f){var p;r.ifPreventDefault(f)&&f.preventDefault(),(p=a.onDrop)===null||p===void 0||p.call(a,f)},onEnter(f){var p;(p=a.onEnter)===null||p===void 0||p.call(a,f)},onLeave(f){var p;(p=a.onLeave)===null||p===void 0||p.call(a,f)}});return de(e,"dragstart",l),de(e,"drag",o),de(e,"dragend",c),Object.assign(a,{root:e,destroy:()=>{He.off(e,"start",s,{touchArgs:[{passive:!0}]}),fe(e,"dragstart",l),fe(e,"drag",o),fe(e,"dragend",c),i(),We.delete(e)}}),We.set(e,r),r}const Aa={ingoreHTMLTags:["INPUT","TEXTAREA","SELECT","OPTGROUP","OPTION"],ifPreventDefault(e){return me.dragElement?!0:re.preventDefault},beforeDragStart(e){},onDragStart(e){},onDrag(e){},onDragEnter(e){},onDragLeave(e){},onDragOver(e){},onDragEnd(e){},onDrop(e){}};let ze=null;const Fa=e=>{ze=e,setTimeout(()=>{ze=null},20)};function Na(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=e;let r=!1;const s=m=>{var _;r=!0,(_=t.onEnter)===null||_===void 0||_.call(t,m),d.resume()},n=m=>{var _;Fa(m.target),(_=t.onDragEnter)===null||_===void 0||_.call(t,m),r||s(m)},l=m=>{var _;r||s(m),(_=t.onDragOver)===null||_===void 0||_.call(t,m)},o=m=>{var _;(_=t.onDragLeave)===null||_===void 0||_.call(t,m);const S=function(){var O;let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:m;r=!1,(O=t.onLeave)===null||O===void 0||O.call(t,N),d.stop()},P=ze;ze=null,P&&ba(P,a)||S()},c=m=>{var _;(_=t.onDrop)===null||_===void 0||_.call(t,m)},i=m=>{var _;m instanceof KeyboardEvent&&m.key!=="Escape"||(r=!1,d.stop(),(_=t.onEndBeforeLeave)===null||_===void 0||_.call(t,m))},d=_a([[e,"drop",i],[window,"mouseup",i],[window,"touchend",i],[window,"keydown",i]]);d.stop();const f=()=>{de(e,"dragenter",n),de(e,"dragover",l),de(e,"dragleave",o),de(e,"drop",c)},p=()=>{fe(e,"dragenter",n),fe(e,"dragover",l),fe(e,"dragleave",o),fe(e,"drop",c),d.stop()};return f(),p}let Me=!1;const Ra=()=>{Me=!0,setTimeout(()=>{Me=!1},100)},Va=Se({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const a=X(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));q(()=>e.stat.checked,n=>{Me||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),q(()=>e.stat.open,n=>{Me||(t(n?"open":"close",e.stat),Ra())});const r=X(()=>{const n=[],l=d=>{var f;if(d.parent){let p=(f=d.parent)==null?void 0:f.children.indexOf(d);do{p++;let m=d.parent.children[p];if(m){if(!m.hidden)return!0}else break}while(!0)}return!1},o=e.rtl?"right":"left",c=e.btt?"top":"bottom";let i=e.stat;for(;i;){let d=(i.level-2)*e.indent+e.treeLineOffset;const f=l(i),p=()=>{n.push({style:{[o]:d+"px",[c]:f?0:"50%"}})};i===e.stat?i.level>1&&p():f&&p(),i=i.parent}return n}),s=X(()=>{let n=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:n+"px"}});return{indentStyle:a,vLines:r,hLineStyle:s}}}),et=(e,t)=>{const a=e.__vccOpts||e;for(const[r,s]of t)a[r]=s;return a},Ba={class:"tree-node-inner"},Ua={key:1,class:"tree-node",ref:"el"};function za(e,t,a,r,s,n){return e.table?(y(),$("tr",Ua,[G(e.$slots,"default",{indentStyle:e.indentStyle})],512)):(y(),$("div",{key:0,class:se(["tree-node",{"tree-node--with-tree-line":e.treeLine}]),style:ne(e.indentStyle),ref:"el"},[e.treeLine?(y(),$(te,{key:0},[(y(!0),$(te,null,pe(e.vLines,l=>(y(),$("div",{class:"tree-line tree-vline",style:ne(l.style)},null,4))),256)),e.stat.level>1?(y(),$("div",{key:0,class:"tree-line tree-hline",style:ne(e.hLineStyle)},null,4)):K("",!0)],64)):K("",!0),u("div",Ba,[G(e.$slots,"default",{indentStyle:e.indentStyle})])],6))}const Ma=et(Va,[["render",za]]);function Ia(e,t={}){const a={...t,statHandler(r){return this._statHandler2&&(r=this._statHandler2(r)),je(t.statHandler,Pe(r))},statsHandler(r){return je(t.statsHandler,Pe(r))},statsFlatHandler(r){return je(t.statsFlatHandler,Pe(r))}};return Pa(e,a)}function je(e,t){return e?e(t):t}const Ka=Se({components:{VirtualList:Ea,TreeNode:Ma},props:{value:{required:sa,type:Array},modelValue:{required:oa,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>Ia([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return this.modelValue||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let a=e;return this.btt&&(a=a.slice(),a.reverse()),a.filter(r=>t(r))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit("update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:Xe(ae("getStat")),has:Xe(ae("has")),updateCheck:ae("updateCheck"),getChecked:ae("getChecked"),getUnchecked:ae("getUnchecked"),openAll:ae("openAll"),closeAll:ae("closeAll"),openNodeAndParents:ae("openNodeAndParents"),isVisible:ae("isVisible"),move:ct("move"),add:Xe(ct("add")),addMulti(e,t,a){this.batchUpdate(()=>{let r=a;for(const s of e)this.add(s,t,r),r!=null&&r++})},remove:ae("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const a of t)this.remove(a)})},iterateParent:ae("iterateParent"),getSiblings:ae("getSiblings"),getData:ae("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const a=e();return this.batchUpdateWaiting=t,a}},watch:{processor:{immediate:!0,handler(e){if(e){const t=a=>{if(a){const{childrenKey:r}=this;return a[r]||(a[r]=[]),a[r]}else return this.valueComputed};e._statHandler2=this.statHandler?a=>a.data===this.placeholderData?a:this.statHandler(a):null,e.afterSetStat=(a,r,s)=>{const{childrenKey:n,updateBehavior:l}=this;let o=this.valueComputed;if(l==="new"){if(this.batchUpdateWaiting)return;o=this.getData()}else if(l==="modify"){const c=t(r?.data);c.includes(a.data)||c.splice(s,0,a.data)}this.batchUpdateWaiting||this._updateValue(o)},e.afterRemoveStat=a=>{var r;const{childrenKey:s,updateBehavior:n}=this;let l=this.valueComputed;if(n==="new"){if(this.batchUpdateWaiting)return;l=this.getData()}else if(n==="modify"){const o=t((r=a.parent)==null?void 0:r.data);yt(o,a.data)}this.batchUpdateWaiting||this._updateValue(l)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,da(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:t}=this;t.data=e,t.init(),this.stats=t.stats,this.statsFlat=t.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function ae(e){return function(...t){return this.processor[e](...t)}}function ct(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function Xe(e){return function(t,...a){return t&&(t=Pe(t)),e.call(this,t,...a)}}const Ha={key:0,class:"drag-placeholder he-tree-drag-placeholder"},Wa=["colspan"],ja={class:"drag-placeholder he-tree-drag-placeholder"};function Xa(e,t,a,r,s,n){const l=oe("TreeNode"),o=oe("VirtualList");return y(),ce(o,{class:se(["he-tree",{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering}]),ref:"vtlist",items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},{prepend:H(()=>[G(e.$slots,"prepend",{tree:e.self})]),default:H(({item:c,index:i})=>[z(l,{"vt-index":i,class:se([c.class,{"drag-placeholder-wrapper":c.data===e.placeholderData,"dragging-node":c===e.dragNode}]),style:ne(c.style),stat:c,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor,onClick:d=>e.$emit("click:node",c),onOpen:t[0]||(t[0]=d=>e.$emit("open:node",d)),onClose:t[1]||(t[1]=d=>e.$emit("close:node",d)),onCheck:t[2]||(t[2]=d=>e.$emit("check:node",d))},{default:H(({indentStyle:d})=>[c.data===e.placeholderData?(y(),$(te,{key:0},[e.table?(y(),$("td",{key:1,style:ne(d),colspan:e.placeholderColspan},[u("div",ja,[G(e.$slots,"placeholder",{tree:e.self})])],12,Wa)):(y(),$("div",Ha,[G(e.$slots,"placeholder",{tree:e.self})]))],64)):G(e.$slots,"default",{key:1,node:c.data,stat:c,indentStyle:d,tree:e.self},()=>[le(Z(c.data[e.textKey]),1)])]),_:2},1032,["vt-index","class","style","stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor","onClick"])]),append:H(()=>[G(e.$slots,"append",{tree:e.self})]),_:3},8,["class","items","disabled","table","itemKey"])}const qa=et(Ka,[["render",Xa]]);let A=null,x=null,qe,Ee,_e,Fe,Ye,ee,ut;const Ze={get targetInfo(){return Ee},get dragNode(){return ee},get targetTree(){return x}},Ya=Se({extends:qa,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function},dragOverThrottleInterval:{type:Number,default:0}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const a=this.eachDraggable(e);if(a!=null)return a}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return at(this.rootDroppable,[this,A]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const a=this.eachDroppable(e);if(a!=null)return a}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return at((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(i,d)=>{let f=!0;return A&&A!==this&&(f=f&&this._isMoved),this.table&&!this._isDragCopy&&(f=f&&this._isDragCopy),f&&(i.x!==d.x||i.y!==d.y)},t=(i,d)=>{x.ignoreUpdate(()=>{if(!x.has(x.placeholderData)){if(x.table){let p=0;const m=x.getRootEl().querySelector("tr");if(m)for(const{value:_}of fa(m.children))Ue(_,"display")!=="none"&&(p+=_.colSpan||1);p<1&&(p=1),x.placeholderColspan=p}x.add(x.placeholderData)}const f=x.getStat(x.placeholderData);x.move(f,i,d)})},a=()=>{const i=this;if(i.has(i.placeholderData))return i.remove(i.getStat(i.placeholderData)),!0},r=i=>{i?me.dropEffect=A!=null&&A.dragCopy?"copy":"move":me.dropEffect="none"},s=i=>{const d=this;i?r(!0):d.keepPlaceholder?d.has(d.placeholderData)||r(!1):(a(),r(!1))};let n={x:0,y:0};const l=this.getRootEl();let o=null;const c=()=>{x!=null&&x.has(x.placeholderData)&&x.ignoreUpdate(()=>{x.remove(x.getStat(x.placeholderData)),A&&(A.dragNode.hidden=!1,A.dragOvering=!1)})};this.treeDraggableInstance=La(l,{beforeDragStart:i=>{if(!me.triggerElement)return;let d=this.triggerClass;(!d||d.length===0)&&(d="tree-node");let f=ua(d),p=rt(me.triggerElement,m=>{if(lt(m,f))return!0;if(Be(m,"tree-node"))return"break"},{withSelf:!0,until:l});if(o=rt(p,m=>{if(Be(m,"tree-node"))return!0},{withSelf:!0,until:l}),!!o){if(ee=this.getNodeByElement(o),!ee)throw"Can't find drag node";if(this.isDraggable(ee))return this.$emit("before-drag-start",ee),this.$emit("beforeDragStart",ee),l}},onDragStart:i=>{var d,f,p;if(!o||!ee)return;{const{x:S,y:P}=o.getBoundingClientRect(),{clientX:O,clientY:N}=i;(d=i.dataTransfer)==null||d.setDragImage(o,O-S,N-P)}Ye={x:i.clientX,y:i.clientY},A=this,A.dragNode=ee,Fe=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:i.clientX,y:i.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(o);{let S,P=0;if(this.table){let O=o.getBoundingClientRect();S={x:O.x,y:O.y},this.rtl&&(S.x=O.right),P=O.height}else if(!this.rtl)S=o.children[0].getBoundingClientRect().toJSON(),P=S.height;else{const O=o.children[0].getBoundingClientRect();S={x:O.right,y:O.y},P=O.height}return this.btt&&(S.y+=P),S}})(),this.dragOvering=!0;const m=A.getSiblings(A.dragNode),_=m.indexOf(ee);qe={tree:A,dragNode:ee,parent:ee.parent,siblings:m,indexBeforeDrop:_},x=this,(f=i.dataTransfer)==null||f.setData("text",`he-tree drag start at ${new Date().toISOString()}`),A._eachDroppable()||setTimeout(()=>{ee.hidden=!0,t(ee.parent,_+1)},0),(p=this.ondragstart)==null||p.call(this,i)},onEnter:i=>{this.$emit("enter",i)},onLeave:i=>{_e=null,this.dragOvering=!1,me.preventDefault=!1,a(),this.$emit("leave",i)},onDragOver:va(i=>{if(!A){if(!this.onExternalDragOver||this.onExternalDragOver(i)===!1)return;me.preventDefault=!0}if(this.dragOverThrottleInterval>0)if(this._lastValidDragOver==null)this._lastValidDragOver=new Date().getTime();else{let k=new Date().getTime();if(k-this._lastValidDragOver>this.dragOverThrottleInterval)this._lastValidDragOver=k;else return}const d={x:i.clientX,y:i.clientY},f=e(d,n);if(n=d,!f)return;this.dragOvering=!0,x=this;const p=Fe?{x:Fe.x+(d.x-Ye.x),y:Fe.y+(d.y-Ye.y)}:{...d},{btt:m,rtl:_}=x;if(x.disableDrop){me.dropEffect="none";return}let S,P;const O=x.getRootEl().querySelectorAll(".tree-node"),N=[];O.forEach(k=>{!lt(k,["drag-placeholder-wrapper","dragging-node"])&&Ue(k,"display")!=="none"&&N.push(k)});const B=Je(N,k=>Ke(k)[m?"bottom":"top"]-p.y,{returnNearestIfNoHit:!0});let g=null,v,L;B.hit||(B.greater?m||(g=B.index-1,N[g]||g++):m&&(g=B.index+1,N[g]||g--)),g==null&&(g=B.index),v=N[g],L=m?N[g-1]:N[g+1],S=v&&x.getNodeByElement(v),P=L&&x.getNodeByElement(L);const{indent:b}=x,R=Te(()=>{if(x.table){let k=Ke(v).toJSON();const W=b*(S.level-1);return _?(k.width-=W,k.right-=W):k.x+=W,k}else return Ke(v.firstElementChild)}).action,M=Te(()=>m?p.y>R().y+R().height/2:p.y<R().y+R().height/2).action,j=Te(()=>m?!v||g===N.length-1&&M():!v||g===0&&M()).action,F=Te(()=>_?p.x-(R().x+R().width):R().x-p.x).action,w=Te(()=>_?p.x<R().x+R().width-b:p.x>R().x+b).action;let E;if(j())E=1,S=null;else if(S)F()>0?E=S.level-Math.ceil(F()/b):w()?E=S.level+1:E=S.level;else return;P&&E<P.level&&(E=P.level),(async()=>{let k,W,Y=!1,D=null;const T=async V=>{if(V.open)return!0;if(x.dragOpen)if(x.dragOpenDelay)if(D=V,_e===V)Y=!0;else{let U=ya();_e=V;const J=V;return setTimeout(async()=>{J!==_e?(Y=!0,U.resolve(!0)):(x.beforeDragOpen&&await x.beforeDragOpen(V),J!==_e?(Y=!0,U.resolve(!0)):(V.open=!0,D=null,U.resolve(!0)))},x.dragOpenDelay),await U.promise}else return x.beforeDragOpen&&await x.beforeDragOpen(V),V.open=!0,!0;else return!1},Q=async()=>{if(x.isDroppable(S)&&await T(S)){if(Y)return;k=S,W=null}else return!1},ge=(V=E)=>{let U=S,J=[];for(;U&&U.level>=V;)U=U.parent||null,J.unshift(U);let he=0;for(const be of J){if(x.isDroppable(be))return k=be,W=J[he+1]||S,!0;he++}return!1};ut=S||null,S?E>S.level?await Q()===!1&&ge(S.level):ge()===!1&&await Q():x.isDroppable(null)&&(k=null),_e=D;const I=!!(!Y&&(k||k===null));return{cancelled:Y,success:I,parent:k,index:I?W?(k?k.children:x.stats).filter(V=>V.data!==x.placeholderData).indexOf(W)+1:0:-1}})().then(k=>{if(!k.cancelled){if(!k.success){s(!1);return}if(x.maxLevel!=null&&x.maxLevel>0){let W=1;if(A){const Y=A.dragNode;let D=0;ue(Y,T=>{T.level>D&&(D=T.level)},{childrenKey:we}),W=D-Y.level+1}if(W+(k.parent?k.parent.level:0)>x.maxLevel){s(!1);return}}s(!0),t(k.parent,k.index)}})}),onDrop:i=>{x=this;const d=!A;if(!x)return;const f=A?.dragNode;let p,m=(()=>{var _;let S=!0;if(!x.has(x.placeholderData))S=!1;else if(d)p=(_=this.externalDataHandler)==null?void 0:_.call(this,i),S=p!=null;else if(!A.dragCopy){const P=x.getStat(x.placeholderData);A===x&&P.parent===f.parent&&ga(f,O=>O===P)}return S})();if(m){const _=x.getStat(x.placeholderData),S=x.getSiblings(_);Ee={tree:x,dragNode:f,parent:_.parent,siblings:S,indexBeforeDrop:S.indexOf(_)}}(()=>{if(c(),m){let _=Ee.indexBeforeDrop;A&&!A.dragCopy&&A===x&&qe.parent==Ee.parent&&qe.indexBeforeDrop<_&&_--,A&&A!==x&&!A._eachDroppable()&&A.batchUpdate(()=>{A.remove(f),A.updateCheck()}),x.batchUpdate(()=>{let S=A?.dragNode,P;p?P=p:A._eachDroppable()&&(P=wt(A.dragNode.data,{childrenKey:A.childrenKey}),A.dragCopyDataHandler&&(P=A.dragCopyDataHandler(P))),P&&(x.add(P),S=x.getStat(P)),x.move(S,Ee.parent,_),x.updateCheck()})}x.$emit("after-drop"),m&&(A&&(A.dragCopy||A.$emit("change")),x!==A&&x.$emit("change"))})()},onDragEnd:i=>{c(),A&&(A.dragNode&&(A.dragNode.hidden=!1),A.dragNode=null,A.dragOvering=!1,A=null),x=null,_e=null,ee=null,ut=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),Za=Se({props:{open:{type:Boolean}}}),Ga=u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[u("title",null,"chevron-right"),u("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"})],-1),Ja=[Ga];function Qa(e,t,a,r,s,n){return y(),$("a",{class:se(["he-tree__open-icon",{open:e.open}])},Ja,2)}const er=et(Za,[["render",Qa]]),tr={class:"ms-2 tree-pannel"},nr=["onDragover"],ar=["onClick"],rr=["onContextmenu","onClick"],lr={key:0,class:"icon-small fa-link fas mx-1"},sr={key:1,class:"icon-small fas fa-eye mx-1"},or={__name:"TreeArticle",setup(e){const t=ye();q(()=>t.article.id,()=>{i(t.article.id)}),q(()=>t.article,()=>{t?.article?.title&&typeof r?.text!=null&&(r.text=t?.article?.title,r.menuOn=t?.article?.menuOn,r.isRoute=t?.article?.isRoute,document.title=t.article.title)},{deep:!0}),ve(()=>{i(t.article.id)});function a(g,v){v(g),g?.children&&g.children.forEach(L=>{a(L,v)})}let r=null;const s=C(t.article.id);q(s,()=>{t.loadRec(s.value)});const n=C(0),l=C([]),o=C(),c=C([]);async function i(g){const v=await apiArt({command:"makeHeTree",id:g});s.value=g,l.value=v,a(l.value[0],L=>{L.lazy=!!(L?.directory&&!L?.children),L?.id===g&&(r=L)})}async function d(g,v,L){try{const b=await apiArt({command:"createNew",id:g.id}),R={id:b.id,text:b.title,parentId:b.parentId,directory:!1,npp:g.npp,children:[]},M=v;L.add(R,M,v.children.length),M.open=!0,s.value=b.id,document.showToast("Создано")}catch{return}}async function f(g,v,L){if(g.id==1){document.showToast("Не стоит удалять root");return}if(!await document.confirmDialog("Удалить ?"+g.id))return;const b=v.parent;b||document.showToast("Ошибка удаления parent не найден","error");let R;try{R=await apiArt({command:"deleteById",id:g.id})}catch{return}if(!L.remove(v)){document.showToast("Ошибка удаления элемента, перезагрузите","error");return}s.value=b.data.id??null,b.open=!0,b.data.directory=R.directory,b.data.text=R.title,L.openNodeAndParents(b),document.showToast("Удалено")}function p(g,v,L,b){c.value=[{label:"Новой вкладке",icon:"fas fa-link",command:()=>{window.open(location.pathname+"#"+v.id,"_blank")}},{label:"Создать",icon:"fas fa-plus",command:()=>d(v,L,b)},{label:"Удалить",icon:"fas fa-trash",command:()=>f(v,L,b)},{label:"Копировать",icon:"fas fa-copy",command:()=>m(v,L,b)}],o.value.show(g)}async function m(g,v,L){try{const b=await apiArt({command:"copyRec",id:g.id}),R={id:b.id,text:b.title,parentId:g.id,directory:!1,npp:g.npp,children:[]},M=v.parent;L.add(R,M,g.npp),M.open=!0,s.value=b.id,document.showToast("Скопировано")}catch{return}}function _(g,v){s.value=g.id}async function S(g,v,L){if(g.lazy&&!v?.data?.lazyLoad){v.data.lazyLoad=!0;let b;try{g._loading=!0,b=await apiArt({command:"getChildrens",id:g.id}),lazyLoad=!1}catch{}finally{g._loading=!1,v.data.lazy=!1}L.batchUpdate(()=>{L.addMulti(b,v,v.children.length),v.open=!0})}else v.open=!v.open}let P=null;function O(){const{dragNode:g}=Ze,v=g.parent??null,L=v?v.children.indexOf(g):0;P={parent:v,index:L},s.value=g.data.id}async function N(){const{dragNode:g,targetInfo:v}=Ze,L=g.data.id;if(L===1){B(g);return}const b=v?.parent??null,R=b?.data?.id??null;if(!R){B(g);return}const M=v.siblings??b.children??[],j=M.findIndex(w=>w===g||w.data?.id===L),F=j>0?M[j-1].data?.id??0:0;try{const w=await apiArt({command:"move",id:L,newParentId:R,idBrotherUp:F});b&&(b.open=!0)}catch{B(g);return}}function B(g){const{targetTree:v}=Ze;P?.parent&&v&&(v.move(g,P.parent,P.index),P.parent.open=!0)}return(g,v)=>{const L=oe("ContextMenu");return y(),$("div",tr,[(y(),ce(h(Ya),{class:"mtl-tree my-2",modelValue:l.value,"onUpdate:modelValue":v[0]||(v[0]=b=>l.value=b),key:n.value,onAfterDrop:N,ondragstart:O,treeLine:""},{default:H(({node:b,stat:R,tree:M})=>[u("div",{class:"d-flex pointer",onDragover:Oe(j=>b.lazy?S(b,R,M):"",["stop","prevent"])},[u("div",null,[R.children.length?(y(),ce(h(er),{key:0,open:R.open,class:"m-0 p-0",onClick:j=>R.open=!R.open},null,8,["open","onClick"])):K("",!0)]),b.lazy?(y(),$("div",{key:0,onClick:j=>S(b,R,M)},[...v[1]||(v[1]=[u("i",{class:"fas fa-chevron-right me-1"},null,-1)])],8,ar)):K("",!0),u("div",{onContextmenu:Oe(j=>p(j,b,R,M),["prevent"]),class:se({active:b.id==s.value,notroute:!b.isRoute,route:b.isRoute}),onClick:j=>_(b,R)},[u("span",{style:ne(b.directory?"margin-left:-3px":"margin-left:3px")},null,4),le(Z(b.text)+" ",1),b.isRoute?(y(),$("i",lr)):K("",!0),b.menuOn?(y(),$("i",sr)):K("",!0)],42,rr)],40,nr)]),_:1},8,["modelValue"])),z(L,{ref_key:"menu",ref:o,model:c.value},null,8,["model"])])}}},ir={class:"ms-2 tree-pannel"},cr={class:"row my-1"},ur={class:"input-group input-group-sm"},dr=["textContent","onClick"],fr={__name:"FindText",setup(e){const t=ye(),a=C([]),r=C("");async function s(){a.value=await t.search(r.value)}async function n(l){await t.loadRec(l),t.article.body.search(r.value)>=0&&(t.searchTextView=r.value),t.article.controller.search(r.value)>=0&&(t.searchTextController=r.value)}return(l,o)=>(y(),$("div",ir,[u("div",cr,[u("div",ur,[u("button",{class:"btn btn-primary fas fa-times",onClick:o[0]||(o[0]=c=>h(t).statusLeftPannel="tree")}),ie(u("input",{placeholder:"найти",type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=c=>r.value=c)},null,512),[[ke,r.value]]),u("button",{class:"btn btn-primary fas fa-angle-right",onClick:o[2]||(o[2]=c=>s())})])]),(y(!0),$(te,null,pe(a.value,c=>(y(),$("div",null,[u("span",{textContent:Z(c.title),onClick:i=>n(c.id),class:se(["pointer",{active:h(t).article.id==c.id}])},null,10,dr)]))),256))]))}},pr=Ht(fr,[["__scopeId","data-v-f8b286bb"]]),hr={key:0},mr={style:{position:"relative"}},gr={__name:"EditArticle",setup(e){const t=ye(),a=C({show:!1,x:0,y:0});function r(){t.article.routeParams.useController||(f.value=0,m.value="view"),t.article.routeParams.useController&&(f.value=50,m.value="full"),t.modeEditorSplitter=m.value,d.value.resetState()}const s=C(null),n=C(20);let l=0;const o=C("open"),c=P=>{n.value=P.sizes[0]};function i(){o.value=="open"?(l=n.value,n.value=0,o.value="hidden"):(n.value=l,o.value="open"),t.modeTreeSplitter=o.value,s.value.resetState()}const d=C(),f=C(50);let p=0;const m=C("full");q(d,()=>{r()});function _(P){f.value=P.sizes[0]}function S(){switch(m.value){case"full":p=f.value,f.value=0,m.value="view";break;case"view":f.value=100,m.value="controller";break;case"controller":f.value=p,m.value="full";break}t.modeEditorSplitter=m.value,d.value.resetState()}return ve(()=>{const P=document.getElementById("editor-layer").getBoundingClientRect();a.value.y=window.innerHeight-P.top,a.value.x=window.innerWidth,a.value.show=!0,t.toggleTreeSplitter=i,t.toggleEditorSplitter=S,q(()=>t.article.routeParams.useController,()=>{r()})}),(P,O)=>{const N=oe("SplitterPanel"),B=oe("Splitter");return y(),$("div",null,[u("div",{style:ne({height:a.value.y+"px",width:a.value.x+"px"}),id:"editor-layer"},[a.value.show?(y(),$("div",hr,[z(B,{style:ne({height:a.value.y+"px",width:a.value.x+"px"}),onResizeend:c,ref_key:"splitterTreeRef",ref:s},{default:H(()=>[z(N,{size:n.value,minSize:0},{default:H(()=>[u("div",mr,[ie(u("button",{style:{position:"absolute",right:"10px","z-index":"1000"},class:"btn btn-primary fas fa-search",onClick:O[0]||(O[0]=g=>h(t).statusLeftPannel="find")},null,512),[[Ne,h(t).statusLeftPannel==="tree"]])]),ie(z(or,null,null,512),[[Ne,h(t).statusLeftPannel==="tree"]]),ie(z(pr,null,null,512),[[Ne,h(t).statusLeftPannel==="find"]])]),_:1},8,["size"]),z(N,{size:100-n.value,minSize:1},{default:H(()=>[z(B,{style:{height:"100%"},onResizeend:_,ref_key:"splitEditorRef",ref:d},{default:H(()=>[z(N,{size:f.value,minSize:1},{default:H(()=>[z(tt,{modelValue:h(t).article.controller,"onUpdate:modelValue":O[1]||(O[1]=g=>h(t).article.controller=g),lang:"php",theme:h(t).aceTheme,height:a.value.y},null,8,["modelValue","theme","height"])]),_:1},8,["size"]),z(N,{size:100-f.value,minSize:1},{default:H(()=>[z(tt,{modelValue:h(t).article.body,"onUpdate:modelValue":O[2]||(O[2]=g=>h(t).article.body=g),lang:"html",theme:h(t).aceTheme,height:a.value.y},null,8,["modelValue","theme","height"])]),_:1},8,["size"])]),_:1},512)]),_:1},8,["size"])]),_:1},8,["style"])])):K("",!0)],4)])}}},vr={class:"d-flex"},yr=["src"],br={class:"flex-grow-1"},_r={key:0,class:"text-danger"},wr={key:0},kr={key:0,class:"text-danger ms-2"},xr=["onClick"],$r={class:"progress mt-2",style:{height:"10px"}},Sr={__name:"UploadFile",props:{path:{type:String,required:!0},directory:{type:Object,required:!0}},emits:["uploaded"],setup(e,{expose:t,emit:a}){const r=a,s=e,n=C(!1),l=C(!1),o=C([]),c=X(()=>new Set((s.directory??[]).map(O=>(O.name??"").toLowerCase())));function i(){n.value=!0}function d(){n.value=!1,o.value=[]}function f(O,N){return new Promise((B,g)=>{const v=new XMLHttpRequest,L=new URLSearchParams({command:"uploadBin",path:s.path,filename:O.name});v.open("POST",`/a_dmin/api/fileManager?${L.toString()}`,!0),v.responseType="json",v.upload.onprogress=b=>{b.lengthComputable&&(o.value[N].progress=Math.round(b.loaded/b.total*100))},v.onload=()=>{const b=v.response;if(o.value[N].progress=100,o.value[N].status=v.status===200&&b?.status===!0?"ok":"error",o.value[N].status==="ok")r("uploaded",b.data),B(b.data);else{const R=b?.errorMsg||b?.message||`Ошибка загрузки (${v.status})`;g(new Error(R))}},v.onerror=()=>{o.value[N].status="error",g(new Error("Ошибка сети при загрузке файла"))},v.onabort=()=>{o.value[N].status="error",g(new Error("Загрузка отменена"))},v.setRequestHeader("Content-Type","application/octet-stream"),v.send(O)})}async function p(O){const N=Array.isArray(O?.files)?O.files:[];N.length&&(o.value=N.map(B=>({name:B.name,progress:0,status:"loading"})),l.value=!0,await Promise.all(N.map(async(B,g)=>{try{await f(B,g)}catch(v){document.showToast(v.message||"Ошибка загрузки файла","error")}})),l.value=!1,P.value?.clear())}function m(O){return c.value.has(O.toLowerCase())}function _(O){return URL.createObjectURL(O)}function S(O){return!!O&&typeof O.type=="string"&&O.type.startsWith("image/")}const P=C(null);return t({open:i,close:d}),(O,N)=>{const B=oe("FileUpload"),g=oe("Dialog");return y(),ce(g,{visible:n.value,"onUpdate:visible":N[0]||(N[0]=v=>n.value=v),modal:"",header:"Загрузка файлов",class:"w-50"},{default:H(()=>[z(B,{name:"files[]",mode:"advanced",multiple:"",chooseLabel:"Выбрать файлы",uploadLabel:"Загрузить",cancelLabel:"Отмена",customUpload:"",auto:!1,maxFileSize:5e8,ref_key:"uploader",ref:P,onUploader:p},{content:H(({files:v})=>[(y(!0),$(te,null,pe(v,(L,b)=>(y(),$("div",{key:L.name,class:"mb-2"},[u("div",null,[u("div",vr,[u("div",null,[S(L)?(y(),$("img",{key:0,src:_(L),alt:"",style:{width:"96px",height:"auto"},class:"me-2 rounded border"},null,8,yr)):K("",!0)]),u("div",br,[u("div",null,[u("small",null,Z(L.name),1)]),m(L.name)&&!l.value?(y(),$("div",_r,"копия — будет переписан")):K("",!0),u("div",null,[o.value[b]?(y(),$("small",wr,Z(o.value[b].progress)+"%",1)):K("",!0)])]),m(L.name)?(y(),$("div",kr,[u("i",{class:"fas fa-times pointer",onClick:R=>v.splice(b,1)},null,8,xr)])):K("",!0)])]),u("div",$r,[u("div",{class:se(["progress-bar",{"bg-success":o.value[b]?.status==="ok","bg-danger":o.value[b]?.status==="error","progress-bar-striped progress-bar-animated":o.value[b]?.status==="loading"}]),role:"progressbar",style:ne({width:(o.value[b]?.progress||0)+"%"})},null,6)])]))),128))]),_:1},512)]),_:1},8,["visible"])}}},Cr={class:"me-2 icon"},Tr={key:0},Dr={class:"ms-1",style:{"font-size":"85%"}},Er={key:0,class:"thumb-pic"},Pr=["src"],Or={class:"file-name"},Lr={key:1,class:"thumb-file"},Ar={style:{"word-break":"break-all"}},Fr={__name:"FileItem",props:{el:{type:Object,required:!0},viewFull:Boolean,viewSize:Number,path:String,onRightClick:Function},setup(e){const t=e;X(()=>{const r=t.el.name||"";return r.includes(".")?r.split(".").pop().toLowerCase():""});function a(r,s){return t.viewSize>r&&t.viewSize>s?`width: ${r} px; height:  ${s} px;`:r>=s?"width:"+(t.viewSize-2)+"px;":"height:"+(t.viewSize-2)+"px;"}return(r,s)=>e.viewFull?(y(),$("div",{key:1,class:"thumb",style:ne(`width:${e.viewSize}px;`),onContextmenu:s[1]||(s[1]=Oe(n=>e.onRightClick(n,e.el),["prevent"]))},[e.el.isImage?(y(),$("div",Er,[u("img",{src:e.path+e.el.name+"?"+e.el.date,style:ne(a(e.el.width,e.el.height))},null,12,Pr),u("div",Or,[le(Z(e.el.name),1),s[2]||(s[2]=u("br",null,null,-1)),le("("+Z(e.el.width)+"x"+Z(e.el.height)+")",1)])])):(y(),$("div",Lr,[s[3]||(s[3]=u("i",{class:"far fa-file",style:{"font-size":"300%",color:"#777"}},null,-1)),u("div",Ar,Z(e.el.name),1)]))],36)):(y(),$("div",{key:0,class:"d-flex my-1",onContextmenu:s[0]||(s[0]=Oe(n=>e.onRightClick(n,e.el),["prevent"]))},[u("div",Cr,[u("i",{class:se({"far fa-file-image":e.el.isImage,"far fa-file":!e.el.isImage})},null,2)]),u("div",null,[le(Z(e.el.name)+" ",1),e.el.isImage?(y(),$("span",Tr,[u("span",Dr,"("+Z(e.el.width)+"x"+Z(e.el.height)+")",1)])):K("",!0)])],32))}},Nr=["id"],Rr={__name:"AceFileEditor",props:dt({fileExtention:{type:String,default:"html"},theme:{type:String,default:"monokai"},readOnly:{type:Boolean,default:!1},tabSize:{type:Number,default:4},wrap:{type:Boolean,default:!1},height:{type:Number,default:100}},{modelValue:{type:String,default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(e){Re.config.set("basePath","/vendor/magicpro/ace");const t=C(ft()),a=e,r=Qe(e,"modelValue"),s=C(null);let n=null;function l(){const c={js:"ace/mode/javascript",css:"ace/mode/css"};return c[a.fileExtention]?c[a.fileExtention]:"ace/mode/text"}const o=c=>`ace/theme/${c}`;return ve(()=>{l(),n=Re.edit(t.value,{value:r.value,mode:l(),theme:o(a.theme),readOnly:a.readOnly,wrap:a.wrap,tabSize:a.tabSize,useWorker:!1}),n.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableEmmet:!0}),n.setFontSize(14),n.session.on("change",()=>{r.value=n.getValue()})}),q(r,c=>{if(!n)return;const i=n.getValue();c!==i&&n.setValue(c)}),pt(()=>n?.destroy()),q(()=>a.fileExtention,c=>{const i=l();n?.session.setMode(i)}),q(()=>a.theme,c=>n?.setTheme(o(c))),(c,i)=>(y(),$("div",{ref_key:"el",ref:s,id:t.value,style:{width:"100%",height:"100%"}},null,8,Nr))}},Vr={class:"d-flex gx-2 py-2 mx-0 align-items-center"},Br={class:"flex-grow-1"},Ur={__name:"EditFile",props:{fileName:{type:String,default:"/design/1.txt"},width:{type:String,default:"800"},height:{type:String,default:"600"}},emits:["close"],setup(e,{emit:t}){const a=e,r=C(""),s=C(""),n=C(!1),l=async f=>{f.ctrlKey&&f.code==="KeyS"&&(console.log("save file"),f.stopImmediatePropagation(),f.preventDefault(),f.stopPropagation(),await c())};ve(async()=>{r.value=a.fileName.split(".").pop();const f=await $e({command:"loadFile",fileName:a.fileName});s.value=f.fileData,n.value=!0,window.addEventListener("keydown",l,{capture:!0})}),ht(()=>{window.removeEventListener("keydown",l)});const o=C(!0);async function c(){console.log(s.value),await $e({command:"saveFile",fileName:a.fileName,fileData:s.value}),document.showToast("Сохранен файл "+a.fileName)}async function i(){let f="";switch(r.value){case"css":{f=await prettier.format(s.value,{parser:"css",plugins:[prettierPlugins.postcss],tabWidth:4,printWidth:160});break}case"js":{f=await prettier.format(s.value,{parser:"babel",plugins:prettierPlugins,semi:!0,tabWidth:4,printWidth:120});break}default:return}document.showToast("Отформатировано"),s.value=f}const d=t;return(f,p)=>n.value?(y(),ce(gt,{key:0,visible:o.value,"onUpdate:visible":p[1]||(p[1]=m=>o.value=m),width:"props.width",height:"props.height",header:"Имя файла",onClose:p[2]||(p[2]=m=>{d("close"),n.value=!1})},{header:H(()=>[u("div",Vr,[u("div",Br,Z(e.fileName),1),u("div",{class:"mx-2"},[u("button",{class:"btn btn-sm btn-primary",onClick:c},"Save→")]),u("div",{class:""},[u("button",{class:"btn fas fa-magic btn-success",onClick:i})])])]),default:H(()=>[z(Rr,{modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=m=>s.value=m),fileExtention:r.value,theme:"chrome"},null,8,["modelValue","fileExtention"])]),_:1},8,["visible"])):K("",!0)}},zr={class:"d-flex align-items-center gap-2 p-1 rounded w-100 border"},Mr={class:"flex-grow-1"},Ir=["onClick"],Kr={key:0,class:"mt-2"},Hr={key:0,class:"my-5 py-5 text-center"},Wr={class:"d-flex folder"},jr={class:"me-2"},Xr=["onClick"],qr=["onContextmenu","onClick"],Yr={key:1,class:"text-center p-3"},Zr={class:"mb-3"},Gr={__name:"FileManager",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:["update:visible"],setup(e){const t=Qe(e,"visible"),a=C(null),r=C("/design/"),s=C("/design/");s.value=r.value;const n=C([]),l=C([]),o=C(!0),c=C(160),i=C(!1),d=C(!1),f=C("");ve(async()=>{await _(s.value),await B(s.value)});async function p(){l.value.length>0&&(s.value=l.value.pop()),await B(s.value)}function m(){f.value="",d.value=!0}async function _(){try{i.value=!1;const D=await $e({command:"start"});r.value=D.startDirectory,s.value=D.startDirectory}catch(D){console.error(D)}finally{i.value=!0}}async function S(){if(f.value.trim())try{i.value=!1,await $e({command:"mkdir",path:s.value,name:f.value.trim()}),await B(s.value)}catch(D){console.error(D)}finally{d.value=!1,i.value=!0}}function P(){a.value.open()}async function O(D){try{i.value=!1,l.value.push(s.value),s.value=s.value+D+"/",await B(s.value)}catch(T){console.error(T)}finally{i.value=!0}}function N(D){document.showToast("Загружен "+D.name),n.value=n.value.filter(T=>T.name!==D.name),n.value.unshift(D)}async function B(D){try{i.value=!1,n.value=await $e({command:"dirList",path:D})}catch(T){console.error(T)}finally{i.value=!0}}async function g(D){if(await document.confirmDialog("Удалить?"+s.value+D))try{i.value=!1,await $e({command:"delete",path:s.value,name:D}),n.value=n.value.filter(T=>T.name!==D),document.showToast("Удален "+D)}catch(T){console.error(T)}finally{i.value=!0}}function v(D){const T=document.createElement("textarea");T.value=D,T.style.position="fixed",T.style.opacity="0",document.body.appendChild(T),T.select(),T.setSelectionRange(0,T.value.length);try{const Q=document.execCommand("copy");document.showToast(Q?"Скопирована ссылка "+D:"Ошибка копирования ссылки",Q?"success":"error")}catch{document.showToast("Ошибка копирования ссылки","error")}finally{document.body.removeChild(T)}}function L(D){const T=`<img src="${encodeURI(s.value+D.name)}" alt="${D.name}" height="${D.height}" width="${D.width}" />`;v(T)}function b(D){v(encodeURI(s.value+D.name))}function R(D){W.value=s.value+D.name,Y.value=!0}const M=C(),j=C([]),F=D=>{D.key==="Escape"&&(D.stopPropagation(),M.value?.hide&&M.value.hide(),document.removeEventListener("keydown",F,!0))};function w(D,T){document.addEventListener("keydown",F,!0),j.value=[{label:"Удалить",icon:"fas fa-trash",command:()=>{g(T.name)}},{label:"Переименовать",icon:"fas fa-plus",command:()=>{}}],T.type==="file"&&j.value.push({label:"Копировать путь",icon:"fas fa-link",command:()=>{b(T)}}),T.type==="file"&&T.isImage&&j.value.push({label:"Копировать Img",icon:"far fa-file-image",command:()=>{L(T)}}),T.type==="file"&&["css","js","ts","txt","csv","json","md"].includes(Ct(T.name))&&j.value.push({label:"Редактировать",icon:"fas fa-pen",command:()=>{R(T)}}),M.value.show(D)}async function E(D){if(l.value.length!==0){if(D===0){s.value=r.value,l.value=[],await B(s.value);return}D>=l.value.length||(s.value=l.value[D],l.value=l.value.slice(0,D),await B(s.value))}}const k=X(()=>s.value.split("/").filter(Q=>Q!=="").map((Q,ge)=>({name:Q,index:ge}))),W=C(""),Y=C(!1);return(D,T)=>{const Q=oe("Dialog"),ge=oe("ContextMenu");return y(),$(te,null,[z(gt,{visible:t.value,"onUpdate:visible":T[1]||(T[1]=I=>t.value=I),zIndex:1e3},{header:H(()=>[u("div",zr,[s.value!==r.value?(y(),$("button",{key:0,onClick:p,class:"btn btn-success fas fa-chevron-left"})):K("",!0),u("button",{onClick:m,class:"btn btn-success fas fa-folder-plus"}),u("button",{onClick:P,class:"btn btn-success fas fa-file-upload"}),u("div",Mr,[(y(!0),$(te,null,pe(k.value,(I,V)=>(y(),$("span",{key:V},[u("span",{class:se(["path-element",{"path-end":V===k.value.length-1}]),onClick:U=>E(V)},Z(I.name),11,Ir),T[6]||(T[6]=u("span",{class:"mx-1",style:{"font-size":"80%"}},"/",-1))]))),128))]),u("div",null,[u("button",{class:se(["btn btn-success",{"fas fa-list":o.value,"fas fa-th":!o.value}]),onClick:T[0]||(T[0]=I=>o.value=!o.value)},null,2)])])]),default:H(()=>[i.value?(y(),$("div",Kr,[n.value.length===0?(y(),$("div",Hr,"...")):K("",!0),(y(!0),$(te,null,pe(n.value.filter(I=>I.type==="dir"),(I,V)=>(y(),$("div",null,[u("div",Wr,[u("div",jr,[u("i",{class:"far fa-folder pointer",onClick:U=>O(I.name)},null,8,Xr)]),u("div",{class:"pointer",onContextmenu:Oe(U=>w(U,I),["prevent"]),onClick:U=>O(I.name)},Z(I.name),41,qr)])]))),256)),u("div",{class:se([{"d-flex flex-wrap":o.value},""])},[(y(!0),$(te,null,pe(n.value.filter(I=>I.type!=="dir"),I=>(y(),ce(Fr,{key:I.name,el:I,viewFull:o.value,viewSize:c.value,path:s.value,onRightClick:w},null,8,["el","viewFull","viewSize","path"]))),128))],2)])):(y(),$("div",Yr,[...T[7]||(T[7]=[u("div",{class:"spinner-border text-info"},null,-1)])]))]),_:1},8,["visible"]),Y.value?(y(),ce(Ur,{key:0,fileName:W.value,zIndex:1e3,onClose:T[2]||(T[2]=I=>Y.value=!1)},null,8,["fileName"])):K("",!0),z(Q,{visible:d.value,"onUpdate:visible":T[5]||(T[5]=I=>d.value=I),header:"Создать папку",modal:""},{footer:H(()=>[u("button",{class:"btn btn-secondary btn-sm",onClick:T[4]||(T[4]=I=>d.value=!1)},"Отмена"),u("button",{class:"btn btn-success btn-sm",onClick:S},"Создать")]),default:H(()=>[u("div",Zr,[T[8]||(T[8]=u("label",{class:"form-label"},"Имя новой папки",-1)),ie(u("input",{"onUpdate:modelValue":T[3]||(T[3]=I=>f.value=I),type:"text",class:"form-control",placeholder:"Новая папка",onKeyup:St(S,["enter"])},null,544),[[ke,f.value]])])]),_:1},8,["visible"]),z(Sr,{ref_key:"uploadRef",ref:a,path:s.value,directory:n.value,onUploaded:N,class:"w-50"},null,8,["path","directory"]),z(ge,{ref_key:"menu",ref:M,model:j.value},null,8,["model"])],64)}}},Jr={__name:"ArtEditor",setup(e){const t=ye(),a=C(1);ve(()=>{const s=new URLSearchParams(window.location.search);Object.fromEntries(s.entries()),t.loadRec(Number(location.hash.slice(1))||1),history.pushState(a.value,null,"#"+a.value),console.log("--start ediror--"),Tt("#ff642f"),window.addEventListener("popstate",r)}),ht(()=>{window.removeEventListener("popstate",r)});const r=s=>{a.value=Number(location.hash.slice(1))||1};return(s,n)=>(y(),$(te,null,[h(t).articleReady?(y(),ce(gn,{key:0})):K("",!0),h(t).articleReady?(y(),ce(gr,{key:1})):K("",!0),z(Gr,{visible:h(t).statusFileManager,"onUpdate:visible":n[0]||(n[0]=l=>h(t).statusFileManager=l)},null,8,["visible"]),z(Qn),h(t).articleReady?(y(),ce(Jn,{key:2})):K("",!0),z(Wt)],64))}},Qr=[mt,Et,Pt,Ot,Lt,At,Ft,Nt,Rt,Mt],Ce=Dt(Jr);Qr.forEach(e=>{Ce.component(e.name,e)});Ce.use(Vt,{theme:{preset:Bt,options:{cssLayer:{name:"primevue",order:"theme, base, primevue"}}}});Ce.use(Ut);Ce.use(mt);Ce.use(Kt());Ce.mount("#art_editor");Object.assign(globalThis,zt);
