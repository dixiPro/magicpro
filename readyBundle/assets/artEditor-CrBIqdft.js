import{r as D,c as W,a as $e,t as bt,b as x,o as b,d,e as I,u as h,w as oe,v as we,n as le,f as _t,F as ee,g as pe,h as G,i as se,j as ce,k as j,l as z,m as re,p as Ne,q as wt,s as kt,x as ut,y as xe,z as Z,A as $t,B as te,C as Se,D as q,E as ke,G as Me,H as Pe,I as Le,J as xt,K as St,L as Qe,M as Ct,N as Tt,_ as Dt,O as Et,T as dt,P as Pt,Q as Ot,R as Lt,S as At,U as Ft,V as Nt,W as Rt,X as Bt,Y as Vt,Z as Ut,$ as zt,a0 as Mt}from"./ToastConfirm-Dx9X-4_N.js";import{s as It}from"./index-C-hXeCQ3.js";import{d as Kt,a as ft,M as Ht,_ as jt,c as Wt}from"./EditFile-BnPBOO2K.js";import{_ as Xt}from"./_plugin-vue_export-helper-DlAUqK2U.js";async function pt(e,t=2){try{return await prettier.format(e,{parser:"php",plugins:prettierPlugins,tabWidth:t})}catch(n){throw console.error("Ошибка при форматировании Php:",n),new Error("Ошибка при форматировании Php")}}async function qt(e,t=2){let n=[],r=e.replace(/@php([\s\S]*?)@endphp/g,(s,c)=>{const i=n.length;return n.push(s),`<!--___PHP____${i}-->`}),o=[];r=r.replace(/@extends\s*\(\s*['"][^)]+?\[[\s\S]*?\]\s*\)/g,s=>{const c=o.length;return o.push(s),`<!--___EXTENDS____${c}-->`});let a=[];r=r.replace(/@props\s*\(\s*\[[\s\S]*?\]\s*\)/g,s=>{const c=a.length;return a.push(s),`<!--___PROPS____${c}-->`});let l=[];r=r.replace(/{{--([\s\S]*?)--}}/g,(s,c)=>{const i=l.length;return l.push(s),`<!--___COMMENT____${i}-->`}),n.length>0&&(n=await Promise.all(n.map(s=>Yt(s,t))));try{r=await prettier.format(r,{parser:"html",plugins:[prettierPlugins.html],tabWidth:t,printWidth:160})}catch(s){const c=s.message.split(`
`).map(i=>i.replace(/^\s+/,"")).map(i=>i.replace(/For more info.*/,"")).filter(i=>!i.includes("at")).join(`
`);document.showToast(c,"error")}return r=Zt(r,t),r=r.replace(/<!--___PHP____(\d+)-->/g,(s,c)=>n[c]),r=r.replace(/<!--___PROPS____(\d+)-->/g,(s,c)=>a[c]),r=r.replace(/<!--___COMMENT____(\d+)-->/g,(s,c)=>l[c]),r=r.replace(/<!--___EXTENDS____(\d+)-->/g,(s,c)=>o[c]),r}async function Yt(e,t){e=e.replace(/@php\s*/g,"").replace(/\s*@endphp/g,"");let n=`<?php
${e}`,r=await pt(n,t);return r=r.replace(/^<\?php\s*/,"").trim(),r=r.split(`
`).map(o=>" ".repeat(t)+o).join(`
`),r=`@php
${r}
@endphp`,r}function Zt(e,t=2){const n=e.split(`
`);let r=0;const o=[];for(let a of n){let l=Gt(a);for(let s of l){let c=Jt(s);s.includes("<!--___PHP____")?(s=s.replace(/^\s+/,""),o.push(s)):(r=r+c.ident,o.push(" ".repeat(r*t)+c.line),r=r+c.after)}}return o.join(`
`)}function Gt(e){const t=e.match(/^(\s*)/),n=t?t[1]:"",r=e.split(/(?=@\w+)/).map(o=>o.trim()).filter(Boolean);return r.length<=1?[e]:r.map(o=>n+o)}function Jt(e){const t={if:{ident:0,after:1},elseif:{ident:-1,after:1},else:{ident:-1,after:1},endif:{ident:-1,after:0},section:{ident:0,after:1,extended:{ident:0,after:0}},endsection:{ident:-1,after:0},foreach:{ident:0,after:1},endforeach:{ident:-1,after:0},forelse:{ident:0,after:1},endforelse:{ident:-1,after:0},for:{ident:0,after:1},endfor:{ident:-1,after:0},yield:{ident:1,after:-1},while:{ident:0,after:1},endwhile:{ident:-1,after:0},section:{ident:0,after:1},endsection:{ident:-1,after:0},switch:{ident:0,after:1},case:{ident:-1,after:1},endswitch:{ident:-1,after:0},endcase:{ident:-1,after:0},php:{ident:0,after:1},endphp:{ident:-1,after:0},livewire:{ident:0,after:1},endlivewire:{ident:-1,after:0},component:{ident:0,after:1},endcomponent:{ident:-1,after:0},slot:{ident:0,after:1},endslot:{ident:-1,after:0},props:{ident:0,after:0},error:{ident:0,after:1},enderror:{ident:-1,after:0},once:{ident:0,after:1},endonce:{ident:-1,after:0},push:{ident:0,after:1},endpush:{ident:-1,after:0},stack:{ident:0,after:1},endstack:{ident:-1,after:0},verbatim:{ident:0,after:1},endverbatim:{ident:-1,after:0},can:{ident:0,after:1},endcan:{ident:-1,after:0},cannot:{ident:0,after:1},endcannot:{ident:-1,after:0},auth:{ident:0,after:1},endauth:{ident:-1,after:0},guest:{ident:0,after:1},endguest:{ident:-1,after:0},mproauth:{ident:0,after:1},endmproauth:{ident:-1,after:0}};let n=(e.match(/@\w+/)||[null])[0];if(!n)return{ident:0,after:0,line:e};if(n=n.replace("@",""),!t[n])return{ident:0,after:0,line:e};let r=e.replace(new RegExp(`${n}\\s*\\(`,"g"),`${n}(`),o=t[n];return o.line=r,o.extended&&(r.match(new RegExp(`${n}\\(([^)]*)\\)`))||[null,""])[1].split(",").length>1?(o=t[n].extended,o.line=r,res):o}function Qt(e){const t={};let n=e.match(/\{% *setMeta\('title', *'([^']+)'/);return t.title=n?n[1]:null,n=e.match(/\{% *setMeta\('htmlDescr', *'([^']+)'/),t.description=n?n[1].trim():null,n=e.match(/\{% *setMeta\('keywords', *'([^']+)'/),t.keywords=n?n[1].trim():null,n=e.match(/\{% *setMeta\('h1', *'([^']+)'/),t.h1=n?n[1].trim():null,console.log(t),` @extends('magic::main',[
  'title' => '${t.title}',
  'description' => '${t.description}',
  'keywords' => '${t.keywords}'
])
  

<h1>${t.h1}</h1>

`+e}const ve=Kt("article",()=>{const e=D({}),t=W(()=>{if(e.value.name!=="")return/^[a-z0-9_-]+$/i.test(e.value.name)}),n=W(()=>/{%\s*.*?\s*%}/.test(e.value.body)),r=D(!1),o=D(!1),a=D(!1),l="chrome",s=["chrome","monokai","dracula","twilight"],c=D("tree"),i=D(!1),u=D(""),p=D("");async function f(N){const w=await $e({command:"getById",id:N});e.value=m(w),history.pushState(N,null,"#"+N),i.value=!0,document.title=e.value.title}function m(N){let w=N.routeParams;(Array.isArray(w)||w===null||typeof w!="object")&&(w={});const{adminOnly:S=!1,useController:$=!0,getEnable:H=!1,utmParamsEnable:Y=!0,bindKeys:T=!1,keysArr:P=[]}=w;return N.routeParams={useController:$,adminOnly:S,getEnable:H,utmParamsEnable:Y,bindKeys:T,keysArr:P},N}async function _(){e.value=await $e({command:"saveById",article:e.value}),document.showToast("Сохранено")}async function C(){try{const N=await $e({command:"getDefaultController",id:1});e.value.controller=N.controller}catch(N){console.log(N)}}async function E(N){try{const w=await $e({command:"articleByName",name:N});window.open(location.pathname+"#"+w.id,"_blank")}catch{}}async function O(){try{const N=await $e({command:"getDefaultLiveWareController",id:1});e.value.controller=N.controller}catch(N){console.log(N)}}async function F(N){try{return await $e({command:"search",text:N})}catch(w){console.log(w)}}async function U(){const N=await qt(e.value.body,2);e.value.body=N;const w=await pt(e.value.controller,2);e.value.controller=w,document.showToast("Отформатировано")}function g(){e.value.name=bt(e.value.title.trim())}const y=N=>{if(N.ctrlKey&&N.code==="KeyS"){N.preventDefault(),_();return}if(N.altKey&&N.code==="Digit4"){addPannel.value=!addPannel.value,N.preventDefault();return}if(N.altKey&&N.code==="Digit6"){splitStatusEditorObj.value.set("hideController"),N.preventDefault();return}if(N.altKey&&N.code==="Digit5"){splitStatusEditorObj.value.set("hideBlade"),N.preventDefault();return}if(N.altKey&&N.code==="Digit3"){const w=splitTreeStatusObj.value.status=="hideTree"?"normal":"hideTree";splitTreeStatusObj.value.set(w),N.preventDefault();return}};function L(){e.value.body=Qt(e.value.body)}const v=D(),R=D("open"),K=D(),X=D("full");return window.addEventListener("keydown",y),{article:e,statusHelp:r,statusAddPannel:o,statusFileManager:a,aceTheme:l,aceThemes:s,hasTwig:n,statusTranslitButton:t,hasTwig:n,statusLeftPannel:c,toggleTreeSplitter:v,modeTreeSplitter:R,toggleEditorSplitter:K,modeEditorSplitter:X,searchTextController:u,searchTextView:p,articleReady:i,loadRec:f,saveRec:_,getController:C,getLiveWareController:O,gotoArticleByName:E,formatDocument:U,translit:g,convertFromMro:L,search:F}}),en={class:"row gx-2 py-2 mx-0",style:{background:"#ffff001f"}},tn={class:"col-auto"},nn=["href"],an={key:1,class:"btn btn-sm btn-secondary fas fa-external-link-alt"},rn={class:"col-3"},ln={class:"input-group input-group-sm"},sn={key:0,class:"col-3"},on={class:"input-group input-group-sm"},cn={class:"col-1"},un={class:"input-group input-group-sm"},dn={class:"col-auto"},fn={key:1,class:"col-auto"},pn={class:"col-auto align-self-center"},hn={class:"col-auto"},mn={class:"col-auto"},gn=["value"],vn={class:"col text-end"},yn={__name:"TopMenu",setup(e){const t=ve(),n=D(""),r=W(()=>t.article.name==="index"?"/":"/"+t.article.name);return(o,a)=>(b(),x("div",en,[d("div",tn,[h(t).article.isRoute?(b(),x("a",{key:0,target:"_blank",class:"fas fa-external-link-alt btn btn-sm btn-primary",href:r.value},null,8,nn)):(b(),x("span",an))]),d("div",rn,[d("div",ln,[oe(d("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":a[0]||(a[0]=l=>h(t).article.name=l)},null,512),[[we,h(t).article.name]]),h(t).statusTranslitButton?I("",!0):(b(),x("button",{key:0,class:"btn btn-sm btn-primary",onClick:a[1]||(a[1]=l=>h(t).translit())},"Translit→"))])]),h(t).statusTranslitButton?(b(),x("div",sn,[d("div",on,[oe(d("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":a[2]||(a[2]=l=>h(t).article.title=l)},null,512),[[we,h(t).article.title]]),d("button",{class:"btn btn-sm btn-primary",onClick:a[3]||(a[3]=l=>h(t).saveRec())},"Save→")])])):I("",!0),d("div",cn,[d("div",un,[oe(d("input",{placeholder:"перейти",type:"text",class:"form-control","onUpdate:modelValue":a[4]||(a[4]=l=>n.value=l)},null,512),[[we,n.value]]),d("button",{class:"btn btn-primary fas fa-angle-right",onClick:a[5]||(a[5]=l=>h(t).gotoArticleByName(n.value))})])]),d("div",dn,[d("span",{class:le(["btn btn-success",{"fas fas fa-sitemap":h(t).modeTreeSplitter=="hidden","fas fa-ellipsis-h":h(t).modeTreeSplitter==="open"}]),onClick:a[6]||(a[6]=l=>h(t).toggleTreeSplitter())},null,2)]),h(t).article.routeParams.useController?(b(),x("div",fn,[d("span",{class:le(["btn btn-success",{"fas fa-angle-left":h(t).modeEditorSplitter==="full","fas fa-angle-right":h(t).modeEditorSplitter==="view","fa fa-columns":h(t).modeEditorSplitter==="controller"}]),onClick:a[7]||(a[7]=l=>h(t).toggleEditorSplitter())},null,2)])):I("",!0),d("div",pn,[d("button",{class:"btn fas fa-magic btn-success",onClick:a[8]||(a[8]=l=>h(t).formatDocument())},"1")]),d("div",hn,[d("button",{onClick:a[9]||(a[9]=l=>h(t).statusHelp=!h(t).statusHelp),class:"fas fa-question btn btn-success"})]),d("div",mn,[oe(d("select",{"onUpdate:modelValue":a[10]||(a[10]=l=>h(t).aceTheme=l),class:"form-select form-select-sm"},[(b(!0),x(ee,null,pe(h(t).aceThemes,l=>(b(),x("option",{key:l,value:l},G(l),9,gn))),128))],512),[[_t,h(t).aceTheme]])]),d("div",vn,[h(t).hasTwig?(b(),x("button",{key:0,class:"btn btn-success fas fa-sync-alt btn-sm me-2",onClick:a[11]||(a[11]=l=>h(t).convertFromMro())})):I("",!0),d("button",{class:"btn btn-success fas fa-folder-open",onClick:a[12]||(a[12]=l=>h(t).statusFileManager=!h(t).statusFileManager)}),d("button",{class:"ms-1 btn btn-success fas fa-bars",onClick:a[13]||(a[13]=l=>h(t).statusAddPannel=!h(t).statusAddPannel)})])]))}},bn={class:""},_n={class:"my-2 d-flex"},wn={class:"nowrap"},kn={class:"d-flex my-2"},$n={class:"nowrap"},xn={class:"my-2 d-flex"},Sn={class:"nowrap"},Cn={key:0},Tn={class:"d-flex my-2"},Dn={class:"nowrap"},En={class:"d-flex my-2"},Pn={class:"nowrap"},On={class:"d-flex my-2"},Ln={class:"nowrap"},An={class:"ms-2"},Fn={key:0},Nn={class:"d-table"},Rn={class:"d-table-cell px-1 py-1 align-middle",style:{"min-width":"300px"}},Bn=["onUpdate:modelValue"],Vn={class:"d-table-cell px-1 py-1"},Un=["onClick"],zn={class:"d-table-cell px-1 py-1"},Mn=["onClick"],In={class:"d-table-cell px-1 py-1"},Kn=["onClick"],Hn={class:"row my-2"},jn={class:"col-9"},Wn={class:"col-1"},Xn={key:1,class:"fas fa-plus"},qn={key:0,class:"d-flex my-2"},Yn={class:"nowrap"},Zn={class:"mt-5"},Gn={class:"my-2"},Jn={class:"my-2"},Qn=["href"],ea={__name:"RouteParam",setup(e){const t=ve(),n=D(""),r=D("");return(o,a)=>{const l=se("ToggleSwitch"),s=se("Drawer");return b(),ce(s,{visible:h(t).statusAddPannel,"onUpdate:visible":a[11]||(a[11]=c=>h(t).statusAddPannel=c),header:"Параметры",position:"right",style:{width:"600px"}},{default:j(()=>[d("div",bn,[d("div",_n,[d("div",wn,[z(l,{modelValue:h(t).article.menuOn,"onUpdate:modelValue":a[0]||(a[0]=c=>h(t).article.menuOn=c)},null,8,["modelValue"])]),a[12]||(a[12]=d("div",{class:"ms-2"},"menu",-1))]),d("div",kn,[d("div",$n,[z(l,{modelValue:h(t).article.routeParams.useController,"onUpdate:modelValue":a[1]||(a[1]=c=>h(t).article.routeParams.useController=c)},null,8,["modelValue"])]),a[13]||(a[13]=d("div",{class:"ms-2"},[re(" Испольовать контроллер "),d("div",{class:"small"},"Если нет, то будет вызываться просто вьюха")],-1))]),d("div",xn,[d("div",Sn,[z(l,{modelValue:h(t).article.isRoute,"onUpdate:modelValue":a[2]||(a[2]=c=>h(t).article.isRoute=c)},null,8,["modelValue"])]),a[14]||(a[14]=d("div",{class:"ms-2"},"route",-1))]),h(t).article.isRoute?(b(),x("div",Cn,[d("div",Tn,[d("div",Dn,[z(l,{modelValue:h(t).article.routeParams.adminOnly,"onUpdate:modelValue":a[3]||(a[3]=c=>h(t).article.routeParams.adminOnly=c)},null,8,["modelValue"])]),a[15]||(a[15]=d("div",{class:"ms-2"},"Только Админ (для отладки)",-1))]),d("div",En,[d("div",Pn,[z(l,{modelValue:h(t).article.routeParams.utmParamsEnable,"onUpdate:modelValue":a[4]||(a[4]=c=>h(t).article.routeParams.utmParamsEnable=c)},null,8,["modelValue"])]),a[16]||(a[16]=d("div",{class:"ms-2"},"Разрешить Utm ?=utm...",-1))]),d("div",On,[d("div",Ln,[z(l,{modelValue:h(t).article.routeParams.getEnable,"onUpdate:modelValue":a[5]||(a[5]=c=>h(t).article.routeParams.getEnable=c)},null,8,["modelValue"])]),d("div",An,[a[20]||(a[20]=d("div",null,"Использовать GET параметры",-1)),h(t).article.routeParams.getEnable?(b(),x("div",Fn,[a[18]||(a[18]=d("div",{class:"mt-2"},"Допустимые параметры",-1)),a[19]||(a[19]=d("div",{class:"small"},"Если пусто то все",-1)),d("div",Nn,[(b(!0),x(ee,null,pe(h(t).article.routeParams.keysArr,(c,i)=>(b(),x("div",{class:"d-table-row",key:i},[d("div",Rn,[oe(d("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":u=>h(t).article.routeParams.keysArr[i]=u},null,8,Bn),[[we,h(t).article.routeParams.keysArr[i]]])]),d("div",Vn,[oe(d("i",{class:"fas fa-arrow-circle-down",onClick:u=>{h(t).article.routeParams.swap=h(t).article.routeParams.keysArr[i+1],h(t).article.routeParams.keysArr[i+1]=h(t).article.routeParams.keysArr[i],h(t).article.routeParams.keysArr[i]=h(t).article.routeParams.swap,delete h(t).article.routeParams.swap}},null,8,Un),[[Ne,h(t).article.routeParams.keysArr.length-1>i&&h(t).article.routeParams.bindKeys]])]),d("div",zn,[i>0&&h(t).article.routeParams.bindKeys?(b(),x("i",{key:0,class:"fas fa-arrow-circle-up",onClick:u=>{r.value=h(t).article.routeParams.keysArr[i-1],h(t).article.routeParams.keysArr[i-1]=h(t).article.routeParams.keysArr[i],h(t).article.routeParams.keysArr[i]=r.value}},null,8,Mn)):I("",!0)]),d("div",In,[d("i",{class:"fas fa-trash",onClick:u=>h(t).article.routeParams.keysArr.splice(i,1)},null,8,Kn)])]))),128))]),d("div",Hn,[d("div",jn,[oe(d("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":a[6]||(a[6]=c=>n.value=c)},null,512),[[we,n.value]])]),d("div",Wn,[n.value.trim()!=""?(b(),x("span",{key:0,class:"fas fa-plus",onClick:a[7]||(a[7]=c=>{h(t).article.routeParams.keysArr.push(n.value),n.value=""})})):(b(),x("span",Xn))])]),h(t).article.routeParams.keysArr.length>0?(b(),x("div",qn,[d("div",Yn,[z(l,{modelValue:h(t).article.routeParams.bindKeys,"onUpdate:modelValue":a[8]||(a[8]=c=>h(t).article.routeParams.bindKeys=c)},null,8,["modelValue"])]),a[17]||(a[17]=d("div",{class:"ms-2"},[d("div",null,"Привязывать параметры"),d("div",{class:"small"},"Только для параметорв в / /")],-1))])):I("",!0)])):I("",!0)])])])):I("",!0),d("div",Zn,[d("button",{class:"btn btn-success btn-sm",onClick:a[9]||(a[9]=c=>h(t).getController())},"Обычный контроллер")]),d("div",Gn,[d("button",{class:"btn btn-success btn-sm",onClick:a[10]||(a[10]=c=>h(t).getLiveWareController())},"LiveWare контроллер")]),d("div",Jn,[d("a",{href:"http://mpro2.test/a_dmin/api/exportArticle?id="+h(t).article.id,class:"btn btn-success btn-sm"}," Экспорт ",8,Qn)])]),d("pre",null,"        "+G(h(t).article)+`
    `,1)]),_:1},8,["visible"])}}},ta={__name:"Help",setup(e){const t=ve();return(n,r)=>{const o=se("Dialog");return b(),ce(o,{visible:h(t).statusHelp,"onUpdate:visible":r[0]||(r[0]=a=>h(t).statusHelp=a),header:"Справка",modal:"",class:"w-50"},{default:j(()=>[...r[1]||(r[1]=[d("ul",{class:"list-unstyled m-0"},[d("li",null,[d("kbd",null,"Ctrl+S"),re(" — сохранить")]),d("li",null,[d("kbd",null,"Shift_"),re(" — снипеты блейда")]),d("li",null,[d("kbd",null,"Alt+1"),re(" — перейти в статье по выбранному слову")]),d("li",null,[d("kbd",null,"Alt+3"),re(" — панель дерева")]),d("li",null,[d("kbd",null,"Alt+4"),re(" — боковое меню")]),d("li",null,[d("kbd",null,"Alt+5"),re(" — панель контроллера")]),d("li",null,[d("kbd",null,"Alt+6"),re(" — скрыть/отобразить панель блейда")])],-1)])]),_:1},8,["visible"])}}};function na(){const e=ft.require("ace/mode/html_highlight_rules").HtmlHighlightRules;if(e.__bladePatched)return;const t=[{token:"comment",regex:/\{\{\-\-[\s\S]*?\-\-\}\}/},{token:"variable",regex:/\{\{[\s\S]*?\}\}/},{token:"entity.name.function",regex:/@[A-Za-z_]\w*/}],n=e.prototype.getRules;e.prototype.getRules=function(){const r=n.call(this);for(const o in r)r[o].unshift(...t);return r},e.__bladePatched=!0}function aa(e){const t=[{tabTrigger:"",name:"_@auth",content:`@auth
	$0
@endauth`},{tabTrigger:"",name:"_@can",content:`@can(\${1:ability})
	$0
@endcan`},{tabTrigger:"",name:"_@cannot",content:`@cannot(\${1:ability})
	$0
@endcannot`},{tabTrigger:"",name:"_@csrf",content:"@csrf"},{tabTrigger:"",name:"_@dd",content:"@dd(${1:var})"},{tabTrigger:"",name:"_@dump",content:"@dump(${1:var})"},{tabTrigger:"",name:"_@else",content:`@else
	$0`},{tabTrigger:"",name:"_@elseif",content:"@elseif ($${1:user}->${2:active})"},{tabTrigger:"",name:"_@empty",content:`@empty ($\${1:arr})
	$0
@endempty`},{tabTrigger:"",name:"_@endauth",content:"@endauth"},{tabTrigger:"",name:"_@endcan",content:"@endcan"},{tabTrigger:"",name:"_@endcannot",content:"@endcannot"},{tabTrigger:"",name:"_@endempty",content:"@endempty"},{tabTrigger:"",name:"_@endforeach",content:"@endforeach"},{tabTrigger:"",name:"_@endif",content:"@endif"},{tabTrigger:"",name:"_@endfor",content:"@endfor"},{tabTrigger:"",name:"_@endguest",content:"@endguest"},{tabTrigger:"",name:"_@endisset",content:"@endisset"},{tabTrigger:"",name:"_@endonce",content:"@endonce"},{tabTrigger:"",name:"_@endprepend",content:"@endprepend"},{tabTrigger:"",name:"_@endphp",content:"@endphp"},{tabTrigger:"",name:"_@endpush",content:"@endpush"},{tabTrigger:"",name:"_@endsection",content:"@endsection"},{tabTrigger:"",name:"_@endswitch",content:"@endswitch"},{tabTrigger:"",name:"_@endwhile",content:"@endwhile"},{tabTrigger:"",name:"_@env",content:`@env(\${1:environment})
	$0
@endenv`},{tabTrigger:"",name:"_@error",content:`@error('\${1:field}')
	<div class="text-danger">{{ $message }}</div>
@enderror`},{tabTrigger:"",name:"_@extends",content:"@extends('${1:layout}')"},{tabTrigger:"",name:"_@for",content:"@for ($${1:i} = 0; $${1:i} < ${2:10}; $${1:i}++)\n	$0\n@endfor"},{tabTrigger:"",name:"_@foreach",content:"@foreach ($${1:items} as $${2:item})\n	$0\n@endforeach"},{tabTrigger:"",name:"_@foreach index",content:"@foreach ($${1:items} as $${2:ndex} => $${3:item})\n	$0\n@endforeach"},{tabTrigger:"",name:"_@guest",content:`@guest
	$0
@endguest`},{tabTrigger:"",name:"_@if",content:`@if ($\${1:var} > 0)
	$0
@endif`},{tabTrigger:"",name:"_@include",content:"@include('magic::${1:view}', [${2:data}])"},{tabTrigger:"",name:"_@includeFirst",content:"@includeFirst(['magic::${1:view1}', 'magic::${2:view2}'])"},{tabTrigger:"",name:"_@includeIf",content:"@includeIf('magic::${1:view}', [${2:data}])"},{tabTrigger:"",name:"_@includeWhen",content:"@includeWhen(${1:condition}, 'magic::${2:view}', [${3:data}])"},{tabTrigger:"",name:"_@includeUnless",content:"@includeUnless(${1:condition}, 'magic::${2:view}', [${3:data}])"},{tabTrigger:"",name:"_@isset",content:`@isset ($\${1:var})
	$0
@endisset`},{tabTrigger:"",name:"_@json",content:"@json(${1:data})"},{tabTrigger:"",name:"_@method",content:"@method('${1:PUT}')"},{tabTrigger:"",name:"_@once",content:`@once
	$0
@endonce`},{tabTrigger:"",name:"_@php",content:`@php
	$0
@endphp`},{tabTrigger:"",name:"_@prepend",content:`@prepend('\${1:stack}')
	$0
@endprepend`},{tabTrigger:"",name:"_@production",content:`@production
	$0
@endproduction`},{tabTrigger:"",name:"_@props",content:"@props(['${1:variable}' => ${2:default}])"},{tabTrigger:"",name:"_@push",content:`@push('\${1:stack}')
	$0
@endpush`},{tabTrigger:"",name:"_@section (block)",content:`@section('\${1:name}')
	$0
@endsection`},{tabTrigger:"",name:"_@section (inline)",content:"@section('${1:name}', '${2:content}')"},{tabTrigger:"",name:"_@stack",content:"@stack('${1:stack}')"},{tabTrigger:"",name:"_@switch",content:`@switch ($\${1:value})
	@case($\${2:key})
		$0
	@break
@endswitch`},{tabTrigger:"",name:"_@unless",content:`@unless ($\${1:cond})
	$0
@endunless`},{tabTrigger:"",name:"_@verbatim",content:`@verbatim
	$0
@endverbatim`},{tabTrigger:"",name:"_@while",content:`@while ($\${1:flag})
	$0
@endwhile`},{tabTrigger:"",name:"_@yield",content:"@yield('${1:section}')"},{tabTrigger:"",name:"_<x-magic",content:'<x-magic::${1:anonymus} :data="$${1:value}"></x-magic::${1:anonymus}>)'}],n=t.map(c=>c.tabTrigger.replace("@",""));ace.require("ace/snippets").snippetManager.register(t,"html");const o=ace.require("ace/autocomplete").Autocomplete,a=o.prototype.showPopup,l=o.prototype.updateCompletions;function s(c){c&&Array.isArray(c.data)&&(c.data=c.data.filter(i=>!n.includes(i.value)),c.setData(c.data))}o.prototype.showPopup=function(c){a.call(this,c),s(this.popup)},o.prototype.updateCompletions=function(c){l.call(this,c),s(this.popup)},e.commands.addCommand({name:"toggleLineMarkersCommand",bindKey:{win:"Alt-/",mac:"Alt-/"},exec:sa,readOnly:!1})}function ra(e){let t,n;if(e.getSelectionRange().isEmpty()){const r=e.getCursorPosition();e.selection.selectLine(r.row),t=n=r.row}else{const r=e.getSelectionRange(),o=ace.require("ace/range").Range;t=r.start.row,n=r.end.row;const a=new o(t,0,n,e.session.getLine(n).length);e.selection.setRange(a)}return{startRow:t,endRow:n}}function la(e){return/{{--.*--}}/.test(e)?(e=e.replace(/^\s*{{--\s?/,""),e=e.replace(/\s?--}}\s*$/,""),e):`{{-- ${e} --}}`}function sa(e){const{startRow:t,endRow:n}=ra(e),r=e.session,o=ace.require("ace/range").Range;for(let a=t;a<=n;a++){const l=r.getLine(a),s=la(l),c=l.length;r.replace(new o(a,0,a,c),s)}}const oa=["id"],et={__name:"AceEditor",props:wt({lang:{type:String,default:"html",validator:e=>["html","php","blade"].includes(e)},theme:{type:String,default:"monokai"},readOnly:{type:Boolean,default:!1},tabSize:{type:Number,default:4},wrap:{type:Boolean,default:!1},height:{type:Number,default:100}},{modelValue:{type:String,default:"XXXXXXXX"},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=ve(),n=D(kt()),r=e,o=ut(e,"modelValue"),a=D(null);let l=null;const s=()=>r.lang==="php"?"ace/mode/php":"ace/mode/html",c=i=>`ace/theme/${i}`;return xe(()=>{na(),l=ft.edit(n.value,{value:o.value,mode:s(r.lang),theme:c(r.theme),readOnly:r.readOnly,wrap:r.wrap,tabSize:r.tabSize,useWorker:!1}),l.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableEmmet:!0}),l.setFontSize(14),l.commands.addCommand({name:"sendSelectedToParent",bindKey:{win:"Alt-1",mac:"Alt-1"},exec(i){const u=i.session.getTextRange(i.getSelectionRange());if(u.trim()===""){document.showToast("Статья не выделена");return}t.gotoArticleByName(u)}}),r.lang!=="php"&&aa(l),l.session.on("change",()=>{o.value=l.getValue()}),r.lang==="php"&&Z(()=>t.searchTextController,i=>{i.trim()&&(l.find(i),l.execCommand("find"),t.searchTextController="")}),r.lang==="html"&&Z(()=>t.searchTextView,i=>{i.trim()&&(l.find(t.searchTextView),l.execCommand("find"),t.searchTextView="")})}),Z(o,i=>{if(!l)return;const u=l.getValue();i!==u&&l.setValue(i)}),$t(()=>l?.destroy()),Z(()=>r.lang,i=>l?.session.setMode(s())),Z(()=>r.theme,i=>l?.setTheme(c(i))),Z(()=>r.readOnly,i=>l?.setReadOnly(i)),Z(()=>r.tabSize,i=>l?.session.setTabSize(i)),Z(()=>r.wrap,i=>l?.session.setUseWrapMode(i)),(i,u)=>(b(),x("div",{style:te("height: "+e.height+"px; width: 100%; position: relative;")},[d("div",{ref_key:"el",ref:a,id:n.value,style:{width:"100%",height:"100%"}},null,8,oa)],4))}};var ia=!1,ca=!0;function Re(e){return Object.prototype.toString.call(e)==="[object Array]"}function tt(e){return Object.prototype.toString.call(e)==="[object Object]"}function ua(e){return typeof e=="function"}function da(e,t){return e<t?e:t}function ht(e,t){let n,r=0;for(;(n=e.indexOf(t))>-1;)e.splice(n,1),r++;return r}function mt(e){return e[e.length-1]}function fa(e){return Re(e)?e:[e]}function pa(e,t){let n=new Set(t);const r={};return n.forEach(o=>{r[o]=e[o]}),r}function ha(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){if(t.reverse)if(e.length!=null)for(let n=e.length-1;n>=0;n--){const r={value:e[n],index:n};(!t.exclude||!t.exclude(r))&&(yield r)}else if(tt(e)){const n=Object.keys(e);n.reverse();for(const r of n){const o={value:e[r],key:r};(!t.exclude||!t.exclude(o))&&(yield o)}}else throw"Unsupported type";else if(e.length!=null)for(let n=0;n<e.length;n++){const r={value:e[n],index:n};(!t.exclude||!t.exclude(r))&&(yield r)}else if(tt(e))for(const n of Object.keys(e)){const r={value:e[n],key:n};(!t.exclude||!t.exclude(r))&&(yield r)}else throw"Unsupported type"})()}function ma(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}function gt(e,t){return Object.keys(t).forEach(n=>{ma(e,n,t[n])}),e}function ga(e){const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t}function ue(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n=gt({...n},{childrenKey:"children"});const{childrenKey:r}=n,o=Re(e)?e:[e];class a{}const l=(s,c,i)=>{n.reverse&&(s=s.slice(),s.reverse());const u=s.length;for(let p=0;p<u;p++){const f=s[p],m=n.reverse?u-p-1:p,_=i?[...i,m]:[];n.childFirst&&f[r]!=null&&l(f[r],f,_);const C=t(f,m,c,_);if(C===!1)throw new a;if(C==="skip children")continue;if(C==="skip siblings")break;n.childFirst||f[r]!=null&&l(f[r],f,_)}};try{l(o,null,Re(e)?[]:null)}catch(s){if(!(s instanceof a))throw s}}function va(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r;return ue(e,function(){if(t(...arguments))return r={node:arguments.length<=0?void 0:arguments[0],index:arguments.length<=1?void 0:arguments[1],parent:arguments.length<=2?void 0:arguments[2],path:arguments.length<=3?void 0:arguments[3]},!1},n),r}function ya(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return va(e,t,n)?.node}function vt(e,t){const n={childrenKey:"children"};t&&Object.assign(n,t);const{childrenKey:r,nodeHandler:o}=n,a=new Ze;return a.childrenKey=r,ue(e,(l,s,c,i)=>{let u=Object.assign({},l);u[r]&&(u[r]=[]),o&&(u=o(u,{oldNode:l,index:s,parent:c,path:i})),a.set(i,u)},{childrenKey:r}),a.data}class Ze{data;childrenKey="children";constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.data=t}get rootChildren(){const{childrenKey:t}=this,{data:n}=this;return Re(n)?n:n[t]}iteratePath(t){var n=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const{childrenKey:o,rootChildren:a}=n;if(r.reverse){const l=[...n.iteratePath(t,{...r,reverse:!1})];l.reverse();for(const{path:s,node:c}of l)yield{path:s,node:c}}else{let l=[],s=a;for(const c of t){const i=[...l,c],u=s[c];yield{path:i,node:u},l=i,s=u[o]}}})()}getFamily(t){const n=[];for(const{node:r}of this.iteratePath(t))n.push(r);return n}get(t){return mt(this.getFamily(t))}getParentAndIndex(t){const n=t.slice(),r=n.pop();return{parent:this.get(n),index:r,parentPath:n}}getParent(t){return this.getParentAndIndex(t).parent}set(t,n){if(t==null||t.length===0)this.data=n;else{const{childrenKey:r}=this;let{rootChildren:o}=this;const{parent:a,index:l}=this.getParentAndIndex(t);let s;t.length===1?(o||(this.data?this.data[r]=[]:this.data=[]),s=o):(a[r]||(a[r]=[]),s=a[r]),s[l]=n}}delete(t){const{childrenKey:n,rootChildren:r}=this,{parent:o,index:a}=this.getParentAndIndex(t),l=t.length===1?r:o[n],s=l[a];return l.splice(a,1),s}walk(t,n){const{childrenKey:r,data:o}=this;return ue(o,t,r,n)}clone(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return vt(this.data),ga({childrenKey:this.childrenKey,nodeHandler:t.nodeHandler||void 0})}}function nt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ua(e)?e(...t):e}function ba(e,t){return function(){let r,o;try{r=e(...arguments)}catch(a){o=a}finally{}if(o)throw o;return r}}function Te(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[];let r;const o={};let a=o;return{action:function(){for(var c=arguments.length,i=new Array(c),u=0;u<c;u++)i[u]=arguments[u];if(i.length===0)return a===o&&(a=e()),a;if(r||(r=new $a),!r.has(i)&&(r.set(i,e(...i)),t.capacity!=null)){n.push(i);const p=n.splice(0,n.length-t.capacity);for(const f of p)r.delete(f)}return r.get(i)},clearCache:()=>{r=null,n.splice(0,n.length)}}}function _a(){let e,t;return{promise:new Promise((r,o)=>{e=r,t=o}),resolve:e,reject:t}}function wa(e,t){for(;;){if(e.parentNode==null)return!1;if(e.parentNode===t)return!0;e=e.parentNode}}function Ie(e){let t=e.getBoundingClientRect();if(document.documentElement.clientTop>0){const n=t.top-document.documentElement.clientTop,r=t.bottom,o=t.left-document.documentElement.clientLeft,a=t.right,l=t.width||a-o,s=t.height||r-n,u={top:n,right:a,bottom:r,left:o,width:l,height:s,x:o,y:n};t={...u,toJSON:()=>u}}return t}function at(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n&&n.withSelf?e:e.parentElement;for(;r;){const o=n.until&&r===n.until;if(o&&!n.withUntil)return;const a=t(r);if(a==="break")return;if(a)return r;if(o)return;r=r.parentElement}}function Be(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function rt(e,t){for(const n of t)if(Be(e,n))return!0;return!1}function de(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent(`on${t}`,n,r)}function fe(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent(`on${t}`,n,r)}function ka(e){let t=[];const n=()=>{if(!o.listening){for(const a of e){de.apply(this,a);const l=()=>fe.apply(this,a);t.push(l)}o.listening=!0}},o={listening:!1,stop:()=>{if(o.listening){for(const a of t)a();t=[],o.listening=!1}},resume:n,start:n};return o.start(),o}function Ve(e,t){return getComputedStyle(e)[t]}function Ge(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n={start:0,end:e.length-1,maxTimes:1e3,...n};let{start:r,end:o}=n;const{returnNearestIfNoHit:a,maxTimes:l}=n;let s,c;r==null&&(r=0,o=e.length-1);let i=0,u;for(;r>=0&&r<=o;){if(i>=l)throw Error(`binarySearch: loop times is over ${l}, you can increase the limit.`);s=Math.floor((o-r)/2+r),c=e[s];const p=i+1;if(u=t(c,s,p),u>0)o=s-1;else if(u<0)r=s+1;else return{index:s,value:c,count:p,hit:!0};i++}return a?{index:s,value:c,count:i+1,hit:!1,greater:u>0}:null}class $a{_map=new Map;_values={};_objCount=0;_keysToString(t){const{_map:n}=this;let r=[];for(const o of t){if(!n.has(o))return null;r.push(n.get(o)[0])}return r.toString()}has(t){return this._keysToString(t)!=null}get(t){const{_values:n}=this,r=this._keysToString(t);if(r==null)throw"Value not found by specified keys";return n[r][1]}set(t,n){const{_map:r,_values:o}=this;let a=[];for(const l of t){let s,c=1;r.has(l)?([s,c]=r.get(l),c++):(this._objCount++,s=this._objCount.toString()),r.set(l,[s,c]),a.push(s)}o[a.toString()]=[t.slice(),n]}delete(t){const{_values:n,_map:r}=this,o=this._keysToString(t);if(o==null)throw"Value not found by specified keys";delete n[o];for(const a of t){let[l,s]=r.get(a);s--,s===0?r.delete(a):r.set(a,[l,s])}}clear(){this._map.clear(),this._values={}}*entries(){const{_values:t}=this;for(const n in t){const[r,o]=t[n];yield[r,o]}}count(){return[...this.entries()].length}}const xa=Se({props:{table:Boolean}}),yt=(e,t)=>{const n=e.__vccOpts||e;for(const[r,o]of t)n[r]=o;return n},Sa={key:0},Ca={key:1};function Ta(e,t,n,r,o,a){return e.table?(b(),x("table",Sa,[q(e.$slots,"prepend"),d("tbody",null,[q(e.$slots,"default")]),q(e.$slots,"append")])):(b(),x("div",Ca,[q(e.$slots,"prepend"),q(e.$slots,"default"),q(e.$slots,"append")]))}const Da=yt(xa,[["render",Ta]]),Ea=Se({components:{VirtualListTable:Da},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const t=D(0),n=D(e.firstRender-1),r=W(()=>{var w;return da(n.value,(((w=e.items)==null?void 0:w.length)||1)-1)}),o=D(0),a=W(()=>f.value[t.value]?K(t.value):0),l=W(()=>f.value.length>0?K(f.value.length-1)+mt(p.value):0),s=W(()=>f.value[r.value]?l.value-K(r.value)-p.value[r.value]:0),c=W(()=>e.disabled?{}:{overflow:"auto"}),i=W(()=>{const w={display:"flex"};return e.disabled||(e.horizontal?Object.assign(w,{"margin-left":a.value+"px","margin-right":s.value+"px",width:l.value-s.value-a.value+"px"}):Object.assign(w,{"margin-top":a.value+"px","margin-bottom":s.value+"px"})),w["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete w.display,delete w["flex-direction"]),w}),u=W(()=>ke((e.items||[]).map(()=>null))),p=W(()=>(e.items||[]).map((w,S)=>{var $;if(u[S]!=null)return u[S];let H=($=e.itemSize)==null?void 0:$.call(e,w,S);return H==null&&(H=o.value),H})),f=W(()=>{const w=[];return p.value.reduce((S,$)=>(w.push(S),S+$),0),w});Z(()=>e.items,g);const m=W(()=>{if(!e.items||e.disabled)return;const w=[];for(let S=t.value;S<=r.value;S++){const $=e.items[S];if(!$)break;w.push({item:$,index:S})}return w}),_=D(),C=D();xe(async()=>{g();try{X()}catch{await Me(),g()}});let E;function O(){const w=_.value;if(!w)return;const S=v(w);E!=null&&e.buffer-Math.abs(S-E)>=10||(E=S,g())}let F=!1,U=!1;async function g(){var w;if(F){U=!0;return}if(!e.items||e.disabled)return;F=!0;const S=_.value,$=(w=C.value)==null?void 0:w.$el;if(!S||!$)return;o.value||(o.value=M()),t.value=ie(),n.value=ge(),await Me();let H,Y=0;const T={},P=e.table?$.querySelector("tbody").children:$.children;for(let B=0;B<P.length;B++){const V=P[B],J=Ve(V,"position");if(J&&["absolute","fixed"].includes(J))continue;const he=Ve(V,"display")!=="none"?L(V):0,ye=V.getAttribute("vt-index"),Oe=ye?parseInt(ye):t.value+Y;T[Oe]=(T[Oe]||0)+he,Y++}for(const B of Object.keys(T)){const V=parseInt(B);u.value[V]!==T[V]&&(u.value[V]=T[V],H=!0)}H&&await Me(),F=!1,U&&(U=!1,g());function ie(){const B=v(S)-R(S)-e.buffer;return Ge(f.value,V=>V-B,{returnNearestIfNoHit:!0}).index}function ge(){const B=v(S)-R(S)+y(S)+e.buffer;return Ge(f.value,V=>V-B,{returnNearestIfNoHit:!0}).index}function M(){const B=[],V=e.table?$.querySelector("tbody").children:$.children;for(let J=0;J<V.length;J++){const he=V[J],ye=getComputedStyle(he);if(["absolute","fixed"].includes(ye.position))continue;const Oe=L(he);if(B.push(Oe),B.length>=10)break}return B.length===0?0:B.reduce((J,he)=>J+he,0)/B.length}}function y(w){const S=getComputedStyle(w);let $=parseFloat(e.horizontal?S.width:S.height);return S.boxSizing==="border-box"&&(e.horizontal?$=$-parseFloat(S.borderLeftWidth)-parseFloat(S.borderRightWidth):$=$-parseFloat(S.borderTopWidth)-parseFloat(S.borderBottomWidth)),$}function L(w){let S=y(w);const $=getComputedStyle(w);return e.horizontal?S+=parseFloat($.borderLeftWidth)+parseFloat($.borderRightWidth)+parseFloat($.marginLeft)+parseFloat($.marginRight):S+=parseFloat($.borderTopWidth)+parseFloat($.borderBottomWidth)+parseFloat($.marginTop)+parseFloat($.marginBottom),S=Number.isNaN(S)?0:S,S}function v(w){return e.horizontal?w.scrollLeft:w.scrollTop}function R(w){const S=getComputedStyle(w);return e.horizontal?parseFloat(S.paddingLeft):parseFloat(S.paddingTop)}function K(w){return f.value[w]}function X(){const w=_.value;new ResizeObserver(S=>{for(let $ of S)if(Be($.target,"vtlist")){g();break}}).observe(w)}function N(w,S){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return S;if(typeof e.itemKey=="function")return e.itemKey(w,S)}}return{listElRef:_,listInnerRef:C,onscroll:O,listStyle:c,listInnerStyle:i,visibleItemsInfo:m,getItemKey:N,update:g,sizes:p,positions:f,runtimeSizes:u}}});function Pa(e,t,n,r,o,a){const l=se("VirtualListTable");return b(),x("div",{class:"vtlist",ref:"listElRef",style:te(e.listStyle),onScrollPassive:t[0]||(t[0]=(...s)=>e.onscroll&&e.onscroll(...s))},[z(l,{class:"vtlist-inner",ref:"listInnerRef",style:te(e.listInnerStyle),table:e.table},{prepend:j(()=>[q(e.$slots,"prepend")]),append:j(()=>[q(e.$slots,"append")]),default:j(()=>[e.disabled?(b(!0),x(ee,{key:0},pe(e.items,(s,c)=>q(e.$slots,"default",{key:e.getItemKey(s,c),item:s,index:c})),128)):(b(!0),x(ee,{key:1},pe(e.visibleItemsInfo,({item:s,index:c})=>q(e.$slots,"default",{key:e.getItemKey(s,c),item:s,index:c})),128))]),_:3},8,["style","table"])],36)}const Oa=yt(Ea,[["render",Pa]]);const _e="children";function La(e){const n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={...Aa,...n,data:e,stats:null,statsFlat:null,_statsMap:null,initialized:!1,init(){const{data:a,childrenKey:l}=this,s=new Ze([]);this._statsMap=new Map,ue(a,(i,u,p,f)=>{const m=this.statHandler({...lt(),data:i,open:!!this.defaultOpen,parent:s.getParent(f),children:[],level:f.length});this._statsMap.set(i,m),s.set(f,m)},{childrenKey:l});const c=[];s.walk(i=>{c.push(i)}),this.stats=this.statsHandler(s.rootChildren),this.statsFlat=this.statsFlatHandler(c),this.initialized=!0},getStat(a){let l=this._statsMap.get(a);if(!l)throw new st("Stat not found");return l},has(a){if(a.isStat)return this.statsFlat.indexOf(a)>-1;try{return!!this.getStat(a)}catch(l){if(l instanceof st)return!1;throw l}},_getPathByStat(a){if(a==null)return[];const s=this.getSiblings(a).indexOf(a);return[...a.parent?this._getPathByStat(a.parent):[],s]},afterOneCheckChanged(a){const{checked:l}=a;if(a._ignoreCheckedOnce)return delete a._ignoreCheckedOnce,!1;const s=c=>{const{parent:i}=c;if(i){let u,p,f;for(const _ of i.children)_.checked?u=!0:_.checked===0?f=!0:p=!0;const m=f?0:p?u?0:!1:!0;i.checked!==m&&(this._ignoreCheckedOnce(i),i.checked=m),s(i)}};return s(a),ue(a.children,c=>{c.checked!==l&&(this._ignoreCheckedOnce(c),c.checked=l)},{childrenKey:_e}),!0},_ignoreCheckedOnce(a){a._ignoreCheckedOnce=!0,setTimeout(()=>{a._ignoreCheckedOnce&&(a._ignoreCheckedOnce=!1)},100)},isVisible(a){const l=a.isStat?a:this.getStat(a),s=c=>!c||!c.hidden&&c.open&&s(c.parent);return!!(!l.hidden&&s(l.parent))},updateCheck(){ue(this.stats,a=>{if(a.children&&a.children.length>0){const l=a.children.every(i=>i.checked===!0),s=a.children.every(i=>i.checked===!1),c=l?!0:s?!1:0;a.checked!==c&&(this._ignoreCheckedOnce(a),a.checked=c)}},{childFirst:!0,childrenKey:_e})},getChecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.statsFlat.filter(l=>l.checked||a&&l.checked===0)},getUnchecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.statsFlat.filter(l=>a?!l.checked:l.checked===!1)},openAll(){for(const a of this.statsFlat)a.open=!0},closeAll(){for(const a of this.statsFlat)a.open=!1},openNodeAndParents(a){const l=a.isStat?a:this.getStat(a);for(const s of this.iterateParent(l,{withSelf:!0}))s.open=!0},_calcFlatIndex(a,l){let s=a?this.statsFlat.indexOf(a)+1:0;const c=a?a.children:this.stats;for(let i=0;i<l;i++)s+=this._count(c[i]);return s},add(a,l,s){if(this.has(a))throw"Can't add because data exists in tree";const c=l?l.children:this.stats;s==null&&(s=c.length);const i=this.statHandler({...lt(),open:!!this.defaultOpen,data:a,parent:l||null,children:[],level:l?l.level+1:1});this._setPosition(i,l||null,s);const u=a[this.childrenKey];if(u){const p=u.slice();for(const f of p)this.add(f,i)}},remove(a){const l=this.getSiblings(a);if(l.includes(a)){ht(l,a);const s=this._flat(a);this.statsFlat.splice(this.statsFlat.indexOf(a),s.length);for(const c of s)this._statsMap.delete(c.data);return this.afterRemoveStat(a),!0}return!1},getSiblings(a){const{parent:l}=a;return l?l.children:this.stats},_setPosition(a,l,s){(l?l.children:this.stats).splice(s,0,a),a.parent=l,a.level=l?l.level+1:1;const i=this._calcFlatIndex(l,s),u=this._flat(a);this.statsFlat.splice(i,0,...u);for(const p of u)this._statsMap.has(p.data)||this._statsMap.set(p.data,p);ue(a,(p,f,m)=>{m&&(p.level=m.level+1)},{childrenKey:_e}),this.afterSetStat(a,l,s)},*iterateParent(a,l){let s=l!=null&&l.withSelf?a:a.parent;for(;s;)yield s,s=s.parent},move(a,l,s){if(this.has(a)){if(a.parent===l&&this.getSiblings(a).indexOf(a)===s)return!1;if(a===l)throw new Error("Can't move node to it self");if(l&&a.level<l.level){let c;for(const i of this.iterateParent(l))if(i.level===a.level){c=i;break}if(a===c)throw new Error("Can't move node to its descendant")}this.remove(a)}return this._setPosition(a,l,s),!0},_flat(a){const l=[];return ue(a,s=>{l.push(s)},{childrenKey:_e}),l},_count(a){return this._flat(a).length},getData(a,l){const{childrenKey:s}=this,c=new Ze([]);return c.childrenKey=s,ue(l||this.stats,(i,u,p,f)=>{let m={...i.data,[s]:[]};a&&(m=a(m)),c.set(f,m)},{childrenKey:_e}),c.data}},o=r;return r.noInitialization||o.init(),o}const Aa={childrenKey:"children",defaultOpen:!1,statsHandler(e){return e},statsFlatHandler(e){return e},afterSetStat(e,t,n){},afterRemoveStat(e){},statHandler(e){return e}};function lt(){return{isStat:!0,hidden:!1,checked:!1,style:null,class:null,draggable:null,droppable:null}}class st extends Error{constructor(t){super(t),this.name="StatNotFoundError"}}const Ae={start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","touchend"]},Ke={isTouch(e){return e.type&&e.type.startsWith("touch")},_getStore(e){return e._wrapperStore||(e._wrapperStore=[]),e._wrapperStore},on(e,t,n,r){const{args:o,mouseArgs:a,touchArgs:l}=ot(r),s=this._getStore(e),c=this,i=function(u){let p;if(c.isTouch(u))p={x:u.changedTouches[0].pageX,y:u.changedTouches[0].pageY,pageX:u.changedTouches[0].pageX,pageY:u.changedTouches[0].pageY,clientX:u.changedTouches[0].clientX,clientY:u.changedTouches[0].clientY,screenX:u.changedTouches[0].screenX,screenY:u.changedTouches[0].screenY};else if(p={x:u.pageX,y:u.pageY,pageX:u.pageX,pageY:u.pageY,clientX:u.clientX,clientY:u.clientY,screenX:u.screenX,screenY:u.screenY},t==="start"&&u.which!==1)return;return n.call(this,u,p)};s.push({handler:n,wrapper:i}),de.call(null,e,Ae[t][0],i,...o,...a),de.call(null,e,Ae[t][1],i,...o,...l)},off(e,t,n,r){const{args:o,mouseArgs:a}=ot(r),l=this._getStore(e);for(let s=l.length-1;s>=0;s--){const{handler:c,wrapper:i}=l[s];n===c&&(fe.call(null,e,Ae[t][0],i,...o,...a),fe.call(null,e,Ae[t][1],i,...o,...a),l.splice(s,1))}}};function ot(e){e||(e={});const t=e.args||[],n=e.mouseArgs||[],r=e.touchArgs||[];return{args:t,mouseArgs:n,touchArgs:r}}const He=new Map,me={triggerElement:null,dragElement:null,internal:!1,dropEffect:"none",preventDefault:!1},ae=me;function De(e){e.dataTransfer&&(e.dataTransfer.dropEffect=ae.dropEffect)}function Fa(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(He.has(e))throw"Already registered on specified element";const n={...t},r=n;gt(n,Na),Ke.on(e,"start",o,{touchArgs:[{passive:!0}]}),Ke.on(e,"end",a);function o(p){var f;const m=p.target;m.nodeType===Node.ELEMENT_NODE&&(ae.triggerElement=m);const _=m;if(n.ingoreHTMLTags&&_.tagName&&n.ingoreHTMLTags.find(E=>E.toUpperCase()===_.tagName))return;const C=(f=n.beforeDragStart)===null||f===void 0?void 0:f.call(n,p);C&&(C.setAttribute("draggable","true"),ae.dragElement=C)}function a(p){ae.dragElement&&ae.dragElement.removeAttribute("draggable")}function l(p){var f;ae.internal=!0,(f=n.onDragStart)===null||f===void 0||f.call(n,p),De(p)}function s(p){var f;(f=n.onDrag)===null||f===void 0||f.call(n,p),De(p)}function c(p){var f;(f=n.onDragEnd)===null||f===void 0||f.call(n,p),ae.internal=!1,ae.dragElement&&ae.dragElement.removeAttribute("draggable"),ae.triggerElement=null,ae.dragElement=null,ae.dropEffect="none"}const i=Ba(e,{onDragLeave(p){var f;(f=n.onDragLeave)===null||f===void 0||f.call(n,p),De(p)},onDragEnter(p){var f;r.ifPreventDefault(p)&&p.preventDefault(),(f=n.onDragEnter)===null||f===void 0||f.call(n,p),De(p)},onDragOver(p){var f;r.ifPreventDefault(p)&&p.preventDefault(),(f=n.onDragOver)===null||f===void 0||f.call(n,p),De(p)},onDrop(p){var f;r.ifPreventDefault(p)&&p.preventDefault(),(f=n.onDrop)===null||f===void 0||f.call(n,p)},onEnter(p){var f;(f=n.onEnter)===null||f===void 0||f.call(n,p)},onLeave(p){var f;(f=n.onLeave)===null||f===void 0||f.call(n,p)}});return de(e,"dragstart",l),de(e,"drag",s),de(e,"dragend",c),Object.assign(n,{root:e,destroy:()=>{Ke.off(e,"start",o,{touchArgs:[{passive:!0}]}),fe(e,"dragstart",l),fe(e,"drag",s),fe(e,"dragend",c),i(),He.delete(e)}}),He.set(e,r),r}const Na={ingoreHTMLTags:["INPUT","TEXTAREA","SELECT","OPTGROUP","OPTION"],ifPreventDefault(e){return me.dragElement?!0:ae.preventDefault},beforeDragStart(e){},onDragStart(e){},onDrag(e){},onDragEnter(e){},onDragLeave(e){},onDragOver(e){},onDragEnd(e){},onDrop(e){}};let Ue=null;const Ra=e=>{Ue=e,setTimeout(()=>{Ue=null},20)};function Ba(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e;let r=!1;const o=m=>{var _;r=!0,(_=t.onEnter)===null||_===void 0||_.call(t,m),u.resume()},a=m=>{var _;Ra(m.target),(_=t.onDragEnter)===null||_===void 0||_.call(t,m),r||o(m)},l=m=>{var _;r||o(m),(_=t.onDragOver)===null||_===void 0||_.call(t,m)},s=m=>{var _;(_=t.onDragLeave)===null||_===void 0||_.call(t,m);const C=function(){var O;let F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:m;r=!1,(O=t.onLeave)===null||O===void 0||O.call(t,F),u.stop()},E=Ue;Ue=null,E&&wa(E,n)||C()},c=m=>{var _;(_=t.onDrop)===null||_===void 0||_.call(t,m)},i=m=>{var _;m instanceof KeyboardEvent&&m.key!=="Escape"||(r=!1,u.stop(),(_=t.onEndBeforeLeave)===null||_===void 0||_.call(t,m))},u=ka([[e,"drop",i],[window,"mouseup",i],[window,"touchend",i],[window,"keydown",i]]);u.stop();const p=()=>{de(e,"dragenter",a),de(e,"dragover",l),de(e,"dragleave",s),de(e,"drop",c)},f=()=>{fe(e,"dragenter",a),fe(e,"dragover",l),fe(e,"dragleave",s),fe(e,"drop",c),u.stop()};return p(),f}let ze=!1;const Va=()=>{ze=!0,setTimeout(()=>{ze=!1},100)},Ua=Se({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const n=W(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));Z(()=>e.stat.checked,a=>{ze||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),Z(()=>e.stat.open,a=>{ze||(t(a?"open":"close",e.stat),Va())});const r=W(()=>{const a=[],l=u=>{var p;if(u.parent){let f=(p=u.parent)==null?void 0:p.children.indexOf(u);do{f++;let m=u.parent.children[f];if(m){if(!m.hidden)return!0}else break}while(!0)}return!1},s=e.rtl?"right":"left",c=e.btt?"top":"bottom";let i=e.stat;for(;i;){let u=(i.level-2)*e.indent+e.treeLineOffset;const p=l(i),f=()=>{a.push({style:{[s]:u+"px",[c]:p?0:"50%"}})};i===e.stat?i.level>1&&f():p&&f(),i=i.parent}return a}),o=W(()=>{let a=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:a+"px"}});return{indentStyle:n,vLines:r,hLineStyle:o}}}),Je=(e,t)=>{const n=e.__vccOpts||e;for(const[r,o]of t)n[r]=o;return n},za={class:"tree-node-inner"},Ma={key:1,class:"tree-node",ref:"el"};function Ia(e,t,n,r,o,a){return e.table?(b(),x("tr",Ma,[q(e.$slots,"default",{indentStyle:e.indentStyle})],512)):(b(),x("div",{key:0,class:le(["tree-node",{"tree-node--with-tree-line":e.treeLine}]),style:te(e.indentStyle),ref:"el"},[e.treeLine?(b(),x(ee,{key:0},[(b(!0),x(ee,null,pe(e.vLines,l=>(b(),x("div",{class:"tree-line tree-vline",style:te(l.style)},null,4))),256)),e.stat.level>1?(b(),x("div",{key:0,class:"tree-line tree-hline",style:te(e.hLineStyle)},null,4)):I("",!0)],64)):I("",!0),d("div",za,[q(e.$slots,"default",{indentStyle:e.indentStyle})])],6))}const Ka=Je(Ua,[["render",Ia]]);function Ha(e,t={}){const n={...t,statHandler(r){return this._statHandler2&&(r=this._statHandler2(r)),je(t.statHandler,ke(r))},statsHandler(r){return je(t.statsHandler,ke(r))},statsFlatHandler(r){return je(t.statsFlatHandler,ke(r))}};return La(e,n)}function je(e,t){return e?e(t):t}const ja=Se({components:{VirtualList:Oa,TreeNode:Ka},props:{value:{required:ia,type:Array},modelValue:{required:ca,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>Ha([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return this.modelValue||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let n=e;return this.btt&&(n=n.slice(),n.reverse()),n.filter(r=>t(r))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit("update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:We(ne("getStat")),has:We(ne("has")),updateCheck:ne("updateCheck"),getChecked:ne("getChecked"),getUnchecked:ne("getUnchecked"),openAll:ne("openAll"),closeAll:ne("closeAll"),openNodeAndParents:ne("openNodeAndParents"),isVisible:ne("isVisible"),move:it("move"),add:We(it("add")),addMulti(e,t,n){this.batchUpdate(()=>{let r=n;for(const o of e)this.add(o,t,r),r!=null&&r++})},remove:ne("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const n of t)this.remove(n)})},iterateParent:ne("iterateParent"),getSiblings:ne("getSiblings"),getData:ne("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const n=e();return this.batchUpdateWaiting=t,n}},watch:{processor:{immediate:!0,handler(e){if(e){const t=n=>{if(n){const{childrenKey:r}=this;return n[r]||(n[r]=[]),n[r]}else return this.valueComputed};e._statHandler2=this.statHandler?n=>n.data===this.placeholderData?n:this.statHandler(n):null,e.afterSetStat=(n,r,o)=>{const{childrenKey:a,updateBehavior:l}=this;let s=this.valueComputed;if(l==="new"){if(this.batchUpdateWaiting)return;s=this.getData()}else if(l==="modify"){const c=t(r?.data);c.includes(n.data)||c.splice(o,0,n.data)}this.batchUpdateWaiting||this._updateValue(s)},e.afterRemoveStat=n=>{var r;const{childrenKey:o,updateBehavior:a}=this;let l=this.valueComputed;if(a==="new"){if(this.batchUpdateWaiting)return;l=this.getData()}else if(a==="modify"){const s=t((r=n.parent)==null?void 0:r.data);ht(s,n.data)}this.batchUpdateWaiting||this._updateValue(l)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,pa(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:t}=this;t.data=e,t.init(),this.stats=t.stats,this.statsFlat=t.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function ne(e){return function(...t){return this.processor[e](...t)}}function it(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function We(e){return function(t,...n){return t&&(t=ke(t)),e.call(this,t,...n)}}const Wa={key:0,class:"drag-placeholder he-tree-drag-placeholder"},Xa=["colspan"],qa={class:"drag-placeholder he-tree-drag-placeholder"};function Ya(e,t,n,r,o,a){const l=se("TreeNode"),s=se("VirtualList");return b(),ce(s,{class:le(["he-tree",{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering}]),ref:"vtlist",items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},{prepend:j(()=>[q(e.$slots,"prepend",{tree:e.self})]),default:j(({item:c,index:i})=>[z(l,{"vt-index":i,class:le([c.class,{"drag-placeholder-wrapper":c.data===e.placeholderData,"dragging-node":c===e.dragNode}]),style:te(c.style),stat:c,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor,onClick:u=>e.$emit("click:node",c),onOpen:t[0]||(t[0]=u=>e.$emit("open:node",u)),onClose:t[1]||(t[1]=u=>e.$emit("close:node",u)),onCheck:t[2]||(t[2]=u=>e.$emit("check:node",u))},{default:j(({indentStyle:u})=>[c.data===e.placeholderData?(b(),x(ee,{key:0},[e.table?(b(),x("td",{key:1,style:te(u),colspan:e.placeholderColspan},[d("div",qa,[q(e.$slots,"placeholder",{tree:e.self})])],12,Xa)):(b(),x("div",Wa,[q(e.$slots,"placeholder",{tree:e.self})]))],64)):q(e.$slots,"default",{key:1,node:c.data,stat:c,indentStyle:u,tree:e.self},()=>[re(G(c.data[e.textKey]),1)])]),_:2},1032,["vt-index","class","style","stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor","onClick"])]),append:j(()=>[q(e.$slots,"append",{tree:e.self})]),_:3},8,["class","items","disabled","table","itemKey"])}const Za=Je(ja,[["render",Ya]]);let A=null,k=null,Xe,Ee,be,Fe,qe,Q,ct;const Ye={get targetInfo(){return Ee},get dragNode(){return Q},get targetTree(){return k}},Ga=Se({extends:Za,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function},dragOverThrottleInterval:{type:Number,default:0}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const n=this.eachDraggable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return nt(this.rootDroppable,[this,A]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const n=this.eachDroppable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return nt((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(i,u)=>{let p=!0;return A&&A!==this&&(p=p&&this._isMoved),this.table&&!this._isDragCopy&&(p=p&&this._isDragCopy),p&&(i.x!==u.x||i.y!==u.y)},t=(i,u)=>{k.ignoreUpdate(()=>{if(!k.has(k.placeholderData)){if(k.table){let f=0;const m=k.getRootEl().querySelector("tr");if(m)for(const{value:_}of ha(m.children))Ve(_,"display")!=="none"&&(f+=_.colSpan||1);f<1&&(f=1),k.placeholderColspan=f}k.add(k.placeholderData)}const p=k.getStat(k.placeholderData);k.move(p,i,u)})},n=()=>{const i=this;if(i.has(i.placeholderData))return i.remove(i.getStat(i.placeholderData)),!0},r=i=>{i?me.dropEffect=A!=null&&A.dragCopy?"copy":"move":me.dropEffect="none"},o=i=>{const u=this;i?r(!0):u.keepPlaceholder?u.has(u.placeholderData)||r(!1):(n(),r(!1))};let a={x:0,y:0};const l=this.getRootEl();let s=null;const c=()=>{k!=null&&k.has(k.placeholderData)&&k.ignoreUpdate(()=>{k.remove(k.getStat(k.placeholderData)),A&&(A.dragNode.hidden=!1,A.dragOvering=!1)})};this.treeDraggableInstance=Fa(l,{beforeDragStart:i=>{if(!me.triggerElement)return;let u=this.triggerClass;(!u||u.length===0)&&(u="tree-node");let p=fa(u),f=at(me.triggerElement,m=>{if(rt(m,p))return!0;if(Be(m,"tree-node"))return"break"},{withSelf:!0,until:l});if(s=at(f,m=>{if(Be(m,"tree-node"))return!0},{withSelf:!0,until:l}),!!s){if(Q=this.getNodeByElement(s),!Q)throw"Can't find drag node";if(this.isDraggable(Q))return this.$emit("before-drag-start",Q),this.$emit("beforeDragStart",Q),l}},onDragStart:i=>{var u,p,f;if(!s||!Q)return;{const{x:C,y:E}=s.getBoundingClientRect(),{clientX:O,clientY:F}=i;(u=i.dataTransfer)==null||u.setDragImage(s,O-C,F-E)}qe={x:i.clientX,y:i.clientY},A=this,A.dragNode=Q,Fe=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:i.clientX,y:i.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(s);{let C,E=0;if(this.table){let O=s.getBoundingClientRect();C={x:O.x,y:O.y},this.rtl&&(C.x=O.right),E=O.height}else if(!this.rtl)C=s.children[0].getBoundingClientRect().toJSON(),E=C.height;else{const O=s.children[0].getBoundingClientRect();C={x:O.right,y:O.y},E=O.height}return this.btt&&(C.y+=E),C}})(),this.dragOvering=!0;const m=A.getSiblings(A.dragNode),_=m.indexOf(Q);Xe={tree:A,dragNode:Q,parent:Q.parent,siblings:m,indexBeforeDrop:_},k=this,(p=i.dataTransfer)==null||p.setData("text",`he-tree drag start at ${new Date().toISOString()}`),A._eachDroppable()||setTimeout(()=>{Q.hidden=!0,t(Q.parent,_+1)},0),(f=this.ondragstart)==null||f.call(this,i)},onEnter:i=>{this.$emit("enter",i)},onLeave:i=>{be=null,this.dragOvering=!1,me.preventDefault=!1,n(),this.$emit("leave",i)},onDragOver:ba(i=>{if(!A){if(!this.onExternalDragOver||this.onExternalDragOver(i)===!1)return;me.preventDefault=!0}if(this.dragOverThrottleInterval>0)if(this._lastValidDragOver==null)this._lastValidDragOver=new Date().getTime();else{let $=new Date().getTime();if($-this._lastValidDragOver>this.dragOverThrottleInterval)this._lastValidDragOver=$;else return}const u={x:i.clientX,y:i.clientY},p=e(u,a);if(a=u,!p)return;this.dragOvering=!0,k=this;const f=Fe?{x:Fe.x+(u.x-qe.x),y:Fe.y+(u.y-qe.y)}:{...u},{btt:m,rtl:_}=k;if(k.disableDrop){me.dropEffect="none";return}let C,E;const O=k.getRootEl().querySelectorAll(".tree-node"),F=[];O.forEach($=>{!rt($,["drag-placeholder-wrapper","dragging-node"])&&Ve($,"display")!=="none"&&F.push($)});const U=Ge(F,$=>Ie($)[m?"bottom":"top"]-f.y,{returnNearestIfNoHit:!0});let g=null,y,L;U.hit||(U.greater?m||(g=U.index-1,F[g]||g++):m&&(g=U.index+1,F[g]||g--)),g==null&&(g=U.index),y=F[g],L=m?F[g-1]:F[g+1],C=y&&k.getNodeByElement(y),E=L&&k.getNodeByElement(L);const{indent:v}=k,R=Te(()=>{if(k.table){let $=Ie(y).toJSON();const H=v*(C.level-1);return _?($.width-=H,$.right-=H):$.x+=H,$}else return Ie(y.firstElementChild)}).action,K=Te(()=>m?f.y>R().y+R().height/2:f.y<R().y+R().height/2).action,X=Te(()=>m?!y||g===F.length-1&&K():!y||g===0&&K()).action,N=Te(()=>_?f.x-(R().x+R().width):R().x-f.x).action,w=Te(()=>_?f.x<R().x+R().width-v:f.x>R().x+v).action;let S;if(X())S=1,C=null;else if(C)N()>0?S=C.level-Math.ceil(N()/v):w()?S=C.level+1:S=C.level;else return;E&&S<E.level&&(S=E.level),(async()=>{let $,H,Y=!1,T=null;const P=async B=>{if(B.open)return!0;if(k.dragOpen)if(k.dragOpenDelay)if(T=B,be===B)Y=!0;else{let V=_a();be=B;const J=B;return setTimeout(async()=>{J!==be?(Y=!0,V.resolve(!0)):(k.beforeDragOpen&&await k.beforeDragOpen(B),J!==be?(Y=!0,V.resolve(!0)):(B.open=!0,T=null,V.resolve(!0)))},k.dragOpenDelay),await V.promise}else return k.beforeDragOpen&&await k.beforeDragOpen(B),B.open=!0,!0;else return!1},ie=async()=>{if(k.isDroppable(C)&&await P(C)){if(Y)return;$=C,H=null}else return!1},ge=(B=S)=>{let V=C,J=[];for(;V&&V.level>=B;)V=V.parent||null,J.unshift(V);let he=0;for(const ye of J){if(k.isDroppable(ye))return $=ye,H=J[he+1]||C,!0;he++}return!1};ct=C||null,C?S>C.level?await ie()===!1&&ge(C.level):ge()===!1&&await ie():k.isDroppable(null)&&($=null),be=T;const M=!!(!Y&&($||$===null));return{cancelled:Y,success:M,parent:$,index:M?H?($?$.children:k.stats).filter(B=>B.data!==k.placeholderData).indexOf(H)+1:0:-1}})().then($=>{if(!$.cancelled){if(!$.success){o(!1);return}if(k.maxLevel!=null&&k.maxLevel>0){let H=1;if(A){const Y=A.dragNode;let T=0;ue(Y,P=>{P.level>T&&(T=P.level)},{childrenKey:_e}),H=T-Y.level+1}if(H+($.parent?$.parent.level:0)>k.maxLevel){o(!1);return}}o(!0),t($.parent,$.index)}})}),onDrop:i=>{k=this;const u=!A;if(!k)return;const p=A?.dragNode;let f,m=(()=>{var _;let C=!0;if(!k.has(k.placeholderData))C=!1;else if(u)f=(_=this.externalDataHandler)==null?void 0:_.call(this,i),C=f!=null;else if(!A.dragCopy){const E=k.getStat(k.placeholderData);A===k&&E.parent===p.parent&&ya(p,O=>O===E)}return C})();if(m){const _=k.getStat(k.placeholderData),C=k.getSiblings(_);Ee={tree:k,dragNode:p,parent:_.parent,siblings:C,indexBeforeDrop:C.indexOf(_)}}(()=>{if(c(),m){let _=Ee.indexBeforeDrop;A&&!A.dragCopy&&A===k&&Xe.parent==Ee.parent&&Xe.indexBeforeDrop<_&&_--,A&&A!==k&&!A._eachDroppable()&&A.batchUpdate(()=>{A.remove(p),A.updateCheck()}),k.batchUpdate(()=>{let C=A?.dragNode,E;f?E=f:A._eachDroppable()&&(E=vt(A.dragNode.data,{childrenKey:A.childrenKey}),A.dragCopyDataHandler&&(E=A.dragCopyDataHandler(E))),E&&(k.add(E),C=k.getStat(E)),k.move(C,Ee.parent,_),k.updateCheck()})}k.$emit("after-drop"),m&&(A&&(A.dragCopy||A.$emit("change")),k!==A&&k.$emit("change"))})()},onDragEnd:i=>{c(),A&&(A.dragNode&&(A.dragNode.hidden=!1),A.dragNode=null,A.dragOvering=!1,A=null),k=null,be=null,Q=null,ct=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),Ja=Se({props:{open:{type:Boolean}}}),Qa=d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[d("title",null,"chevron-right"),d("path",{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"})],-1),er=[Qa];function tr(e,t,n,r,o,a){return b(),x("a",{class:le(["he-tree__open-icon",{open:e.open}])},er,2)}const nr=Je(Ja,[["render",tr]]),ar={class:"ms-2 tree-pannel"},rr=["onDragover"],lr=["onClick"],sr=["onContextmenu","onClick"],or={key:0,class:"icon-small fa-link fas mx-1"},ir={key:1,class:"icon-small fas fa-eye mx-1"},cr={__name:"TreeArticle",setup(e){const t=ve();Z(()=>t.article.id,()=>{i(t.article.id)}),Z(()=>t.article,()=>{t?.article?.title&&typeof r?.text!=null&&(r.text=t?.article?.title,r.menuOn=t?.article?.menuOn,r.isRoute=t?.article?.isRoute,document.title=t.article.title)},{deep:!0}),xe(()=>{i(t.article.id)});function n(g,y){y(g),g?.children&&g.children.forEach(L=>{n(L,y)})}let r=null;const o=D(t.article.id);Z(o,()=>{t.loadRec(o.value)});const a=D(0),l=D([]),s=D(),c=D([]);async function i(g){const y=await apiArt({command:"makeHeTree",id:g});o.value=g,l.value=y,n(l.value[0],L=>{L.lazy=!!(L?.directory&&!L?.children),L?.id===g&&(r=L)})}async function u(g,y,L){try{const v=await apiArt({command:"createNew",id:g.id}),R={id:v.id,text:v.title,parentId:v.parentId,directory:!1,npp:g.npp,children:[]},K=y;L.add(R,K,y.children.length),K.open=!0,o.value=v.id,document.showToast("Создано")}catch{return}}async function p(g,y,L){if(g.id==1){document.showToast("Не стоит удалять root");return}if(!await document.confirmDialog("Удалить ?"+g.id))return;const v=y.parent;v||document.showToast("Ошибка удаления parent не найден","error");let R;try{R=await apiArt({command:"deleteById",id:g.id})}catch{return}if(!L.remove(y)){document.showToast("Ошибка удаления элемента, перезагрузите","error");return}o.value=v.data.id??null,v.open=!0,v.data.directory=R.directory,v.data.text=R.title,L.openNodeAndParents(v),document.showToast("Удалено")}function f(g,y,L,v){c.value=[{label:"Новой вкладке",icon:"fas fa-link",command:()=>{window.open(location.pathname+"#"+y.id,"_blank")}},{label:"Создать",icon:"fas fa-plus",command:()=>u(y,L,v)},{label:"Удалить",icon:"fas fa-trash",command:()=>p(y,L,v)},{label:"Копировать",icon:"fas fa-copy",command:()=>m(y,L,v)}],s.value.show(g)}async function m(g,y,L){try{const v=await apiArt({command:"copyRec",id:g.id}),R={id:v.id,text:v.title,parentId:g.id,directory:!1,npp:g.npp,children:[]},K=y.parent;L.add(R,K,g.npp),K.open=!0,o.value=v.id,document.showToast("Скопировано")}catch{return}}function _(g,y){o.value=g.id}async function C(g,y,L){if(g.lazy&&!y?.data?.lazyLoad){y.data.lazyLoad=!0;let v;try{g._loading=!0,v=await apiArt({command:"getChildrens",id:g.id}),lazyLoad=!1}catch{}finally{g._loading=!1,y.data.lazy=!1}L.batchUpdate(()=>{L.addMulti(v,y,y.children.length),y.open=!0})}else y.open=!y.open}let E=null;function O(){const{dragNode:g}=Ye,y=g.parent??null,L=y?y.children.indexOf(g):0;E={parent:y,index:L},o.value=g.data.id}async function F(){const{dragNode:g,targetInfo:y}=Ye,L=g.data.id;if(L===1){U(g);return}const v=y?.parent??null,R=v?.data?.id??null;if(!R){U(g);return}const K=y.siblings??v.children??[],X=K.findIndex(w=>w===g||w.data?.id===L),N=X>0?K[X-1].data?.id??0:0;try{const w=await apiArt({command:"move",id:L,newParentId:R,idBrotherUp:N});v&&(v.open=!0)}catch{U(g);return}}function U(g){const{targetTree:y}=Ye;E?.parent&&y&&(y.move(g,E.parent,E.index),E.parent.open=!0)}return(g,y)=>{const L=se("ContextMenu");return b(),x("div",ar,[(b(),ce(h(Ga),{class:"mtl-tree my-2",modelValue:l.value,"onUpdate:modelValue":y[0]||(y[0]=v=>l.value=v),key:a.value,onAfterDrop:F,ondragstart:O,treeLine:""},{default:j(({node:v,stat:R,tree:K})=>[d("div",{class:"d-flex pointer",onDragover:Pe(X=>v.lazy?C(v,R,K):"",["stop","prevent"])},[d("div",null,[R.children.length?(b(),ce(h(nr),{key:0,open:R.open,class:"m-0 p-0",onClick:X=>R.open=!R.open},null,8,["open","onClick"])):I("",!0)]),v.lazy?(b(),x("div",{key:0,onClick:X=>C(v,R,K)},[...y[1]||(y[1]=[d("i",{class:"fas fa-chevron-right me-1"},null,-1)])],8,lr)):I("",!0),d("div",{onContextmenu:Pe(X=>f(X,v,R,K),["prevent"]),class:le({active:v.id==o.value,notroute:!v.isRoute,route:v.isRoute}),onClick:X=>_(v,R)},[d("span",{style:te(v.directory?"margin-left:-3px":"margin-left:3px")},null,4),re(G(v.text)+" ",1),v.isRoute?(b(),x("i",or)):I("",!0),v.menuOn?(b(),x("i",ir)):I("",!0)],42,sr)],40,rr)]),_:1},8,["modelValue"])),z(L,{ref_key:"menu",ref:s,model:c.value},null,8,["model"])])}}},ur={class:"ms-2 tree-pannel"},dr={class:"row my-1"},fr={class:"input-group input-group-sm"},pr=["textContent","onClick"],hr={__name:"FindText",setup(e){const t=ve(),n=D([]),r=D("");async function o(){n.value=await t.search(r.value)}async function a(l){await t.loadRec(l),t.article.body.search(r.value)>=0&&(t.searchTextView=r.value),t.article.controller.search(r.value)>=0&&(t.searchTextController=r.value)}return(l,s)=>(b(),x("div",ur,[d("div",dr,[d("div",fr,[d("button",{class:"btn btn-primary fas fa-times",onClick:s[0]||(s[0]=c=>h(t).statusLeftPannel="tree")}),oe(d("input",{placeholder:"найти",type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=c=>r.value=c)},null,512),[[we,r.value]]),d("button",{class:"btn btn-primary fas fa-angle-right",onClick:s[2]||(s[2]=c=>o())})])]),(b(!0),x(ee,null,pe(n.value,c=>(b(),x("div",null,[d("span",{textContent:G(c.title),onClick:i=>a(c.id),class:le(["pointer",{active:h(t).article.id==c.id}])},null,10,pr)]))),256))]))}},mr=Xt(hr,[["__scopeId","data-v-f8b286bb"]]),gr={key:0},vr={style:{position:"relative"}},yr={__name:"EditArticle",setup(e){const t=ve(),n=D({show:!1,x:0,y:0});function r(){t.article.routeParams.useController||(p.value=0,m.value="view"),t.article.routeParams.useController&&(p.value=50,m.value="full"),t.modeEditorSplitter=m.value,u.value.resetState()}const o=D(null),a=D(20);let l=0;const s=D("open"),c=E=>{a.value=E.sizes[0]};function i(){s.value=="open"?(l=a.value,a.value=0,s.value="hidden"):(a.value=l,s.value="open"),t.modeTreeSplitter=s.value,o.value.resetState()}const u=D(),p=D(50);let f=0;const m=D("full");Z(u,()=>{r()});function _(E){p.value=E.sizes[0]}function C(){switch(m.value){case"full":f=p.value,p.value=0,m.value="view";break;case"view":p.value=100,m.value="controller";break;case"controller":p.value=f,m.value="full";break}t.modeEditorSplitter=m.value,u.value.resetState()}return xe(()=>{const E=document.getElementById("editor-layer").getBoundingClientRect();n.value.y=window.innerHeight-E.top,n.value.x=window.innerWidth,n.value.show=!0,t.toggleTreeSplitter=i,t.toggleEditorSplitter=C,Z(()=>t.article.routeParams.useController,()=>{r()})}),(E,O)=>{const F=se("SplitterPanel"),U=se("Splitter");return b(),x("div",null,[d("div",{style:te({height:n.value.y+"px",width:n.value.x+"px"}),id:"editor-layer"},[n.value.show?(b(),x("div",gr,[z(U,{style:te({height:n.value.y+"px",width:n.value.x+"px"}),onResizeend:c,ref_key:"splitterTreeRef",ref:o},{default:j(()=>[z(F,{size:a.value,minSize:0},{default:j(()=>[d("div",vr,[oe(d("button",{style:{position:"absolute",right:"10px","z-index":"1000"},class:"btn btn-primary fas fa-search",onClick:O[0]||(O[0]=g=>h(t).statusLeftPannel="find")},null,512),[[Ne,h(t).statusLeftPannel==="tree"]])]),oe(z(cr,null,null,512),[[Ne,h(t).statusLeftPannel==="tree"]]),oe(z(mr,null,null,512),[[Ne,h(t).statusLeftPannel==="find"]])]),_:1},8,["size"]),z(F,{size:100-a.value,minSize:1},{default:j(()=>[z(U,{style:{height:"100%"},onResizeend:_,ref_key:"splitEditorRef",ref:u},{default:j(()=>[z(F,{size:p.value,minSize:1},{default:j(()=>[z(et,{modelValue:h(t).article.controller,"onUpdate:modelValue":O[1]||(O[1]=g=>h(t).article.controller=g),lang:"php",theme:h(t).aceTheme,height:n.value.y},null,8,["modelValue","theme","height"])]),_:1},8,["size"]),z(F,{size:100-p.value,minSize:1},{default:j(()=>[z(et,{modelValue:h(t).article.body,"onUpdate:modelValue":O[2]||(O[2]=g=>h(t).article.body=g),lang:"html",theme:h(t).aceTheme,height:n.value.y},null,8,["modelValue","theme","height"])]),_:1},8,["size"])]),_:1},512)]),_:1},8,["size"])]),_:1},8,["style"])])):I("",!0)],4)])}}},br={class:"d-flex"},_r=["src"],wr={class:"flex-grow-1"},kr={key:0,class:"text-danger"},$r={key:0},xr={key:0,class:"text-danger ms-2"},Sr=["onClick"],Cr={class:"progress mt-2",style:{height:"10px"}},Tr={__name:"UploadFile",props:{path:{type:String,required:!0},directory:{type:Object,required:!0}},emits:["uploaded"],setup(e,{expose:t,emit:n}){const r=n,o=e,a=D(!1),l=D(!1),s=D([]),c=W(()=>new Set((o.directory??[]).map(O=>(O.name??"").toLowerCase())));function i(){a.value=!0}function u(){a.value=!1,s.value=[]}function p(O,F){return new Promise((U,g)=>{const y=new XMLHttpRequest,L=new URLSearchParams({command:"uploadBin",path:o.path,filename:O.name});y.open("POST",`/a_dmin/api/fileManager?${L.toString()}`,!0),y.responseType="json",y.upload.onprogress=v=>{v.lengthComputable&&(s.value[F].progress=Math.round(v.loaded/v.total*100))},y.onload=()=>{const v=y.response;if(s.value[F].progress=100,s.value[F].status=y.status===200&&v?.status===!0?"ok":"error",s.value[F].status==="ok")r("uploaded",v.data),U(v.data);else{const R=v?.errorMsg||v?.message||`Ошибка загрузки (${y.status})`;g(new Error(R))}},y.onerror=()=>{s.value[F].status="error",g(new Error("Ошибка сети при загрузке файла"))},y.onabort=()=>{s.value[F].status="error",g(new Error("Загрузка отменена"))},y.setRequestHeader("Content-Type","application/octet-stream"),y.send(O)})}async function f(O){const F=Array.isArray(O?.files)?O.files:[];F.length&&(s.value=F.map(U=>({name:U.name,progress:0,status:"loading"})),l.value=!0,await Promise.all(F.map(async(U,g)=>{try{await p(U,g)}catch(y){document.showToast(y.message||"Ошибка загрузки файла","error")}})),l.value=!1,E.value?.clear())}function m(O){return c.value.has(O.toLowerCase())}function _(O){return URL.createObjectURL(O)}function C(O){return!!O&&typeof O.type=="string"&&O.type.startsWith("image/")}const E=D(null);return t({open:i,close:u}),(O,F)=>{const U=se("FileUpload"),g=se("Dialog");return b(),ce(g,{visible:a.value,"onUpdate:visible":F[0]||(F[0]=y=>a.value=y),modal:"",header:"Загрузка файлов",class:"w-50"},{default:j(()=>[z(U,{name:"files[]",mode:"advanced",multiple:"",chooseLabel:"Выбрать файлы",uploadLabel:"Загрузить",cancelLabel:"Отмена",customUpload:"",auto:!1,maxFileSize:5e8,ref_key:"uploader",ref:E,onUploader:f},{content:j(({files:y})=>[(b(!0),x(ee,null,pe(y,(L,v)=>(b(),x("div",{key:L.name,class:"mb-2"},[d("div",null,[d("div",br,[d("div",null,[C(L)?(b(),x("img",{key:0,src:_(L),alt:"",style:{width:"96px",height:"auto"},class:"me-2 rounded border"},null,8,_r)):I("",!0)]),d("div",wr,[d("div",null,[d("small",null,G(L.name),1)]),m(L.name)&&!l.value?(b(),x("div",kr,"копия — будет переписан")):I("",!0),d("div",null,[s.value[v]?(b(),x("small",$r,G(s.value[v].progress)+"%",1)):I("",!0)])]),m(L.name)?(b(),x("div",xr,[d("i",{class:"fas fa-times pointer",onClick:R=>y.splice(v,1)},null,8,Sr)])):I("",!0)])]),d("div",Cr,[d("div",{class:le(["progress-bar",{"bg-success":s.value[v]?.status==="ok","bg-danger":s.value[v]?.status==="error","progress-bar-striped progress-bar-animated":s.value[v]?.status==="loading"}]),role:"progressbar",style:te({width:(s.value[v]?.progress||0)+"%"})},null,6)])]))),128))]),_:1},512)]),_:1},8,["visible"])}}},Dr={class:"me-2 icon"},Er={key:0},Pr={class:"ms-1",style:{"font-size":"85%"}},Or={key:0,class:"thumb-pic"},Lr=["src"],Ar={class:"file-name"},Fr={key:1,class:"thumb-file"},Nr={style:{"word-break":"break-all"}},Rr={__name:"FileItem",props:{el:{type:Object,required:!0},viewFull:Boolean,viewSize:Number,path:String,onRightClick:Function},setup(e){const t=e;W(()=>{const r=t.el.name||"";return r.includes(".")?r.split(".").pop().toLowerCase():""});function n(r,o){return t.viewSize>r&&t.viewSize>o?`width: ${r} px; height:  ${o} px;`:r>=o?"width:"+(t.viewSize-2)+"px;":"height:"+(t.viewSize-2)+"px;"}return(r,o)=>e.viewFull?(b(),x("div",{key:1,class:"thumb",style:te(`width:${e.viewSize}px;`),onContextmenu:o[1]||(o[1]=Pe(a=>e.onRightClick(a,e.el),["prevent"]))},[e.el.isImage?(b(),x("div",Or,[d("img",{src:e.path+e.el.name+"?"+e.el.date,style:te(n(e.el.width,e.el.height))},null,12,Lr),d("div",Ar,[re(G(e.el.name),1),o[2]||(o[2]=d("br",null,null,-1)),re("("+G(e.el.width)+"x"+G(e.el.height)+")",1)])])):(b(),x("div",Fr,[o[3]||(o[3]=d("i",{class:"far fa-file",style:{"font-size":"300%",color:"#777"}},null,-1)),d("div",Nr,G(e.el.name),1)]))],36)):(b(),x("div",{key:0,class:"d-flex my-1",onContextmenu:o[0]||(o[0]=Pe(a=>e.onRightClick(a,e.el),["prevent"]))},[d("div",Dr,[d("i",{class:le({"far fa-file-image":e.el.isImage,"far fa-file":!e.el.isImage})},null,2)]),d("div",null,[re(G(e.el.name)+" ",1),e.el.isImage?(b(),x("span",Er,[d("span",Pr,"("+G(e.el.width)+"x"+G(e.el.height)+")",1)])):I("",!0)])],32))}},Br={class:"d-flex align-items-center gap-2 p-1 rounded w-100 border"},Vr={class:"flex-grow-1"},Ur=["onClick"],zr={key:0,class:"mt-2"},Mr={key:0,class:"my-5 py-5 text-center"},Ir={class:"d-flex folder"},Kr={class:"me-2"},Hr=["onClick"],jr=["onContextmenu","onClick"],Wr={key:1,class:"text-center p-3"},Xr={class:"mb-3"},qr={__name:"FileManager",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:["update:visible"],setup(e){const t=ut(e,"visible"),n=D(null),r=D("/design/"),o=D("/design/");o.value=r.value;const a=D([]),l=D([]),s=D(!0),c=D(160),i=D(!1),u=ke({visible:!1,newFolderName:""});D(!1),xe(async()=>{await m(o.value),await F(o.value)});async function p(){l.value.length>0&&(o.value=l.value.pop()),await F(o.value)}function f(){u.newFolderName="",u.visible=!0}async function m(){try{i.value=!1;const T=await Le({command:"start"});r.value=T.startDirectory,o.value=T.startDirectory}catch(T){console.error(T)}finally{i.value=!0}}async function _(){if(u.newFolderName.trim())try{i.value=!1,await Le({command:"mkdir",path:o.value,name:u.newFolderName.trim()}),await F(o.value)}catch(T){console.error(T)}finally{u.visible=!1,i.value=!0}}function C(){n.value.open()}async function E(T){try{i.value=!1,l.value.push(o.value),o.value=o.value+T+"/",await F(o.value)}catch(P){console.error(P)}finally{i.value=!0}}function O(T){document.showToast("Загружен "+T.name),a.value=a.value.filter(P=>P.name!==T.name),a.value.unshift(T)}async function F(T){try{i.value=!1,a.value=await Le({command:"dirList",path:T})}catch(P){console.error(P)}finally{i.value=!0}}async function U(T){if(await document.confirmDialog("Удалить?"+o.value+T))try{i.value=!1,await Le({command:"delete",path:o.value,name:T}),a.value=a.value.filter(P=>P.name!==T),document.showToast("Удален "+T)}catch(P){console.error(P)}finally{i.value=!0}}function g(T){const P=`<img src="${encodeURI(o.value+T.name)}" alt="${T.name}" height="${T.height}" width="${T.width}" />`;Qe(P)}function y(T){Qe(encodeURI(o.value+T.name))}function L(T){S.visible=!0,S.fileName=o.value+T.name}const v=D(),R=D([]),K=T=>{T.key==="Escape"&&(T.stopPropagation(),v.value?.hide&&v.value.hide(),document.removeEventListener("keydown",K,!0))};function X(T,P,ie){document.addEventListener("keydown",K,!0),R.value=[{label:"Удалить",icon:"fas fa-trash",command:()=>{U(P.name)}},{label:"Переименовать",icon:"fas fa-plus",command:()=>{$.value=!0,H.value=o.value,Y.value=P.name}}],P.type==="file"&&R.value.push({label:"Копировать путь",icon:"fas fa-link",command:()=>{y(P)}}),P.type==="file"&&P.isImage&&R.value.push({label:"Копировать Img",icon:"far fa-file-image",command:()=>{g(P)}}),P.type==="file"&&["css","js","ts","txt","csv","json","md"].includes(St(P.name))&&R.value.push({label:"Редактировать",icon:"fas fa-pen",command:()=>{L(P)}}),v.value.show(T)}async function N(T){if(l.value.length!==0){if(T===0){o.value=r.value,l.value=[],await F(o.value);return}T>=l.value.length||(o.value=l.value[T],l.value=l.value.slice(0,T),await F(o.value))}}const w=W(()=>o.value.split("/").filter(ie=>ie!=="").map((ie,ge)=>({name:ie,index:ge}))),S=ke({visible:!1,fileName:""}),$=D(!0),H=D(""),Y=D("sss");return(T,P)=>{const ie=se("Dialog"),ge=se("ContextMenu");return b(),x(ee,null,[z(Ht,{visible:t.value,"onUpdate:visible":P[1]||(P[1]=M=>t.value=M),zIndex:1e3},{header:j(()=>[d("div",Br,[o.value!==r.value?(b(),x("button",{key:0,onClick:p,class:"btn btn-success fas fa-chevron-left"})):I("",!0),d("button",{onClick:f,class:"btn btn-success fas fa-folder-plus"}),d("button",{onClick:C,class:"btn btn-success fas fa-file-upload"}),d("div",Vr,[(b(!0),x(ee,null,pe(w.value,(M,B)=>(b(),x("span",{key:B},[d("span",{class:le(["path-element",{"path-end":B===w.value.length-1}]),onClick:V=>N(B)},G(M.name),11,Ur),P[6]||(P[6]=d("span",{class:"mx-1",style:{"font-size":"80%"}},"/",-1))]))),128))]),d("div",null,[d("button",{class:le(["btn btn-success",{"fas fa-list":s.value,"fas fa-th":!s.value}]),onClick:P[0]||(P[0]=M=>s.value=!s.value)},null,2)])])]),default:j(()=>[i.value?(b(),x("div",zr,[a.value.length===0?(b(),x("div",Mr,"...")):I("",!0),(b(!0),x(ee,null,pe(a.value.filter(M=>M.type==="dir"),(M,B)=>(b(),x("div",null,[d("div",Ir,[d("div",Kr,[d("i",{class:"far fa-folder pointer",onClick:V=>E(M.name)},null,8,Hr)]),d("div",{class:"pointer",onContextmenu:Pe(V=>X(V,M,B),["prevent"]),onClick:V=>E(M.name)},G(M.name),41,jr)])]))),256)),d("div",{class:le([{"d-flex flex-wrap":s.value},""])},[(b(!0),x(ee,null,pe(a.value.filter(M=>M.type!=="dir"),M=>(b(),ce(Rr,{key:M.name,el:M,viewFull:s.value,viewSize:c.value,path:o.value,onRightClick:X},null,8,["el","viewFull","viewSize","path"]))),128))],2)])):(b(),x("div",Wr,[...P[7]||(P[7]=[d("div",{class:"spinner-border text-info"},null,-1)])]))]),_:1},8,["visible"]),S.visible?(b(),ce(jt,{key:0,fileName:S.fileName,zIndex:1e3,onClose:P[2]||(P[2]=M=>S.visible=!1)},null,8,["fileName"])):I("",!0),z(ie,{visible:u.visible,"onUpdate:visible":P[5]||(P[5]=M=>u.visible=M),header:"Создать папку",modal:""},{footer:j(()=>[d("button",{class:"btn btn-secondary btn-sm",onClick:P[4]||(P[4]=M=>u.visible=!1)},"Отмена"),d("button",{class:"btn btn-success btn-sm",onClick:_},"Создать")]),default:j(()=>[d("div",Xr,[P[8]||(P[8]=d("label",{class:"form-label"},"Имя новой папки",-1)),oe(d("input",{"onUpdate:modelValue":P[3]||(P[3]=M=>u.newFolderName=M),type:"text",class:"form-control",placeholder:"Новая папка",onKeyup:xt(_,["enter"])},null,544),[[we,u.newFolderName]])])]),_:1},8,["visible"]),z(Tr,{ref_key:"uploadRef",ref:n,path:o.value,directory:a.value,onUploaded:O,class:"w-50"},null,8,["path","directory"]),z(ge,{ref_key:"menu",ref:v,model:R.value},null,8,["model"])],64)}}},Yr={__name:"ArtEditor",setup(e){const t=ve(),n=D(1);xe(()=>{const o=new URLSearchParams(window.location.search);Object.fromEntries(o.entries()),t.loadRec(Number(location.hash.slice(1))||1),history.pushState(n.value,null,"#"+n.value),console.log("--start ediror--"),Ct("#ff642f"),window.addEventListener("popstate",r)}),Tt(()=>{window.removeEventListener("popstate",r)});const r=o=>{n.value=Number(location.hash.slice(1))||1};return(o,a)=>(b(),x(ee,null,[h(t).articleReady?(b(),ce(yn,{key:0})):I("",!0),h(t).articleReady?(b(),ce(yr,{key:1})):I("",!0),z(qr,{visible:h(t).statusFileManager,"onUpdate:visible":a[0]||(a[0]=l=>h(t).statusFileManager=l)},null,8,["visible"]),z(ta),h(t).articleReady?(b(),ce(ea,{key:2})):I("",!0),z(Dt)],64))}},Zr=[dt,Pt,Ot,Lt,At,Ft,Nt,Rt,Bt,It],Ce=Et(Yr);Zr.forEach(e=>{Ce.component(e.name,e)});Ce.use(Vt,{theme:{preset:Ut,options:{cssLayer:{name:"primevue",order:"theme, base, primevue"}}}});Ce.use(zt);Ce.use(dt);Ce.use(Wt());Ce.mount("#art_editor");Object.assign(globalThis,Mt);
