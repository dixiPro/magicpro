import{Y as U,Z as O,R as j,$ as q,b as m,c as n,o,a as e,y as f,F as u,G as h,H as c,v as D,a0 as F,a1 as w,a2 as R,a3 as T,a4 as V,a5 as M,a6 as N,a7 as W,a8 as G,a9 as H,aa as I,ab as K,ac as Q}from"./apiCall-BhOi8FOm.js";import{s as Y}from"./index-C9nv6BOL.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"my-2"},J={key:0},X={class:"table table-sm table-bordered"},tt={key:0},et={class:"link"},rt=["href"],st={class:"me-2"},at=["href"],nt={class:"table table-sm table-bordered"},ot={key:0},lt={class:"link"},ct=["href"],ut={class:"me-2"},it=["href"],dt={class:"table table-sm table-bordered"},ht={key:0},ft={class:"link"},_t=["href"],kt={class:"me-2"},pt=["href"],mt={class:"table table-sm table-bordered"},bt={key:0},yt={class:"link"},vt=["href"],gt={class:"me-2"},wt=["href"],At={__name:"Crawler",setup(b){const A=U(),E=O();j(()=>{console.log("startCrawler"),document.showToast=(r="",t="success")=>{const s=t==="success"?5e3:6e4;A.add({severity:t,detail:r,life:s}),t==="error"&&console.log(r)},document.confirmDialog=async r=>new Promise((t,s)=>{E.require({message:r,header:"",icon:"fas fa-question",acceptLabel:"Да",rejectLabel:"Нет",accept:()=>t(!0),reject:()=>t(!1)})})}),q(()=>{});const i=m({}),d=m({}),_=m(!1),k=m("start");async function y(r){try{return await D({command:"checkUrlByPhp",url:r})}catch(t){throw new Error(t)}}function $(r){try{return new URL(r).href}catch{return new URL(r,location.origin).href}}async function C(r){try{const t=await y($(r));return console.log(t),t}catch(t){throw new Error(t)}}function P(r){if(!_.value)return new Promise(async(t,s)=>{try{const a=await C(r);if(!a.check)return s({error:a.code});const l=a.body,L=[...new DOMParser().parseFromString(l,"text/html").querySelectorAll("a")].map(B=>B.getAttribute("href")).filter(Boolean);t(L)}catch(a){s({error:a.message})}})}async function S(r,t){if(k.value="working",_.value)return;await v(r,t);let s={};Object.keys(i.value).sort().forEach(a=>{s[a]=i.value[a]}),i.value=s,await x(),s={},Object.keys(d.value).sort().forEach(a=>{s[a]=d.value[a]}),d.value=s,k.value="end"}async function x(){if(!_.value)for(let r in d.value)try{const t=await y(r);d.value[r].status="done",d.value[r].check=t.check?"ok":t.code}catch{}}async function v(r,t){if(_.value||["#","/a_dmin","/f_ilament"].some(l=>r.startsWith(l)))return;if(["//","http://","https://"].some(l=>r.startsWith(l))){r in d.value||(d.value[r]={status:"reading",check:"unknown",parentArr:[]}),d.value[r].parentArr.push(t);return}if(r in i.value){i.value[r].check!="ok"&&i.value[r].parentArr.push(t);return}i.value[r]={status:"reading",check:"unknown",parentArr:[t]};try{const l=await P(r);i.value[r].check="ok";for(const g of l){if(_.value)return;await v(g,r)}}catch(l){i.value[r].check=l.error}finally{i.value[r].status="done"}}return(r,t)=>(o(),n(u,null,[t[6]||(t[6]=e("h1",null,"Crawler 0.7",-1)),e("div",z,[k.value=="start"?(o(),n("button",{key:0,class:"btn btn-primary fas fa-angle-right",onClick:t[0]||(t[0]=s=>S("/",""))})):f("",!0),k.value=="working"?(o(),n("button",{key:1,class:"btn btn-danger fas fa-stop ms-3",onClick:t[1]||(t[1]=s=>_.value=!0)})):f("",!0)]),k.value!="start"?(o(),n("div",J,[t[2]||(t[2]=e("h3",null,"Error",-1)),e("table",X,[e("tbody",null,[(o(!0),n(u,null,h(i.value,(s,a)=>(o(),n(u,{key:a},[s.check!="ok"?(o(),n("tr",tt,[e("td",et,[e("a",{href:a,target:"_blank"},c(a),9,rt)]),e("td",null,c(s.status),1),e("td",null,c(s.check),1),e("td",null,[(o(!0),n(u,null,h(s.parentArr,l=>(o(),n("span",st,[e("a",{href:l,target:"_blank"},c(l),9,at)]))),256))])])):f("",!0)],64))),128))])]),t[3]||(t[3]=e("h3",null,"Ok",-1)),e("table",nt,[e("tbody",null,[(o(!0),n(u,null,h(i.value,(s,a)=>(o(),n(u,{key:a},[s.check=="ok"?(o(),n("tr",ot,[e("td",lt,[e("a",{href:a,target:"_blank"},c(a),9,ct)]),e("td",null,c(s.status),1),e("td",null,c(s.check),1),e("td",null,[(o(!0),n(u,null,h(s.parentArr,l=>(o(),n("span",ut,[e("a",{href:l,target:"_blank"},c(l),9,it)]))),256))])])):f("",!0)],64))),128))])]),t[4]||(t[4]=e("h2",null,"External Error",-1)),e("table",dt,[e("tbody",null,[(o(!0),n(u,null,h(d.value,(s,a)=>(o(),n(u,{key:a},[s.check!="ok"?(o(),n("tr",ht,[e("td",ft,[e("a",{href:a,target:"_blank"},c(a),9,_t)]),e("td",null,c(s.status),1),e("td",null,c(s.check),1),e("td",null,[(o(!0),n(u,null,h(s.parentArr,l=>(o(),n("span",kt,[e("a",{href:l,target:"_blank"},c(l),9,pt)]))),256))])])):f("",!0)],64))),128))])]),t[5]||(t[5]=e("h2",null,"External OK",-1)),e("table",mt,[e("tbody",null,[(o(!0),n(u,null,h(d.value,(s,a)=>(o(),n(u,{key:a},[s.check=="ok"?(o(),n("tr",bt,[e("td",yt,[e("a",{href:a,target:"_blank"},c(a),9,vt)]),e("td",null,c(s.status),1),e("td",null,c(s.check),1),e("td",null,[(o(!0),n(u,null,h(s.parentArr,l=>(o(),n("span",gt,[e("a",{href:l,target:"_blank"},c(l),9,wt)]))),256))])])):f("",!0)],64))),128))])])])):f("",!0)],64))}},Et=Z(At,[["__scopeId","data-v-b190fee9"]]),$t=[w,R,T,V,M,N,W,G,H,Y],p=F(Et);$t.forEach(b=>{p.component(b.name,b)});p.use(I,{theme:{preset:K,options:{cssLayer:{name:"primevue",order:"theme, base, primevue"}}}});p.use(Q);p.use(w);p.mount("#crawler");
