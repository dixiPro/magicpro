import{Y as B,Z as L,R as U,$ as O,b as m,c as n,o,a as t,y as _,F as u,G as h,H as c,v as F,a0 as R,a1 as w,a2 as V,a3 as D,a4 as M,a5 as N,a6 as T,a7 as W,a8 as j,a9 as q,aa as G,ab as H,ac as I}from"./apiCall-BhOi8FOm.js";import{s as K}from"./index-C9nv6BOL.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"my-2"},Z={key:0},z={class:"table table-sm table-bordered"},J={key:0},X={class:"link"},tt=["href"],et={class:"me-2"},rt=["href"],st={class:"table table-sm table-bordered"},at={key:0},nt={class:"link"},ot=["href"],lt={class:"me-2"},ct=["href"],ut={class:"table table-sm table-bordered"},it={key:0},dt={class:"link"},ht=["href"],_t={class:"me-2"},ft=["href"],kt={class:"table table-sm table-bordered"},pt={key:0},mt={class:"link"},bt=["href"],vt={class:"me-2"},yt=["href"],gt={__name:"Crawler",setup(b){B(),L(),U(()=>{console.log("startCrawler")}),O(()=>{});const i=m({}),d=m({}),f=m(!1),k=m("start");async function v(s){try{return await F({command:"checkUrlByPhp",url:s})}catch(e){throw new Error(e)}}function A(s){try{return new URL(s).href}catch{return new URL(s,location.origin).href}}async function E(s){try{const e=await v(A(s));return console.log(e),e}catch(e){throw new Error(e)}}function $(s){if(!f.value)return new Promise(async(e,r)=>{try{const a=await E(s);debugger;if(!a.check)return r({error:a.code});const l=await a.body(),x=[...new DOMParser().parseFromString(l,"text/html").querySelectorAll("a")].map(P=>P.getAttribute("href")).filter(Boolean);e(x)}catch(a){r({error:a.message})}})}async function C(s,e){if(k.value="working",f.value)return;await y(s,e);let r={};Object.keys(i.value).sort().forEach(a=>{r[a]=i.value[a]}),i.value=r,await S(),r={},Object.keys(d.value).sort().forEach(a=>{r[a]=d.value[a]}),d.value=r,k.value="end"}async function S(){if(!f.value)for(let s in d.value)try{const e=await v(s);d.value[s].status="done",d.value[s].check=e.check?"ok":e.code}catch{}}async function y(s,e){if(f.value||["#","/a_dmin","/f_ilament"].some(l=>s.startsWith(l)))return;if(["//","http://","https://"].some(l=>s.startsWith(l))){s in d.value||(d.value[s]={status:"reading",check:"unknown",parentArr:[]}),d.value[s].parentArr.push(e);return}if(s in i.value){i.value[s].check!="ok"&&i.value[s].parentArr.push(e);return}i.value[s]={status:"reading",check:"unknown",parentArr:[e]};try{const l=await $(s);i.value[s].check="ok";for(const g of l){if(f.value)return;await y(g,s)}}catch(l){i.value[s].check=l.error}finally{i.value[s].status="done"}}return(s,e)=>(o(),n(u,null,[e[6]||(e[6]=t("h1",null,"Crawler 0.6",-1)),t("div",Y,[k.value=="start"?(o(),n("button",{key:0,class:"btn btn-primary fas fa-angle-right",onClick:e[0]||(e[0]=r=>C("/",""))})):_("",!0),k.value=="working"?(o(),n("button",{key:1,class:"btn btn-danger fas fa-stop ms-3",onClick:e[1]||(e[1]=r=>f.value=!0)})):_("",!0)]),k.value!="start"?(o(),n("div",Z,[e[2]||(e[2]=t("h3",null,"Error",-1)),t("table",z,[t("tbody",null,[(o(!0),n(u,null,h(i.value,(r,a)=>(o(),n(u,{key:a},[r.check!="ok"?(o(),n("tr",J,[t("td",X,[t("a",{href:a,target:"_blank"},c(a),9,tt)]),t("td",null,c(r.status),1),t("td",null,c(r.check),1),t("td",null,[(o(!0),n(u,null,h(r.parentArr,l=>(o(),n("span",et,[t("a",{href:l,target:"_blank"},c(l),9,rt)]))),256))])])):_("",!0)],64))),128))])]),e[3]||(e[3]=t("h3",null,"Ok",-1)),t("table",st,[t("tbody",null,[(o(!0),n(u,null,h(i.value,(r,a)=>(o(),n(u,{key:a},[r.check=="ok"?(o(),n("tr",at,[t("td",nt,[t("a",{href:a,target:"_blank"},c(a),9,ot)]),t("td",null,c(r.status),1),t("td",null,c(r.check),1),t("td",null,[(o(!0),n(u,null,h(r.parentArr,l=>(o(),n("span",lt,[t("a",{href:l,target:"_blank"},c(l),9,ct)]))),256))])])):_("",!0)],64))),128))])]),e[4]||(e[4]=t("h2",null,"External Error",-1)),t("table",ut,[t("tbody",null,[(o(!0),n(u,null,h(d.value,(r,a)=>(o(),n(u,{key:a},[r.check!="ok"?(o(),n("tr",it,[t("td",dt,[t("a",{href:a,target:"_blank"},c(a),9,ht)]),t("td",null,c(r.status),1),t("td",null,c(r.check),1),t("td",null,[(o(!0),n(u,null,h(r.parentArr,l=>(o(),n("span",_t,[t("a",{href:l,target:"_blank"},c(l),9,ft)]))),256))])])):_("",!0)],64))),128))])]),e[5]||(e[5]=t("h2",null,"External OK",-1)),t("table",kt,[t("tbody",null,[(o(!0),n(u,null,h(d.value,(r,a)=>(o(),n(u,{key:a},[r.check=="ok"?(o(),n("tr",pt,[t("td",mt,[t("a",{href:a,target:"_blank"},c(a),9,bt)]),t("td",null,c(r.status),1),t("td",null,c(r.check),1),t("td",null,[(o(!0),n(u,null,h(r.parentArr,l=>(o(),n("span",vt,[t("a",{href:l,target:"_blank"},c(l),9,yt)]))),256))])])):_("",!0)],64))),128))])])])):_("",!0)],64))}},wt=Q(gt,[["__scopeId","data-v-309138d8"]]),At=[w,V,D,M,N,T,W,j,q,K],p=R(wt);At.forEach(b=>{p.component(b.name,b)});p.use(G,{theme:{preset:H,options:{cssLayer:{name:"primevue",order:"theme, base, primevue"}}}});p.use(I);p.use(w);p.mount("#crawler");
