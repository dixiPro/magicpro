import{r as g,l as n,p as o,s as f,Q as W,U as z,V as G,M as K,X,ab as v,d as j,C as O,q as s,G as h,H as k,y as Y,E as y,F as u,A as m,B as i,Y as Z,Z as U,_ as J,$ as tt,a0 as et,a1 as st,a2 as at,a3 as nt,a4 as ot,a5 as rt,a6 as lt,a7 as ct,a8 as it}from"./apiCall-DgoSpTMN.js";import{s as ut}from"./index-CVxEeueg.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ft=["disabled"],ht={key:0,class:"spinner-border spinner-border-sm me-2"},w={__name:"LoadingButton",props:{action:Function},setup(C){const T=C,p=g(!1);async function $(){p.value=!0;try{await T.action()}finally{p.value=!1}}return(r,c)=>(o(),n("button",{disabled:p.value,onClick:$,class:"btn btn-primary"},[p.value?(o(),n("span",ht)):f("",!0),W(r.$slots,"default")],8,ft))}},mt={class:"my-2"},_t={class:"my-2"},kt={class:"my-2"},pt={class:"my-2"},bt={class:"my-2"},vt={class:"my-2"},yt={class:"my-2"},wt={key:0},gt={class:"table table-sm table-bordered"},Ct={key:0},Et={class:"link"},At=["href"],St={class:"me-2"},Tt=["href"],$t={key:1},xt={class:"table table-sm table-bordered"},Lt={key:0},Pt={class:"link"},Ft=["href"],Bt={class:"me-2"},jt=["href"],Ot={key:2},Ut={class:"table table-sm table-bordered"},Vt={key:0},Dt={class:"link"},It=["href"],Nt={class:"me-2"},qt=["href"],Ht={key:3},Mt={class:"table table-sm table-bordered"},Qt={key:0},Rt={class:"link"},Wt=["href"],zt={class:"me-2"},Gt=["href"],Kt={__name:"Crawler",setup(C){const T=z(),p=G();K(()=>{console.log("startCrawler"),S(),document.showToast=(e="",t="success")=>{const _=t==="success"?5e3:6e4;T.add({severity:t,detail:e,life:_}),t==="error"&&console.log(e)},document.confirmDialog=async e=>new Promise((t,_)=>{p.require({message:e,header:"",icon:"fas fa-question",acceptLabel:"Да",rejectLabel:"Нет",accept:()=>t(!0),reject:()=>t(!1)})})});async function $(e){return new Promise(t=>setTimeout(t,e))}X(()=>{});const r=g({}),c=g({}),b=g(!1),A=g("start"),x=g(!1);async function P(e){return await v({command:"processUrl",url:e})}function V(e){try{return new URL(e).href}catch{return new URL(e,location.origin).href}}async function D(e){if(b.value)return;const t=await P(V(e));if(!t.check)throw new Error(t.code);const _=t.body;return[...new DOMParser().parseFromString(_,"text/html").querySelectorAll("a")].map(l=>l.getAttribute("href")).filter(Boolean)}async function I(){if(r.value={},c.value={},A.value="working",b.value)return;await B(),await F("/","");let e={};Object.keys(r.value).sort().forEach(t=>{e[t]=r.value[t]}),r.value=e,await N(),e={},Object.keys(c.value).sort().forEach(t=>{e[t]=c.value[t]}),c.value=e,A.value="end"}async function N(){if(!b.value)for(let e in c.value){const t=await P(e);c.value[e].status="done",c.value[e].check=t.check?"ok":t.code}}async function F(e,t){if(b.value||["#","/a_dmin","/f_ilament"].some(a=>e.startsWith(a)))return;if(["//","http://","https://"].some(a=>e.startsWith(a))){e in c.value||(c.value[e]={status:"reading",check:"unknown",parentArr:[]}),c.value[e].parentArr.push(t);return}if(e in r.value){r.value[e].check!="ok"&&r.value[e].parentArr.push(t);return}r.value[e]={status:"reading",check:"unknown",parentArr:[t]};try{const a=await D(e);r.value[e].check="ok";for(const l of a){if(b.value)return;await F(l,e)}}catch(a){r.value[e].check=a.message}finally{r.value[e].status="done"}}async function B(){await v({command:"deleteFromStorage"}),document.showToast("кеш удален")}async function q(){await v({command:"deleteFromPublic"}),document.showToast("кеш удален"),await S()}async function H(){await v({command:"startHtmlCache"}),document.showToast("кеш опубликован"),await S()}async function M(){const e=await v({command:"listCacheFiles"});r.value={},c.value={},e.forEach(t=>{r.value[t]={status:"file",check:"ok",parentArr:[]}}),A.value="end",document.showToast("кеш считан")}async function S(){await $(2e3);const e=await v({command:"getIniParams"});document.showToast("Готово"),x.value=e?.STATIC_HTML_ENABLE}const Q=j(()=>{for(const e in r.value)if(r.value[e]?.check!="ok"&&r.value[e]?.check!="reading")return!0;return!1}),R=j(()=>{for(const e in c.value)if(r.value[e]?.check!="ok"&&r.value[e]?.check!="reading")return!0;return!1});return(e,t)=>{const _=O("Toast"),L=O("ConfirmDialog");return o(),n(u,null,[t[12]||(t[12]=s("h1",null,"Crawler 0.7",-1)),s("div",mt,[t[1]||(t[1]=k(" Статус кеша ",-1)),s("button",{class:Y(["btn btn-secondary fas fa-circle",{"btn-success ":x.value,"btn-secondary":!x.value}])},null,2)]),s("div",_t,[h(w,{action:S},{default:y(()=>[...t[2]||(t[2]=[k("Считать параметры",-1)])]),_:1})]),s("div",kt,[h(w,{action:M},{default:y(()=>[...t[3]||(t[3]=[k("Считать сторадж",-1)])]),_:1})]),s("div",pt,[h(w,{action:B},{default:y(()=>[...t[4]||(t[4]=[k("Удалить в сторадж",-1)])]),_:1})]),s("div",bt,[h(w,{action:H},{default:y(()=>[...t[5]||(t[5]=[k("Опубликовать сторадж",-1)])]),_:1})]),s("div",vt,[h(w,{action:q},{default:y(()=>[...t[6]||(t[6]=[k("Удалить паблик",-1)])]),_:1})]),s("div",yt,[h(w,{action:I},{default:y(()=>[...t[7]||(t[7]=[k("Старт",-1)])]),_:1}),A.value=="working"?(o(),n("button",{key:0,class:"btn btn-danger fas fa-stop ms-3",onClick:t[0]||(t[0]=a=>b.value=!0)})):f("",!0)]),Q.value?(o(),n("div",wt,[t[8]||(t[8]=s("h3",null,"Error",-1)),s("table",gt,[s("tbody",null,[(o(!0),n(u,null,m(r.value,(a,l)=>(o(),n(u,{key:l},[a.check!="ok"?(o(),n("tr",Ct,[s("td",Et,[s("a",{href:l,target:"_blank"},i(l),9,At)]),s("td",null,i(a.status),1),s("td",null,i(a.check),1),s("td",null,[(o(!0),n(u,null,m(a.parentArr,d=>(o(),n("span",St,[s("a",{href:d,target:"_blank"},i(d),9,Tt)]))),256))])])):f("",!0)],64))),128))])])])):f("",!0),Object.keys(r.value).length>0?(o(),n("div",$t,[t[9]||(t[9]=s("h3",null,"Ok",-1)),s("table",xt,[s("tbody",null,[(o(!0),n(u,null,m(r.value,(a,l)=>(o(),n(u,{key:l},[a.check=="ok"?(o(),n("tr",Lt,[s("td",Pt,[s("a",{href:l,target:"_blank"},i(l),9,Ft)]),s("td",null,i(a.status),1),s("td",null,i(a.check),1),s("td",null,[(o(!0),n(u,null,m(a.parentArr,d=>(o(),n("span",Bt,[s("a",{href:d,target:"_blank"},i(d),9,jt)]))),256))])])):f("",!0)],64))),128))])])])):f("",!0),R.value?(o(),n("div",Ot,[t[10]||(t[10]=s("h2",null,"External Error",-1)),s("table",Ut,[s("tbody",null,[(o(!0),n(u,null,m(c.value,(a,l)=>(o(),n(u,{key:l},[a.check!="ok"?(o(),n("tr",Vt,[s("td",Dt,[s("a",{href:l,target:"_blank"},i(l),9,It)]),s("td",null,i(a.status),1),s("td",null,i(a.check),1),s("td",null,[(o(!0),n(u,null,m(a.parentArr,d=>(o(),n("span",Nt,[s("a",{href:d,target:"_blank"},i(d),9,qt)]))),256))])])):f("",!0)],64))),128))])])])):f("",!0),Object.keys(c.value).length>1?(o(),n("div",Ht,[t[11]||(t[11]=s("h2",null,"External OK",-1)),s("table",Mt,[s("tbody",null,[(o(!0),n(u,null,m(c.value,(a,l)=>(o(),n(u,{key:l},[a.check=="ok"?(o(),n("tr",Qt,[s("td",Rt,[s("a",{href:l,target:"_blank"},i(l),9,Wt)]),s("td",null,i(a.status),1),s("td",null,i(a.check),1),s("td",null,[(o(!0),n(u,null,m(a.parentArr,d=>(o(),n("span",zt,[s("a",{href:d,target:"_blank"},i(d),9,Gt)]))),256))])])):f("",!0)],64))),128))])])])):f("",!0),h(_,{position:"top-left"}),h(L)],64)}}},Xt=dt(Kt,[["__scopeId","data-v-48ebd0f3"]]),Yt=[U,J,tt,et,st,at,nt,ot,rt,ut],E=Z(Xt);Yt.forEach(C=>{E.component(C.name,C)});E.use(lt,{theme:{preset:ct,options:{cssLayer:{name:"primevue",order:"theme, base, primevue"}}}});E.use(it);E.use(U);E.mount("#crawler");
